<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="v1_819_2flink_2src_2main_2java_2org_2apache_2iceberg_2flink_2sink_2FlinkSink_8java" kind="file" language="Java">
    <compoundname>FlinkSink.java</compoundname>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink" prot="public">org::apache::iceberg::flink::sink::FlinkSink</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" prot="public">org::apache::iceberg::flink::sink::FlinkSink::Builder</innerclass>
    <innernamespace refid="namespaceorg_1_1apache_1_1iceberg_1_1flink_1_1sink">org::apache::iceberg::flink::sink</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Licensed<sp/>to<sp/>the<sp/>Apache<sp/>Software<sp/>Foundation<sp/>(ASF)<sp/>under<sp/>one</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>or<sp/>more<sp/>contributor<sp/>license<sp/>agreements.<sp/><sp/>See<sp/>the<sp/>NOTICE<sp/>file</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>distributed<sp/>with<sp/>this<sp/>work<sp/>for<sp/>additional<sp/>information</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>regarding<sp/>copyright<sp/>ownership.<sp/><sp/>The<sp/>ASF<sp/>licenses<sp/>this<sp/>file</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>to<sp/>you<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>&quot;License&quot;);<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>with<sp/>the<sp/>License.<sp/><sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/><sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>Unless<sp/>required<sp/>by<sp/>applicable<sp/>law<sp/>or<sp/>agreed<sp/>to<sp/>in<sp/>writing,</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>software<sp/>distributed<sp/>under<sp/>the<sp/>License<sp/>is<sp/>distributed<sp/>on<sp/>an</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>&quot;AS<sp/>IS&quot;<sp/>BASIS,<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>KIND,<sp/>either<sp/>express<sp/>or<sp/>implied.<sp/><sp/>See<sp/>the<sp/>License<sp/>for<sp/>the</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and<sp/>limitations</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>under<sp/>the<sp/>License.</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">package<sp/></highlight><highlight class="normal">org.apache.iceberg.flink.sink;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1a775568fcf12c6eb568751e8a2ce498b0" kindref="member">AVRO_COMPRESSION</ref>;</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1ac97adeffe65590f8fca00bcba0596767" kindref="member">AVRO_COMPRESSION_LEVEL</ref>;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1ad8d965b3e6934e27faae20fff2968a0a" kindref="member">ORC_COMPRESSION</ref>;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1a750d77d47ff423b5294a3bd851ccd117" kindref="member">ORC_COMPRESSION_STRATEGY</ref>;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1a48245b2fbafda0cf12468f04016d2c7b" kindref="member">PARQUET_COMPRESSION</ref>;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1aa0ffe839adf6dac971bbea5171a35638" kindref="member">PARQUET_COMPRESSION_LEVEL</ref>;</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1ade7bfda60ebf2140c8d1bb44faa72176" kindref="member">WRITE_DISTRIBUTION_MODE</ref>;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.IOException;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.UncheckedIOException;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.time.Duration;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.List;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Map;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Set;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.function.Function;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.api.common.functions.MapFunction;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.api.common.typeinfo.TypeInformation;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.api.common.typeinfo.Types;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.configuration.Configuration;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.configuration.ReadableConfig;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.streaming.api.datastream.DataStream;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.streaming.api.datastream.DataStreamSink;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.streaming.api.datastream.SingleOutputStreamOperator;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.streaming.api.functions.sink.DiscardingSink;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.table.api.TableSchema;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.table.data.RowData;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.table.data.util.DataFormatConverters;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.table.types.DataType;</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.table.types.logical.RowType;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.flink.types.Row;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref>;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1DistributionMode" kindref="compound">DistributionMode</ref>;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1FileFormat" kindref="compound">FileFormat</ref>;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref>;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>;</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref>;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SerializableTable" kindref="compound">SerializableTable</ref>;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table" kindref="compound">Table</ref>;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1flink" kindref="compound">flink</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkSchemaUtil" kindref="compound">FlinkSchemaUtil</ref>;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1flink" kindref="compound">flink</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf" kindref="compound">FlinkWriteConf</ref>;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1flink" kindref="compound">flink</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions" kindref="compound">FlinkWriteOptions</ref>;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1flink" kindref="compound">flink</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1flink_1_1TableLoader" kindref="compound">TableLoader</ref>;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1flink" kindref="compound">flink</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1flink_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1util_1_1FlinkCompatibilityUtil" kindref="compound">FlinkCompatibilityUtil</ref>;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1WriteResult" kindref="compound">WriteResult</ref>;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.annotations.VisibleForTesting;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.base.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1base_1_1Preconditions" kindref="compound">Preconditions</ref>;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Lists;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1collect_1_1Maps" kindref="compound">Maps</ref>;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1collect_1_1Sets" kindref="compound">Sets</ref>;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1types" kindref="compound">types</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil" kindref="compound">TypeUtil</ref>;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier</ref>;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.slf4j.Logger;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.slf4j.LoggerFactory;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">FlinkSink<sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Logger<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a1965688f0f1656bb5056da30e7ecd04a" kindref="member">LOG</ref><sp/>=<sp/>LoggerFactory.getLogger(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a3d5d0b7a70599da4412bf67dab8889af" kindref="member">FlinkSink</ref>.class);</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a08386983f07800016650afb460fc8b19" kindref="member">ICEBERG_STREAM_WRITER_NAME</ref><sp/>=</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>IcebergStreamWriter.class.getSimpleName();</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1ab9ddd0bf9d5671832b6a831ee72378e7" kindref="member">ICEBERG_FILES_COMMITTER_NAME</ref><sp/>=</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>IcebergFilesCommitter.class.getSimpleName();</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a3d5d0b7a70599da4412bf67dab8889af" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a3d5d0b7a70599da4412bf67dab8889af" kindref="member">FlinkSink</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="97" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5cb5cef9dec8a9ab57a01f3387c6b346" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>static<sp/>&lt;T&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5cb5cef9dec8a9ab57a01f3387c6b346" kindref="member">builderFor</ref>(</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DataStream&lt;T&gt;<sp/>input,<sp/>MapFunction&lt;T,<sp/>RowData&gt;<sp/>mapper,<sp/>TypeInformation&lt;RowData&gt;<sp/>outputType)<sp/>{</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref>().forMapperOutputType(input,<sp/>mapper,<sp/>outputType);</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="111" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a7b905dfa5a487ae7375c1f6f2d9df0d8" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a7b905dfa5a487ae7375c1f6f2d9df0d8" kindref="member">forRow</ref>(DataStream&lt;Row&gt;<sp/>input,<sp/>TableSchema<sp/>tableSchema)<sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>RowType<sp/>rowType<sp/>=<sp/>(RowType)<sp/>tableSchema.toRowDataType().getLogicalType();</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/>DataType[]<sp/>fieldDataTypes<sp/>=<sp/>tableSchema.getFieldDataTypes();</highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/>DataFormatConverters.RowConverter<sp/>rowConverter<sp/>=</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>DataFormatConverters.RowConverter(fieldDataTypes);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5cb5cef9dec8a9ab57a01f3387c6b346" kindref="member">builderFor</ref>(input,<sp/>rowConverter::toInternal,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1util_1_1FlinkCompatibilityUtil" kindref="compound">FlinkCompatibilityUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1util_1_1FlinkCompatibilityUtil_1ae73fcede3797f336658aa0df963396d0" kindref="member">toTypeInfo</ref>(rowType))</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a043c3fc5272a0abfed27abcec4febcc4" kindref="member">tableSchema</ref>(tableSchema);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="128" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1adae9b135107c6b17f682bc89b89a33a1" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1adae9b135107c6b17f682bc89b89a33a1" kindref="member">forRowData</ref>(DataStream&lt;RowData&gt;<sp/>input)<sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1adb41ab6d8bd43a14b2e3e4e56490418a" kindref="member">forRowData</ref>(input);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">Builder<sp/>{</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Function&lt;String,<sp/>DataStream&lt;RowData&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a53c215ba1c4a86bd66b9d21771d43b4e" kindref="member">inputCreator</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1flink_1_1TableLoader" kindref="compound">TableLoader</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1afe6038b53315dff670ea704a9f15f576" kindref="member">tableLoader</ref>;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table" kindref="compound">Table</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>TableSchema<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a043c3fc5272a0abfed27abcec4febcc4" kindref="member">tableSchema</ref>;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>List&lt;String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aac330e1d657b4b3ce4cc532ff8488e9b" kindref="member">equalityFieldColumns</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8b4b94ab5ee33fee937c179a4dc161ae" kindref="member">snapshotProperties</ref><sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>ReadableConfig<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1abd7994971aca08b1d4b792196e3687cc" kindref="member">readableConfig</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Configuration();</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref><sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf" kindref="compound">FlinkWriteConf</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="144" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aaecc4cad70a62c2a9b6f3e4f69cdb3d3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aaecc4cad70a62c2a9b6f3e4f69cdb3d3" kindref="member">Builder</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1adb41ab6d8bd43a14b2e3e4e56490418a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1adb41ab6d8bd43a14b2e3e4e56490418a" kindref="member">forRowData</ref>(DataStream&lt;RowData&gt;<sp/>newRowDataInput)<sp/>{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.inputCreator<sp/>=<sp/>ignored<sp/>-&gt;<sp/>newRowDataInput;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>&lt;T&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/>forMapperOutputType(</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DataStream&lt;T&gt;<sp/>input,<sp/>MapFunction&lt;T,<sp/>RowData&gt;<sp/>mapper,<sp/>TypeInformation&lt;RowData&gt;<sp/>outputType)<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.inputCreator<sp/>=</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newUidPrefix<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Input<sp/>stream<sp/>order<sp/>is<sp/>crucial<sp/>for<sp/>some<sp/>situation(e.g.<sp/>in<sp/>cdc<sp/>case).<sp/>Therefore,<sp/>we</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>need<sp/>to<sp/>set<sp/>the<sp/>parallelism</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>of<sp/>map<sp/>operator<sp/>same<sp/>as<sp/>its<sp/>input<sp/>to<sp/>keep<sp/>map<sp/>operator<sp/>chaining<sp/>its<sp/>input,<sp/>and<sp/>avoid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rebalanced<sp/>by<sp/>default.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SingleOutputStreamOperator&lt;RowData&gt;<sp/>inputStream<sp/>=</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input.map(mapper,<sp/>outputType).setParallelism(input.getParallelism());</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newUidPrefix<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>inputStream.name(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a914053c0844092f8f65076b4ec0292a1" kindref="member">operatorName</ref>(newUidPrefix)).uid(newUidPrefix<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;-mapper&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>inputStream;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="177" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad9fc47a4cca359d609421ad92bbf080c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad9fc47a4cca359d609421ad92bbf080c" kindref="member">table</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table" kindref="compound">Table</ref><sp/>newTable)<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.table<sp/>=<sp/>newTable;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="190" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a570f3bff53582b419954f54f314f6c2a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a570f3bff53582b419954f54f314f6c2a" kindref="member">tableLoader</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1flink_1_1TableLoader" kindref="compound">TableLoader</ref><sp/>newTableLoader)<sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.tableLoader<sp/>=<sp/>newTableLoader;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="199" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a032f76a2797d90c1768824c0fe12a477" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/></highlight><highlight class="keyword">set</highlight><highlight class="normal">(String<sp/>property,<sp/>String<sp/>value)<sp/>{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref>.put(property,<sp/>value);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="208" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ace6b660a4d5560b0de1235879b7143a2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ace6b660a4d5560b0de1235879b7143a2" kindref="member">setAll</ref>(Map&lt;String,<sp/>String&gt;<sp/>properties)<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref>.putAll(properties);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a471e81674438dd747d0102c188ac39f6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a471e81674438dd747d0102c188ac39f6" kindref="member">tableSchema</ref>(TableSchema<sp/>newTableSchema)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.tableSchema<sp/>=<sp/>newTableSchema;</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a2567f9b168287972b17c48de40ee3a97" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a2567f9b168287972b17c48de40ee3a97" kindref="member">overwrite</ref>(</highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>newOverwrite)<sp/>{</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref>.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions" kindref="compound">FlinkWriteOptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions_1a368ef68d74f258885f6851a15e44a888" kindref="member">OVERWRITE_MODE</ref>.key(),<sp/>Boolean.toString(newOverwrite));</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ac9ee4fb732180d048be2d414b9d1c175" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ac9ee4fb732180d048be2d414b9d1c175" kindref="member">flinkConf</ref>(ReadableConfig<sp/>config)<sp/>{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.readableConfig<sp/>=<sp/>config;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="235" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a409bd8344d46907254525174fa24aee8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a409bd8344d46907254525174fa24aee8" kindref="member">distributionMode</ref>(<ref refid="enumorg_1_1apache_1_1iceberg_1_1DistributionMode" kindref="compound">DistributionMode</ref><sp/>mode)<sp/>{</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<ref refid="enumorg_1_1apache_1_1iceberg_1_1DistributionMode" kindref="compound">DistributionMode</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1DistributionMode_1a7e6ed2689bd10affeff4443042ab9f95" kindref="member">RANGE</ref>.equals(mode),</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Flink<sp/>does<sp/>not<sp/>support<sp/>&apos;range&apos;<sp/>write<sp/>distribution<sp/>mode<sp/>now.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mode<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref>.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions" kindref="compound">FlinkWriteOptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions_1aee6c180eec15119a2e23a162ebd028af" kindref="member">DISTRIBUTION_MODE</ref>.key(),<sp/>mode.<ref refid="enumorg_1_1apache_1_1iceberg_1_1DistributionMode_1aeb820414e02e03514742789c637556df" kindref="member">modeName</ref>());</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="251" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a802cba46068501733cea4dfae45dff9a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a802cba46068501733cea4dfae45dff9a" kindref="member">writeParallelism</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newWriteParallelism)<sp/>{</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref>.put(</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions" kindref="compound">FlinkWriteOptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions_1a23ba213219e26bf48d15f506fdb29dad" kindref="member">WRITE_PARALLELISM</ref>.key(),<sp/>Integer.toString(newWriteParallelism));</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight></codeline>
<codeline lineno="266" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ab7d9cd73b5684944f07a8454c0776646" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ab7d9cd73b5684944f07a8454c0776646" kindref="member">upsert</ref>(</highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>enabled)<sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref>.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions" kindref="compound">FlinkWriteOptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions_1a1777d5ec7b8631fd2b8e0bf70024da18" kindref="member">WRITE_UPSERT_ENABLED</ref>.key(),<sp/>Boolean.toString(enabled));</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight></codeline>
<codeline lineno="277" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a9ac2611a0a699093a3e0a9776c2f9275" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a9ac2611a0a699093a3e0a9776c2f9275" kindref="member">equalityFieldColumns</ref>(List&lt;String&gt;<sp/>columns)<sp/>{</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.equalityFieldColumns<sp/>=<sp/>columns;</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="306" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1abea561e45efad43b304427cac2ff7d8c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1abea561e45efad43b304427cac2ff7d8c" kindref="member">uidPrefix</ref>(String<sp/>newPrefix)<sp/>{</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.uidPrefix<sp/>=<sp/>newPrefix;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ac74b35b33292e074343321bdef879910" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ac74b35b33292e074343321bdef879910" kindref="member">setSnapshotProperties</ref>(Map&lt;String,<sp/>String&gt;<sp/>properties)<sp/>{</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8b4b94ab5ee33fee937c179a4dc161ae" kindref="member">snapshotProperties</ref>.putAll(properties);</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="316" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1addf107d0bbe878b275835b7320f7494c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1addf107d0bbe878b275835b7320f7494c" kindref="member">setSnapshotProperty</ref>(String<sp/>property,<sp/>String<sp/>value)<sp/>{</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8b4b94ab5ee33fee937c179a4dc161ae" kindref="member">snapshotProperties</ref>.put(property,<sp/>value);</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="321" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a73f90586e9ce71494277caa0450da35b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a73f90586e9ce71494277caa0450da35b" kindref="member">toBranch</ref>(String<sp/>branch)<sp/>{</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref>.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions" kindref="compound">FlinkWriteOptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteOptions_1ae6e1bb14932315ab80518c6c3e49852a" kindref="member">BRANCH</ref>.key(),<sp/>branch);</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>&lt;T&gt;<sp/>DataStreamSink&lt;T&gt;<sp/>chainIcebergOperators()<sp/>{</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a53c215ba1c4a86bd66b9d21771d43b4e" kindref="member">inputCreator</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Please<sp/>use<sp/>forRowData()<sp/>or<sp/>forMapperOutputType()<sp/>to<sp/>initialize<sp/>the<sp/>input<sp/>DataStream.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkNotNull(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1afe6038b53315dff670ea704a9f15f576" kindref="member">tableLoader</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Table<sp/>loader<sp/>shouldn&apos;t<sp/>be<sp/>null&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DataStream&lt;RowData&gt;<sp/>rowDataInput<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a53c215ba1c4a86bd66b9d21771d43b4e" kindref="member">inputCreator</ref>.apply(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref>);</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1afe6038b53315dff670ea704a9f15f576" kindref="member">tableLoader</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1flink_1_1TableLoader_1a0f7262108de7413578ec4a1ae76ca444" kindref="member">isOpen</ref>())<sp/>{</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1afe6038b53315dff670ea704a9f15f576" kindref="member">tableLoader</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1flink_1_1TableLoader_1ab670ee7ee0a850c9e28aef433ad637d9" kindref="member">open</ref>();</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1flink_1_1TableLoader" kindref="compound">TableLoader</ref><sp/>loader<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1afe6038b53315dff670ea704a9f15f576" kindref="member">tableLoader</ref>)<sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.table<sp/>=<sp/>loader.loadTable();</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(IOException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>UncheckedIOException(</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>load<sp/>iceberg<sp/>table<sp/>from<sp/>table<sp/>loader:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1afe6038b53315dff670ea704a9f15f576" kindref="member">tableLoader</ref>,<sp/>e);</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>FlinkWriteConf(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aeb8310136a9214f6e2b50d562390cce3" kindref="member">writeOptions</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1abd7994971aca08b1d4b792196e3687cc" kindref="member">readableConfig</ref>);</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Find<sp/>out<sp/>the<sp/>equality<sp/>field<sp/>id<sp/>list<sp/>based<sp/>on<sp/>the<sp/>user-provided<sp/>equality<sp/>field<sp/>column<sp/>names.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Integer&gt;<sp/>equalityFieldIds<sp/>=<sp/>checkAndGetEqualityFieldIds();</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Convert<sp/>the<sp/>requested<sp/>flink<sp/>table<sp/>schema<sp/>to<sp/>flink<sp/>row<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>RowType<sp/>flinkRowType<sp/>=<sp/>toFlinkRowType(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a1e7f6c302ab9df95642c549195732a09" kindref="member">schema</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a043c3fc5272a0abfed27abcec4febcc4" kindref="member">tableSchema</ref>);</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Distribute<sp/>the<sp/>records<sp/>from<sp/>input<sp/>data<sp/>stream<sp/>based<sp/>on<sp/>the<sp/>write.distribution-mode<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>equality<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DataStream&lt;RowData&gt;<sp/>distributeStream<sp/>=</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aca4be1815766ab076e1e67bb5125d1a3" kindref="member">distributeDataStream</ref>(</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rowDataInput,<sp/>equalityFieldIds,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a896bd81a171a850db849109694a5b9ce" kindref="member">spec</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a1e7f6c302ab9df95642c549195732a09" kindref="member">schema</ref>(),<sp/>flinkRowType);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>parallel<sp/>writers<sp/>that<sp/>append<sp/>rows<sp/>to<sp/>files</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SingleOutputStreamOperator&lt;WriteResult&gt;<sp/>writerStream<sp/>=</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ae1c29bc7e9ca57d488d4f5b2869f25fe" kindref="member">appendWriter</ref>(distributeStream,<sp/>flinkRowType,<sp/>equalityFieldIds);</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>single-parallelism<sp/>committer<sp/>that<sp/>commits<sp/>files</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>after<sp/>successful<sp/>checkpoint<sp/>or<sp/>end<sp/>of<sp/>input</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SingleOutputStreamOperator&lt;Void&gt;<sp/>committerStream<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a612dc139e75503397b317697862590d0" kindref="member">appendCommitter</ref>(writerStream);</highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>dummy<sp/>discard<sp/>sink</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>appendDummySink(committerStream);</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="378" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a769d5e7b5550b4a7e3774ce8cdac750a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>DataStreamSink&lt;Void&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a769d5e7b5550b4a7e3774ce8cdac750a" kindref="member">append</ref>()<sp/>{</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>chainIcebergOperators();</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a914053c0844092f8f65076b4ec0292a1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a914053c0844092f8f65076b4ec0292a1" kindref="member">operatorName</ref>(String<sp/>suffix)<sp/>{</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>?<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;-&quot;</highlight><highlight class="normal"><sp/>+<sp/>suffix<sp/>:<sp/>suffix;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/>@VisibleForTesting</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;Integer&gt;<sp/>checkAndGetEqualityFieldIds()<sp/>{</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Integer&gt;<sp/>equalityFieldIds<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a1e7f6c302ab9df95642c549195732a09" kindref="member">schema</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a44fe5a49a1703e4644531edee63dfe4a" kindref="member">identifierFieldIds</ref>());</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aac330e1d657b4b3ce4cc532ff8488e9b" kindref="member">equalityFieldColumns</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aac330e1d657b4b3ce4cc532ff8488e9b" kindref="member">equalityFieldColumns</ref>.isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;Integer&gt;<sp/>equalityFieldSet<sp/>=</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Sets.newHashSetWithExpectedSize(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aac330e1d657b4b3ce4cc532ff8488e9b" kindref="member">equalityFieldColumns</ref>.size());</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(String<sp/>column<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aac330e1d657b4b3ce4cc532ff8488e9b" kindref="member">equalityFieldColumns</ref>)<sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1types" kindref="compound">types</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types" kindref="compound">Types</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1NestedField" kindref="compound">NestedField</ref><sp/>field<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a1e7f6c302ab9df95642c549195732a09" kindref="member">schema</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1af6a287dd0c94d0a15ae7304a49fa87c4" kindref="member">findField</ref>(column);</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkNotNull(</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>field,</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Missing<sp/>required<sp/>equality<sp/>field<sp/>column<sp/>&apos;%s&apos;<sp/>in<sp/>table<sp/>schema<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>column,</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a1e7f6c302ab9df95642c549195732a09" kindref="member">schema</ref>());</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>equalityFieldSet.add(field.fieldId());</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!equalityFieldSet.equals(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a1e7f6c302ab9df95642c549195732a09" kindref="member">schema</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a44fe5a49a1703e4644531edee63dfe4a" kindref="member">identifierFieldIds</ref>()))<sp/>{</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a1965688f0f1656bb5056da30e7ecd04a" kindref="member">LOG</ref>.warn(</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;The<sp/>configured<sp/>equality<sp/>field<sp/>column<sp/>IDs<sp/>{}<sp/>are<sp/>not<sp/>matched<sp/>with<sp/>the<sp/>schema<sp/>identifier<sp/>field<sp/>IDs&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>{},<sp/>use<sp/>job<sp/>specified<sp/>equality<sp/>field<sp/>columns<sp/>as<sp/>the<sp/>equality<sp/>fields<sp/>by<sp/>default.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>equalityFieldSet,</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a1e7f6c302ab9df95642c549195732a09" kindref="member">schema</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a44fe5a49a1703e4644531edee63dfe4a" kindref="member">identifierFieldIds</ref>());</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>equalityFieldIds<sp/>=<sp/>Lists.newArrayList(equalityFieldSet);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>equalityFieldIds;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/>@SuppressWarnings(</highlight><highlight class="stringliteral">&quot;unchecked&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>&lt;T&gt;<sp/>DataStreamSink&lt;T&gt;<sp/>appendDummySink(</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SingleOutputStreamOperator&lt;Void&gt;<sp/>committerStream)<sp/>{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>DataStreamSink&lt;T&gt;<sp/>resultStream<sp/>=</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>committerStream</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.addSink(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>DiscardingSink())</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.name(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a914053c0844092f8f65076b4ec0292a1" kindref="member">operatorName</ref>(String.format(</highlight><highlight class="stringliteral">&quot;IcebergSink<sp/>%s&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">.table.name())))</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setParallelism(1);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resultStream<sp/>=<sp/>resultStream.uid(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;-dummysink&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>resultStream;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a612dc139e75503397b317697862590d0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>SingleOutputStreamOperator&lt;Void&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a612dc139e75503397b317697862590d0" kindref="member">appendCommitter</ref>(</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SingleOutputStreamOperator&lt;WriteResult&gt;<sp/>writerStream)<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>IcebergFilesCommitter<sp/>filesCommitter<sp/>=</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>IcebergFilesCommitter(</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1afe6038b53315dff670ea704a9f15f576" kindref="member">tableLoader</ref>,</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a4b792e8678b58acaacb725ac701c081c" kindref="member">overwriteMode</ref>(),</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8b4b94ab5ee33fee937c179a4dc161ae" kindref="member">snapshotProperties</ref>,</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a89532996e37316e7fcba9186467aae37" kindref="member">workerPoolSize</ref>(),</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a5878f40d1d506fed698cf59fa3424191" kindref="member">branch</ref>(),</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a896bd81a171a850db849109694a5b9ce" kindref="member">spec</ref>());</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SingleOutputStreamOperator&lt;Void&gt;<sp/>committerStream<sp/>=</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>writerStream</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.transform(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a914053c0844092f8f65076b4ec0292a1" kindref="member">operatorName</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1ab9ddd0bf9d5671832b6a831ee72378e7" kindref="member">ICEBERG_FILES_COMMITTER_NAME</ref>),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types" kindref="compound">Types</ref>.VOID,<sp/>filesCommitter)</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setParallelism(1)</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setMaxParallelism(1);</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>committerStream<sp/>=<sp/>committerStream.uid(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;-committer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>committerStream;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ae1c29bc7e9ca57d488d4f5b2869f25fe" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>SingleOutputStreamOperator&lt;WriteResult&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ae1c29bc7e9ca57d488d4f5b2869f25fe" kindref="member">appendWriter</ref>(</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DataStream&lt;RowData&gt;<sp/>input,<sp/>RowType<sp/>flinkRowType,<sp/>List&lt;Integer&gt;<sp/>equalityFieldIds)<sp/>{</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Validate<sp/>the<sp/>equality<sp/>fields<sp/>and<sp/>partition<sp/>fields<sp/>if<sp/>we<sp/>enable<sp/>the<sp/>upsert<sp/>mode.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a4e677bb6c172d520e7eca4e5a0758dd0" kindref="member">upsertMode</ref>())<sp/>{</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkState(</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a4b792e8678b58acaacb725ac701c081c" kindref="member">overwriteMode</ref>(),</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;OVERWRITE<sp/>mode<sp/>shouldn&apos;t<sp/>be<sp/>enable<sp/>when<sp/>configuring<sp/>to<sp/>use<sp/>UPSERT<sp/>data<sp/>stream.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkState(</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!equalityFieldIds.isEmpty(),</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Equality<sp/>field<sp/>columns<sp/>shouldn&apos;t<sp/>be<sp/>empty<sp/>when<sp/>configuring<sp/>to<sp/>use<sp/>UPSERT<sp/>data<sp/>stream.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a896bd81a171a850db849109694a5b9ce" kindref="member">spec</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1afbfdfd843c02bcae35fe72994dcd968d" kindref="member">isUnpartitioned</ref>())<sp/>{</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>partitionField<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a896bd81a171a850db849109694a5b9ce" kindref="member">spec</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a9e4d9fea3edf1aed8d8e7ef1f0392450" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkState(</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>equalityFieldIds.contains(partitionField.sourceId()),</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;In<sp/>UPSERT<sp/>mode,<sp/>partition<sp/>field<sp/>&apos;%s&apos;<sp/>should<sp/>be<sp/>included<sp/>in<sp/>equality<sp/>fields:<sp/>&apos;%s&apos;&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partitionField,</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aac330e1d657b4b3ce4cc532ff8488e9b" kindref="member">equalityFieldColumns</ref>);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="469"><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SerializableTable" kindref="compound">SerializableTable</ref><sp/>serializableTable<sp/>=<sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SerializableTable" kindref="compound">SerializableTable</ref>)<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SerializableTable" kindref="compound">SerializableTable</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SerializableTable_1ae8117c53577233fd5ffde28e46a0bcf2" kindref="member">copyOf</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a10624ed96a138d64071ff6a1225526bd" kindref="member">table</ref>);</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Duration<sp/>tableRefreshInterval<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a3ddc8c9074cf4d07b562c95286b5b771" kindref="member">tableRefreshInterval</ref>();</highlight></codeline>
<codeline lineno="472"><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier&lt;Table&gt;</ref><sp/>tableSupplier;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tableRefreshInterval<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tableSupplier<sp/>=</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>CachingTableSupplier(serializableTable,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1afe6038b53315dff670ea704a9f15f576" kindref="member">tableLoader</ref>,<sp/>tableRefreshInterval);</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tableSupplier<sp/>=<sp/>()<sp/>-&gt;<sp/>serializableTable;</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>IcebergStreamWriter&lt;RowData&gt;<sp/>streamWriter<sp/>=</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>createStreamWriter(tableSupplier,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>,<sp/>flinkRowType,<sp/>equalityFieldIds);</highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>parallelism<sp/>=</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a37c0b4e96e862cf4903f1596c8164b11" kindref="member">writeParallelism</ref>()<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>?<sp/>input.getParallelism()</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a37c0b4e96e862cf4903f1596c8164b11" kindref="member">writeParallelism</ref>();</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SingleOutputStreamOperator&lt;WriteResult&gt;<sp/>writerStream<sp/>=</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.transform(</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a914053c0844092f8f65076b4ec0292a1" kindref="member">operatorName</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a08386983f07800016650afb460fc8b19" kindref="member">ICEBERG_STREAM_WRITER_NAME</ref>),</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TypeInformation.of(<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1WriteResult" kindref="compound">WriteResult</ref>.class),</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>streamWriter)</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setParallelism(parallelism);</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>writerStream<sp/>=<sp/>writerStream.uid(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1a8ed1ecb40521669a3a627268b5bde8c5" kindref="member">uidPrefix</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;-writer&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>writerStream;</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="500"><highlight class="normal"></highlight></codeline>
<codeline lineno="501" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aca4be1815766ab076e1e67bb5125d1a3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>DataStream&lt;RowData&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aca4be1815766ab076e1e67bb5125d1a3" kindref="member">distributeDataStream</ref>(</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DataStream&lt;RowData&gt;<sp/>input,</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Integer&gt;<sp/>equalityFieldIds,</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>partitionSpec,</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>iSchema,</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>RowType<sp/>flinkRowType)<sp/>{</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1DistributionMode" kindref="compound">DistributionMode</ref><sp/>writeMode<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1ad74a9a0a940b6fffc2c4ed20e7babb10" kindref="member">flinkWriteConf</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a6ef4564ae6c66528bc3cc326ed49b07f" kindref="member">distributionMode</ref>();</highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a1965688f0f1656bb5056da30e7ecd04a" kindref="member">LOG</ref>.info(</highlight><highlight class="stringliteral">&quot;Write<sp/>distribution<sp/>mode<sp/>is<sp/>&apos;{}&apos;&quot;</highlight><highlight class="normal">,<sp/>writeMode.<ref refid="enumorg_1_1apache_1_1iceberg_1_1DistributionMode_1aeb820414e02e03514742789c637556df" kindref="member">modeName</ref>());</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(writeMode)<sp/>{</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>NONE:</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(equalityFieldIds.isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>input;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a1965688f0f1656bb5056da30e7ecd04a" kindref="member">LOG</ref>.info(</highlight><highlight class="stringliteral">&quot;Distribute<sp/>rows<sp/>by<sp/>equality<sp/>fields,<sp/>because<sp/>there<sp/>are<sp/>equality<sp/>fields<sp/>set&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>input.keyBy(</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>EqualityFieldKeySelector(iSchema,<sp/>flinkRowType,<sp/>equalityFieldIds));</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>HASH:</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(equalityFieldIds.isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1afbfdfd843c02bcae35fe72994dcd968d" kindref="member">isUnpartitioned</ref>())<sp/>{</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a1965688f0f1656bb5056da30e7ecd04a" kindref="member">LOG</ref>.warn(</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Fallback<sp/>to<sp/>use<sp/>&apos;none&apos;<sp/>distribution<sp/>mode,<sp/>because<sp/>there<sp/>are<sp/>no<sp/>equality<sp/>fields<sp/>set<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;and<sp/>table<sp/>is<sp/>unpartitioned&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>input;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>input.keyBy(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>PartitionKeySelector(partitionSpec,<sp/>iSchema,<sp/>flinkRowType));</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1afbfdfd843c02bcae35fe72994dcd968d" kindref="member">isUnpartitioned</ref>())<sp/>{</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a1965688f0f1656bb5056da30e7ecd04a" kindref="member">LOG</ref>.info(</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Distribute<sp/>rows<sp/>by<sp/>equality<sp/>fields,<sp/>because<sp/>there<sp/>are<sp/>equality<sp/>fields<sp/>set<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;and<sp/>table<sp/>is<sp/>unpartitioned&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>input.keyBy(</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>EqualityFieldKeySelector(iSchema,<sp/>flinkRowType,<sp/>equalityFieldIds));</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>partitionField<sp/>:<sp/>partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a9e4d9fea3edf1aed8d8e7ef1f0392450" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkState(</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>equalityFieldIds.contains(partitionField.sourceId()),</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;In<sp/>&apos;hash&apos;<sp/>distribution<sp/>mode<sp/>with<sp/>equality<sp/>fields<sp/>set,<sp/>partition<sp/>field<sp/>&apos;%s&apos;<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;should<sp/>be<sp/>included<sp/>in<sp/>equality<sp/>fields:<sp/>&apos;%s&apos;&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partitionField,</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1_1Builder_1aac330e1d657b4b3ce4cc532ff8488e9b" kindref="member">equalityFieldColumns</ref>);</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>input.keyBy(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>PartitionKeySelector(partitionSpec,<sp/>iSchema,<sp/>flinkRowType));</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="549"><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>RANGE:</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(equalityFieldIds.isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a1965688f0f1656bb5056da30e7ecd04a" kindref="member">LOG</ref>.warn(</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Fallback<sp/>to<sp/>use<sp/>&apos;none&apos;<sp/>distribution<sp/>mode,<sp/>because<sp/>there<sp/>are<sp/>no<sp/>equality<sp/>fields<sp/>set<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;and<sp/>{}=range<sp/>is<sp/>not<sp/>supported<sp/>yet<sp/>in<sp/>flink&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WRITE_DISTRIBUTION_MODE);</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>input;</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a1965688f0f1656bb5056da30e7ecd04a" kindref="member">LOG</ref>.info(</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Distribute<sp/>rows<sp/>by<sp/>equality<sp/>fields,<sp/>because<sp/>there<sp/>are<sp/>equality<sp/>fields<sp/>set<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;and{}=range<sp/>is<sp/>not<sp/>supported<sp/>yet<sp/>in<sp/>flink&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WRITE_DISTRIBUTION_MODE);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>input.keyBy(</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>EqualityFieldKeySelector(iSchema,<sp/>flinkRowType,<sp/>equalityFieldIds));</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>RuntimeException(</highlight><highlight class="stringliteral">&quot;Unrecognized<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>WRITE_DISTRIBUTION_MODE<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>writeMode);</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>RowType<sp/>toFlinkRowType(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>schema,<sp/>TableSchema<sp/>requestedSchema)<sp/>{</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(requestedSchema<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Convert<sp/>the<sp/>flink<sp/>schema<sp/>to<sp/>iceberg<sp/>schema<sp/>firstly,<sp/>then<sp/>reassign<sp/>ids<sp/>to<sp/>match<sp/>the<sp/>existing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>iceberg<sp/>schema.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>writeSchema<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil" kindref="compound">TypeUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil_1a411f188f2e54fd72d5543b14640898b4" kindref="member">reassignIds</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkSchemaUtil" kindref="compound">FlinkSchemaUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkSchemaUtil_1a04546f72b934d7c55a23a21d381b4906" kindref="member">convert</ref>(requestedSchema),<sp/>schema);</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil" kindref="compound">TypeUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil_1a4820ebba730953fde00ea4b510ebce31" kindref="member">validateWriteSchema</ref>(schema,<sp/>writeSchema,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="578"><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>use<sp/>this<sp/>flink<sp/>schema<sp/>to<sp/>read<sp/>values<sp/>from<sp/>RowData.<sp/>The<sp/>flink&apos;s<sp/>TINYINT<sp/>and<sp/>SMALLINT<sp/>will</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>be<sp/>promoted<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>iceberg<sp/>INTEGER,<sp/>that<sp/>means<sp/>if<sp/>we<sp/>use<sp/>iceberg&apos;s<sp/>table<sp/>schema<sp/>to<sp/>read<sp/>TINYINT<sp/>(backend<sp/>by<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>&apos;byte&apos;),<sp/>we<sp/>will</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>read<sp/>4<sp/>bytes<sp/>rather<sp/>than<sp/>1<sp/>byte,<sp/>it<sp/>will<sp/>mess<sp/>up<sp/>the<sp/>byte<sp/>array<sp/>in<sp/>BinaryRowData.<sp/>So<sp/>here</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>must<sp/>use<sp/>flink</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>schema.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(RowType)<sp/>requestedSchema.toRowDataType().getLogicalType();</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkSchemaUtil" kindref="compound">FlinkSchemaUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkSchemaUtil_1a04546f72b934d7c55a23a21d381b4906" kindref="member">convert</ref>(schema);</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="591"><highlight class="normal"></highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>IcebergStreamWriter&lt;RowData&gt;<sp/>createStreamWriter(</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SerializableSupplier&lt;Table&gt;<sp/>tableSupplier,</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>FlinkWriteConf<sp/>flinkWriteConf,</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>RowType<sp/>flinkRowType,</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Integer&gt;<sp/>equalityFieldIds)<sp/>{</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(tableSupplier<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Iceberg<sp/>table<sp/>supplier<sp/>shouldn&apos;t<sp/>be<sp/>null&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/>Table<sp/>initTable<sp/>=<sp/>tableSupplier.get();</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/>FileFormat<sp/>format<sp/>=<sp/>flinkWriteConf.dataFileFormat();</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>TaskWriterFactory&lt;RowData&gt;<sp/>taskWriterFactory<sp/>=</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>RowDataTaskWriterFactory(</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tableSupplier,</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flinkRowType,</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flinkWriteConf.targetDataFileSize(),</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>format,</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>(initTable,<sp/>format,<sp/>flinkWriteConf),</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>equalityFieldIds,</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flinkWriteConf.upsertMode());</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>IcebergStreamWriter&lt;&gt;(initTable.name(),<sp/>taskWriterFactory);</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="613"><highlight class="normal"></highlight></codeline>
<codeline lineno="623" refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>(</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table" kindref="compound">Table</ref><sp/>table,<sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1FileFormat" kindref="compound">FileFormat</ref><sp/>format,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf" kindref="compound">FlinkWriteConf</ref><sp/>conf)<sp/>{</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref><sp/>=<sp/>Maps.newHashMap(table.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a6dc0d000ddb7a7285fc7fdc6383922d5" kindref="member">properties</ref>());</highlight></codeline>
<codeline lineno="626"><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(format)<sp/>{</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>PARQUET:</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>.put(PARQUET_COMPRESSION,<sp/>conf.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1abe8beb804293286398e6199c0d4c92eb" kindref="member">parquetCompressionCodec</ref>());</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>parquetCompressionLevel<sp/>=<sp/>conf.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a37aaa58250faa508309b623314a88567" kindref="member">parquetCompressionLevel</ref>();</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(parquetCompressionLevel<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>.put(PARQUET_COMPRESSION_LEVEL,<sp/>parquetCompressionLevel);</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="634"><highlight class="normal"></highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>AVRO:</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>.put(AVRO_COMPRESSION,<sp/>conf.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1afead5b885b3d4f45d6f9bac870e7b08d" kindref="member">avroCompressionCodec</ref>());</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>avroCompressionLevel<sp/>=<sp/>conf.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1ae33ec66cf448e8a1fee7ab78609487e4" kindref="member">avroCompressionLevel</ref>();</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(avroCompressionLevel<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>.put(AVRO_COMPRESSION_LEVEL,<sp/>conf.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1ae33ec66cf448e8a1fee7ab78609487e4" kindref="member">avroCompressionLevel</ref>());</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="642"><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1orc_1_1ORC" kindref="compound">ORC</ref>:</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>.put(ORC_COMPRESSION,<sp/>conf.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1afaa1dcc9cd5a5081c17e2812fd881e5d" kindref="member">orcCompressionCodec</ref>());</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>.put(ORC_COMPRESSION_STRATEGY,<sp/>conf.<ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1FlinkWriteConf_1a8e9e7c24b829ccd84929f70882f93855" kindref="member">orcCompressionStrategy</ref>());</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>IllegalArgumentException(String.format(</highlight><highlight class="stringliteral">&quot;Unknown<sp/>file<sp/>format<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>format));</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1FlinkSink_1a5df1bc2e9a76fc3200de24b436d63012" kindref="member">writeProperties</ref>;</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="654"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/FlinkSink.java"/>
  </compounddef>
</doxygen>
