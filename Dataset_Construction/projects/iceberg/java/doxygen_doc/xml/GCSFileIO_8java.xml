<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="GCSFileIO_8java" kind="file" language="Java">
    <compoundname>GCSFileIO.java</compoundname>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO" prot="public">org::apache::iceberg::gcp::gcs::GCSFileIO</innerclass>
    <innernamespace refid="namespaceorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs">org::apache::iceberg::gcp::gcs</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Licensed<sp/>to<sp/>the<sp/>Apache<sp/>Software<sp/>Foundation<sp/>(ASF)<sp/>under<sp/>one</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>or<sp/>more<sp/>contributor<sp/>license<sp/>agreements.<sp/><sp/>See<sp/>the<sp/>NOTICE<sp/>file</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>distributed<sp/>with<sp/>this<sp/>work<sp/>for<sp/>additional<sp/>information</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>regarding<sp/>copyright<sp/>ownership.<sp/><sp/>The<sp/>ASF<sp/>licenses<sp/>this<sp/>file</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>to<sp/>you<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>&quot;License&quot;);<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>with<sp/>the<sp/>License.<sp/><sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/><sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>Unless<sp/>required<sp/>by<sp/>applicable<sp/>law<sp/>or<sp/>agreed<sp/>to<sp/>in<sp/>writing,</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>software<sp/>distributed<sp/>under<sp/>the<sp/>License<sp/>is<sp/>distributed<sp/>on<sp/>an</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>&quot;AS<sp/>IS&quot;<sp/>BASIS,<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>KIND,<sp/>either<sp/>express<sp/>or<sp/>implied.<sp/><sp/>See<sp/>the<sp/>License<sp/>for<sp/>the</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and<sp/>limitations</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>under<sp/>the<sp/>License.</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">package<sp/></highlight><highlight class="normal">org.apache.iceberg.gcp.gcs;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.google.auth.oauth2.AccessToken;</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.google.auth.oauth2.OAuth2Credentials;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.google.cloud.NoCredentials;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.google.cloud.storage.Blob;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.google.cloud.storage.BlobId;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.google.cloud.storage.Storage;</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.google.cloud.storage.StorageOptions;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Map;</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.atomic.AtomicBoolean;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.stream.Stream;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1common_1_1DynConstructors" kindref="compound">DynConstructors</ref>;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1gcp" kindref="compound">gcp</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties" kindref="compound">GCPProperties</ref>;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1BulkDeletionFailureException" kindref="compound">BulkDeletionFailureException</ref>;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1DelegateFileIO" kindref="compound">DelegateFileIO</ref>;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1FileInfo" kindref="compound">FileInfo</ref>;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile" kindref="compound">InputFile</ref>;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile" kindref="compound">OutputFile</ref>;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1metrics" kindref="compound">metrics</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1metrics_1_1MetricsContext" kindref="compound">MetricsContext</ref>;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Iterators;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Streams;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1SerializableMap" kindref="compound">SerializableMap</ref>;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier</ref>;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.slf4j.Logger;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.slf4j.LoggerFactory;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="58" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO" refkind="compound"><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO" kindref="compound">GCSFileIO</ref><sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1DelegateFileIO" kindref="compound">DelegateFileIO</ref><sp/>{</highlight></codeline>
<codeline lineno="59" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a92b9d77456905aff58ac5b792b127951" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Logger<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a92b9d77456905aff58ac5b792b127951" kindref="member">LOG</ref><sp/>=<sp/>LoggerFactory.getLogger(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO" kindref="compound">GCSFileIO</ref>.class);</highlight></codeline>
<codeline lineno="60" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a58f6f83244d49534e9a9a4304e73b906" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a58f6f83244d49534e9a9a4304e73b906" kindref="member">DEFAULT_METRICS_IMPL</ref><sp/>=</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;org.apache.iceberg.hadoop.HadoopMetricsContext&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a28359309d6039040418315198b19327f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier&lt;Storage&gt;</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a28359309d6039040418315198b19327f" kindref="member">storageSupplier</ref>;</highlight></codeline>
<codeline lineno="64" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties" kindref="compound">GCPProperties</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>;</highlight></codeline>
<codeline lineno="65" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a122e3a5cb4a13598be762b78283e2b54" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">transient</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/>Storage<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a122e3a5cb4a13598be762b78283e2b54" kindref="member">storage</ref>;</highlight></codeline>
<codeline lineno="66" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a47376118a0a3632cc6ff231e35cf3fd4" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1metrics_1_1MetricsContext" kindref="compound">MetricsContext</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a47376118a0a3632cc6ff231e35cf3fd4" kindref="member">metrics</ref><sp/>=<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1metrics_1_1MetricsContext" kindref="compound">MetricsContext</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1metrics_1_1MetricsContext_1a999462f26c773f2ebaf375ad95aef5bb" kindref="member">nullMetrics</ref>();</highlight></codeline>
<codeline lineno="67" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a2eeb3ef182e76af6f42dc46ef236b293" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>AtomicBoolean<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a2eeb3ef182e76af6f42dc46ef236b293" kindref="member">isResourceClosed</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>AtomicBoolean(</highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="68" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0a7c66ced969a6a5795377b6a7d48ea7" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1SerializableMap" kindref="compound">SerializableMap&lt;String, String&gt;</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0a7c66ced969a6a5795377b6a7d48ea7" kindref="member">properties</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="75" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a79e9b0df9731ef542003ea5014b68728" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a79e9b0df9731ef542003ea5014b68728" kindref="member">GCSFileIO</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight></codeline>
<codeline lineno="86" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a79b0c8364c078c576cb3f5b18fb46755" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a79b0c8364c078c576cb3f5b18fb46755" kindref="member">GCSFileIO</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier&lt;Storage&gt;</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a28359309d6039040418315198b19327f" kindref="member">storageSupplier</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties" kindref="compound">GCPProperties</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>)<sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>this.storageSupplier<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a28359309d6039040418315198b19327f" kindref="member">storageSupplier</ref>;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>this.gcpProperties<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="92" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0b250720e888a1c9976835f8ed4c74ee" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile" kindref="compound">InputFile</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0b250720e888a1c9976835f8ed4c74ee" kindref="member">newInputFile</ref>(String<sp/>path)<sp/>{</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GCSInputFile.fromLocation(path,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adac9bb96bf1c2bf4e9d758b602036efd" kindref="member">client</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a47376118a0a3632cc6ff231e35cf3fd4" kindref="member">metrics</ref>);</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="97" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1af8480642618e19a467e3ecea32b56939" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile" kindref="compound">InputFile</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1af8480642618e19a467e3ecea32b56939" kindref="member">newInputFile</ref>(String<sp/>path,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>length)<sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GCSInputFile.fromLocation(path,<sp/>length,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adac9bb96bf1c2bf4e9d758b602036efd" kindref="member">client</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a47376118a0a3632cc6ff231e35cf3fd4" kindref="member">metrics</ref>);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="102" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1af5260e293735bdb577372645ff68b365" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile" kindref="compound">OutputFile</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1af5260e293735bdb577372645ff68b365" kindref="member">newOutputFile</ref>(String<sp/>path)<sp/>{</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>GCSOutputFile.fromLocation(path,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adac9bb96bf1c2bf4e9d758b602036efd" kindref="member">client</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a47376118a0a3632cc6ff231e35cf3fd4" kindref="member">metrics</ref>);</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="107" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1afc4b7612845bbd8a2b98d331b59ce5f2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1afc4b7612845bbd8a2b98d331b59ce5f2" kindref="member">deleteFile</ref>(String<sp/>path)<sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>There<sp/>is<sp/>no<sp/>specific<sp/>contract<sp/>about<sp/>whether<sp/>delete<sp/>should<sp/>fail</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>other<sp/>FileIO<sp/>providers<sp/>ignore<sp/>failure.<sp/><sp/>Log<sp/>the<sp/>failure<sp/>for</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>as<sp/>it<sp/>is<sp/>not<sp/>a<sp/>required<sp/>operation<sp/>for<sp/>Iceberg.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adac9bb96bf1c2bf4e9d758b602036efd" kindref="member">client</ref>().</highlight><highlight class="keyword">delete</highlight><highlight class="normal">(BlobId.fromGsUtilUri(path)))<sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a92b9d77456905aff58ac5b792b127951" kindref="member">LOG</ref>.warn(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>delete<sp/>path:<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>path);</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="117" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1ab5fe6fa33a146de11fa57c60d60a936c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1ab5fe6fa33a146de11fa57c60d60a936c" kindref="member">properties</ref>()<sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0a7c66ced969a6a5795377b6a7d48ea7" kindref="member">properties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1SerializableMap_1a269435a18ab7ca0ae2d8ac887934c7f3" kindref="member">immutableMap</ref>();</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adac9bb96bf1c2bf4e9d758b602036efd" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Storage<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adac9bb96bf1c2bf4e9d758b602036efd" kindref="member">client</ref>()<sp/>{</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a122e3a5cb4a13598be762b78283e2b54" kindref="member">storage</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">synchronized</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a122e3a5cb4a13598be762b78283e2b54" kindref="member">storage</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a122e3a5cb4a13598be762b78283e2b54" kindref="member">storage</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a28359309d6039040418315198b19327f" kindref="member">storageSupplier</ref>.get();</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a122e3a5cb4a13598be762b78283e2b54" kindref="member">storage</ref>;</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="133" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1ab086f94d929b5320479a6665a5180fdb" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1ab086f94d929b5320479a6665a5180fdb" kindref="member">initialize</ref>(Map&lt;String,<sp/>String&gt;<sp/>props)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>this.properties<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1SerializableMap" kindref="compound">SerializableMap</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1SerializableMap_1ac049302c17b6e2cd1ae32c4623d9b0ac" kindref="member">copyOf</ref>(props);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>this.gcpProperties<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties" kindref="compound">GCPProperties</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0a7c66ced969a6a5795377b6a7d48ea7" kindref="member">properties</ref>);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>this.storageSupplier<sp/>=</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>()<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>StorageOptions.Builder<sp/>builder<sp/>=<sp/>StorageOptions.newBuilder();</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties_1aa4da4946d6bd80cc9f06441cadc2a186" kindref="member">projectId</ref>().ifPresent(builder::setProjectId);</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties_1aa3afb2769e45b61a770a9f604121e64d" kindref="member">clientLibToken</ref>().ifPresent(builder::setClientLibToken);</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties_1a78d81ad5f75483765afadae51b666501" kindref="member">serviceHost</ref>().ifPresent(builder::setHost);</highlight></codeline>
<codeline lineno="144"><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Google<sp/>Cloud<sp/>APIs<sp/>default<sp/>to<sp/>automatically<sp/>detect<sp/>the<sp/>credentials<sp/>to<sp/>use,<sp/>which<sp/>is</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>most<sp/>cases<sp/>the<sp/>convenient<sp/>way,<sp/>especially<sp/>in<sp/>GCP.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>See<sp/>javadoc<sp/>of<sp/>com.google.auth.oauth2.GoogleCredentials.getApplicationDefault().</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties_1a1da34484c89cfc722481e3db56f1be2e" kindref="member">noAuth</ref>())<sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Explicitly<sp/>allow<sp/>&quot;no<sp/>credentials&quot;<sp/>for<sp/>testing<sp/>purposes.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>builder.setCredentials(NoCredentials.getInstance());</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties_1a1a130808d1c384b20585e59ec2182cac" kindref="member">oauth2Token</ref>()</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.ifPresent(</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>token<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Explicitly<sp/>configure<sp/>an<sp/>OAuth<sp/>token.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AccessToken<sp/>accessToken<sp/>=</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>AccessToken(token,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties_1a5431a99ed5cf1cd23f3c48d121956883" kindref="member">oauth2TokenExpiresAt</ref>().orElse(</highlight><highlight class="keyword">null</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>builder.setCredentials(OAuth2Credentials.create(accessToken));</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>builder.build().getService();</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>};</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1acaa7e8befcaaa6d2250d4611bbff8611" kindref="member">initMetrics</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0a7c66ced969a6a5795377b6a7d48ea7" kindref="member">properties</ref>);</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/>@SuppressWarnings(</highlight><highlight class="stringliteral">&quot;CatchBlockLogException&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="169" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1acaa7e8befcaaa6d2250d4611bbff8611" refkind="member"><highlight class="normal"><sp/><sp/>private<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1acaa7e8befcaaa6d2250d4611bbff8611" kindref="member">initMetrics</ref>(Map&lt;String,<sp/>String&gt;<sp/>props)<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Report<sp/>Hadoop<sp/>metrics<sp/>if<sp/>Hadoop<sp/>is<sp/>available</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1common_1_1DynConstructors" kindref="compound">DynConstructors</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1common_1_1DynConstructors_1_1Ctor" kindref="compound">Ctor</ref>&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1metrics_1_1MetricsContext" kindref="compound">MetricsContext</ref>&gt;<sp/>ctor<sp/>=</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1common_1_1DynConstructors" kindref="compound">DynConstructors</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1common_1_1DynConstructors_1a5a952884d9577debadb1c6deb6857899" kindref="member">builder</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1metrics_1_1MetricsContext" kindref="compound">MetricsContext</ref>.class)</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1common_1_1DynConstructors_1_1Builder_1af140dd1ab62130a574583630e6b5702e" kindref="member">hiddenImpl</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a58f6f83244d49534e9a9a4304e73b906" kindref="member">DEFAULT_METRICS_IMPL</ref>,<sp/>String.class)</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.buildChecked();</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1metrics_1_1MetricsContext" kindref="compound">MetricsContext</ref><sp/>context<sp/>=<sp/>ctor.newInstance(</highlight><highlight class="stringliteral">&quot;gcs&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>context.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1metrics_1_1MetricsContext_1a8863098ffb13d11b85ef6234695a1aee" kindref="member">initialize</ref>(props);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.metrics<sp/>=<sp/>context;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(NoClassDefFoundError<sp/>|<sp/>NoSuchMethodException<sp/>|<sp/>ClassCastException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a92b9d77456905aff58ac5b792b127951" kindref="member">LOG</ref>.warn(</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Unable<sp/>to<sp/>load<sp/>metrics<sp/>class:<sp/>&apos;{}&apos;,<sp/>falling<sp/>back<sp/>to<sp/>null<sp/>metrics&quot;</highlight><highlight class="normal">,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a58f6f83244d49534e9a9a4304e73b906" kindref="member">DEFAULT_METRICS_IMPL</ref>);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="186" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adf47dfdac6a54b8fb977b9bd04d3fc81" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adf47dfdac6a54b8fb977b9bd04d3fc81" kindref="member">close</ref>()<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>handles<sp/>concurrent<sp/>calls<sp/>to<sp/>close()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a2eeb3ef182e76af6f42dc46ef236b293" kindref="member">isResourceClosed</ref>.compareAndSet(</highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a122e3a5cb4a13598be762b78283e2b54" kindref="member">storage</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>GCS<sp/>Storage<sp/>does<sp/>not<sp/>appear<sp/>to<sp/>be<sp/>closable,<sp/>so<sp/>release<sp/>the<sp/>reference</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a122e3a5cb4a13598be762b78283e2b54" kindref="member">storage</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="197" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a274ac5005f826a6e914e24a55d8d3538" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Iterable&lt;FileInfo&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a274ac5005f826a6e914e24a55d8d3538" kindref="member">listPrefix</ref>(String<sp/>prefix)<sp/>{</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>GCSLocation<sp/>location<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>GCSLocation(prefix);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>()<sp/>-&gt;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adac9bb96bf1c2bf4e9d758b602036efd" kindref="member">client</ref>()</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.list(location.bucket(),<sp/>Storage.BlobListOption.prefix(location.prefix()))</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.streamAll()</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.map(</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blob<sp/>-&gt;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1FileInfo" kindref="compound">FileInfo</ref>(</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight><highlight class="stringliteral">&quot;gs://%s/%s&quot;</highlight><highlight class="normal">,<sp/>blob.getBucket(),<sp/>blob.getName()),</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>blob.getSize(),</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0384828a49af1ca7aac51ba402672204" kindref="member">createTimeMillis</ref>(blob)))</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.iterator();</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0384828a49af1ca7aac51ba402672204" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a0384828a49af1ca7aac51ba402672204" kindref="member">createTimeMillis</ref>(Blob<sp/>blob)<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(blob.getCreateTimeOffsetDateTime()<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>blob.getCreateTimeOffsetDateTime().toInstant().toEpochMilli();</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="220" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a9043d8d29c89da90ce63c5762fa86474" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a9043d8d29c89da90ce63c5762fa86474" kindref="member">deletePrefix</ref>(String<sp/>prefix)<sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1ac40c17ad64e9068c49fe63a930473868" kindref="member">internalDeleteFiles</ref>(</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Streams.stream(<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a274ac5005f826a6e914e24a55d8d3538" kindref="member">listPrefix</ref>(prefix))</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.map(fileInfo<sp/>-&gt;<sp/>BlobId.fromGsUtilUri(fileInfo.location())));</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="227" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1aff69bc16bbae591949576d611ff05a23" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1aff69bc16bbae591949576d611ff05a23" kindref="member">deleteFiles</ref>(Iterable&lt;String&gt;<sp/>pathsToDelete)<sp/></highlight><highlight class="keywordflow">throws</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1BulkDeletionFailureException" kindref="compound">BulkDeletionFailureException</ref><sp/>{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1ac40c17ad64e9068c49fe63a930473868" kindref="member">internalDeleteFiles</ref>(Streams.stream(pathsToDelete).map(BlobId::fromGsUtilUri));</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231" refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1ac40c17ad64e9068c49fe63a930473868" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1ac40c17ad64e9068c49fe63a930473868" kindref="member">internalDeleteFiles</ref>(Stream&lt;BlobId&gt;<sp/>blobIdsToDelete)<sp/>{</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/>Streams.stream(Iterators.partition(blobIdsToDelete.iterator(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1a316f61655e4c7fad67e395c0218b2320" kindref="member">gcpProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1GCPProperties_1ae1c190e8099cd8c40504beba3fd2d428" kindref="member">deleteBatchSize</ref>()))</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.forEach(batch<sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1gcp_1_1gcs_1_1GCSFileIO_1adac9bb96bf1c2bf4e9d758b602036efd" kindref="member">client</ref>().</highlight><highlight class="keyword">delete</highlight><highlight class="normal">(batch));</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="gcp/src/main/java/org/apache/iceberg/gcp/gcs/GCSFileIO.java"/>
  </compounddef>
</doxygen>
