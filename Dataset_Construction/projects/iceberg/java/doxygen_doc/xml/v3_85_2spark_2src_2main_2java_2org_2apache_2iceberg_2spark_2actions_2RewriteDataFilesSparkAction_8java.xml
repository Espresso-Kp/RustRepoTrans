<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="v3_85_2spark_2src_2main_2java_2org_2apache_2iceberg_2spark_2actions_2RewriteDataFilesSparkAction_8java" kind="file" language="Java">
    <compoundname>RewriteDataFilesSparkAction.java</compoundname>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction" prot="public">org::apache::iceberg::spark::actions::RewriteDataFilesSparkAction</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1_1RewriteExecutionContext" prot="package">org::apache::iceberg::spark::actions::RewriteDataFilesSparkAction::RewriteExecutionContext</innerclass>
    <innernamespace refid="namespaceorg_1_1apache_1_1iceberg_1_1spark_1_1actions">org::apache::iceberg::spark::actions</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Licensed<sp/>to<sp/>the<sp/>Apache<sp/>Software<sp/>Foundation<sp/>(ASF)<sp/>under<sp/>one</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>or<sp/>more<sp/>contributor<sp/>license<sp/>agreements.<sp/><sp/>See<sp/>the<sp/>NOTICE<sp/>file</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>distributed<sp/>with<sp/>this<sp/>work<sp/>for<sp/>additional<sp/>information</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>regarding<sp/>copyright<sp/>ownership.<sp/><sp/>The<sp/>ASF<sp/>licenses<sp/>this<sp/>file</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>to<sp/>you<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>&quot;License&quot;);<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>with<sp/>the<sp/>License.<sp/><sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/><sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>Unless<sp/>required<sp/>by<sp/>applicable<sp/>law<sp/>or<sp/>agreed<sp/>to<sp/>in<sp/>writing,</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>software<sp/>distributed<sp/>under<sp/>the<sp/>License<sp/>is<sp/>distributed<sp/>on<sp/>an</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>&quot;AS<sp/>IS&quot;<sp/>BASIS,<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>KIND,<sp/>either<sp/>express<sp/>or<sp/>implied.<sp/><sp/>See<sp/>the<sp/>License<sp/>for<sp/>the</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and<sp/>limitations</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>under<sp/>the<sp/>License.</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">package<sp/></highlight><highlight class="normal">org.apache.iceberg.spark.actions;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.IOException;</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.math.RoundingMode;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Arrays;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Collection;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.List;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Map;</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Set;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.ConcurrentLinkedQueue;</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.ExecutorService;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.Executors;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.ThreadPoolExecutor;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.atomic.AtomicInteger;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.stream.Collectors;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.stream.Stream;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref>;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1FileScanTask" kindref="compound">FileScanTask</ref>;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1RewriteJobOrder" kindref="compound">RewriteJobOrder</ref>;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref>;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table" kindref="compound">Table</ref>;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1actions" kindref="compound">actions</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1FileRewriter" kindref="compound">FileRewriter</ref>;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1actions" kindref="compound">actions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles" kindref="compound">ImmutableRewriteDataFiles</ref>;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1actions" kindref="compound">actions</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles" kindref="compound">RewriteDataFiles</ref>;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1actions" kindref="compound">actions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager" kindref="compound">RewriteDataFilesCommitManager</ref>;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1actions" kindref="compound">actions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup" kindref="compound">RewriteFileGroup</ref>;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1data" kindref="compound">data</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1data_1_1GenericRecord" kindref="compound">GenericRecord</ref>;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1exceptions" kindref="compound">exceptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1CommitFailedException" kindref="compound">CommitFailedException</ref>;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1exceptions" kindref="compound">exceptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>;</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1expressions" kindref="compound">expressions</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref>;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1expressions" kindref="compound">expressions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions" kindref="compound">Expressions</ref>;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1CloseableIterable" kindref="compound">CloseableIterable</ref>;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.annotations.VisibleForTesting;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.base.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1base_1_1Preconditions" kindref="compound">Preconditions</ref>;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.ImmutableList;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.ImmutableSet;</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Lists;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1collect_1_1Maps" kindref="compound">Maps</ref>;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Queues;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1collect_1_1Sets" kindref="compound">Sets</ref>;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.math.IntMath;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.util.concurrent.MoreExecutors;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.util.concurrent.ThreadFactoryBuilder;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1types" kindref="compound">types</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types" kindref="compound">Types</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1StructType" kindref="compound">StructType</ref>;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap</ref>;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks" kindref="compound">Tasks</ref>;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.SparkSession;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.internal.SQLConf;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.slf4j.Logger;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.slf4j.LoggerFactory;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">RewriteDataFilesSparkAction</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>BaseSnapshotUpdateSparkAction&lt;RewriteDataFilesSparkAction&gt;<sp/>implements<sp/>RewriteDataFiles<sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Logger<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3c76743f9a1ea7f31643a6aedfd186f4" kindref="member">LOG</ref><sp/>=<sp/>LoggerFactory.getLogger(RewriteDataFilesSparkAction.class);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Set&lt;String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a6920f39ec89c4079e700b253cb8e8416" kindref="member">VALID_OPTIONS</ref><sp/>=</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableSet.of(</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a25c9e1979d5699d2b572185409392b79" kindref="member">MAX_CONCURRENT_FILE_GROUP_REWRITES</ref>,</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1aadf8107a49500c9c9a67f2e390a105a7" kindref="member">MAX_FILE_GROUP_SIZE_BYTES</ref>,</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a80c92481ed2c97677ea68d9e27faaea0" kindref="member">PARTIAL_PROGRESS_ENABLED</ref>,</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a792298ea627c7a4dfe368946dc1f0186" kindref="member">PARTIAL_PROGRESS_MAX_COMMITS</ref>,</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a77e6cfa8ef7130d3f0acc65bd48ac743" kindref="member">PARTIAL_PROGRESS_MAX_FAILED_COMMITS</ref>,</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a9cfad14acde2bda45229e8998cf37baf" kindref="member">TARGET_FILE_SIZE_BYTES</ref>,</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1acbac59660c1162644fc3eba73ff61329" kindref="member">USE_STARTING_SEQUENCE_NUMBER</ref>,</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a692f9279478e8e3619a3a08f2d455fca" kindref="member">REWRITE_JOB_ORDER</ref>,</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a4a7e332a5b1033af1901e56f601b1c6a" kindref="member">OUTPUT_SPEC_ID</ref>);</highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>RewriteDataFilesSparkAction.Result<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a9a96559c27ac173ac47f010f799cc35d" kindref="member">EMPTY_RESULT</ref><sp/>=</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableRewriteDataFiles.Result.builder().rewriteResults(ImmutableList.of()).build();</highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Table<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Expression<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a5b2586fe1ffe2ccf5863b5911112cff4" kindref="member">filter</ref><sp/>=<sp/>Expressions.alwaysTrue();</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4d4bf89bbc8dae1d49d4b93113857faa" kindref="member">maxConcurrentFileGroupRewrites</ref>;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aaf42595de165e54948aaf223852a9bdd" kindref="member">maxCommits</ref>;</highlight></codeline>
<codeline lineno="96" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acdb6f82df7a8a7a3b7a21f01dfcbd988" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acdb6f82df7a8a7a3b7a21f01dfcbd988" kindref="member">maxFailedCommits</ref>;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aa4652465f54af7a4736ae91cdd01c304" kindref="member">partialProgressEnabled</ref>;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1af39d17bc8a1b7a9d6f1c577a1c2eaeaf" kindref="member">useStartingSequenceNumber</ref>;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1RewriteJobOrder" kindref="compound">RewriteJobOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a9fd4436ec3cc807e6928f4bbf61a6a35" kindref="member">rewriteJobOrder</ref>;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1FileRewriter" kindref="compound">FileRewriter&lt;FileScanTask, DataFile&gt;</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction" kindref="compound">RewriteDataFilesSparkAction</ref>(SparkSession<sp/>spark,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table" kindref="compound">Table</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>super(spark.cloneSession());</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Disable<sp/>Adaptive<sp/>Query<sp/>Execution<sp/>as<sp/>this<sp/>may<sp/>change<sp/>the<sp/>output<sp/>partitioning<sp/>of<sp/>our<sp/>write</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/>spark().conf().set(SQLConf.ADAPTIVE_EXECUTION_ENABLED().key(),<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>this.table<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="110" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a05b5524090397a716089f772a80f0016" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">protected</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction" kindref="compound">RewriteDataFilesSparkAction</ref><sp/></highlight><highlight class="keyword">self</highlight><highlight class="normal">()<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="115" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a9f7e1aa6a0b6f30596490a1611ff9ebd" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction" kindref="compound">RewriteDataFilesSparkAction</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a9f7e1aa6a0b6f30596490a1611ff9ebd" kindref="member">binPack</ref>()<sp/>{</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Must<sp/>use<sp/>only<sp/>one<sp/>rewriter<sp/>type<sp/>(bin-pack,<sp/>sort,<sp/>zorder)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>this.rewriter<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SparkBinPackDataRewriter(spark(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="123" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aafe0247605506187983c969b6a9ee726" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction" kindref="compound">RewriteDataFilesSparkAction</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aafe0247605506187983c969b6a9ee726" kindref="member">sort</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>sortOrder)<sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Must<sp/>use<sp/>only<sp/>one<sp/>rewriter<sp/>type<sp/>(bin-pack,<sp/>sort,<sp/>zorder)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>this.rewriter<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SparkSortDataRewriter(spark(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>,<sp/>sortOrder);</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="131" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3b3a867c6d62678f2b830248228e7f96" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction" kindref="compound">RewriteDataFilesSparkAction</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3b3a867c6d62678f2b830248228e7f96" kindref="member">sort</ref>()<sp/>{</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Must<sp/>use<sp/>only<sp/>one<sp/>rewriter<sp/>type<sp/>(bin-pack,<sp/>sort,<sp/>zorder)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>this.rewriter<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SparkSortDataRewriter(spark(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="139" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1ac08d4e5c0bb4cc76678731764a9316e0" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction" kindref="compound">RewriteDataFilesSparkAction</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1ac08d4e5c0bb4cc76678731764a9316e0" kindref="member">zOrder</ref>(String...<sp/>columnNames)<sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Must<sp/>use<sp/>only<sp/>one<sp/>rewriter<sp/>type<sp/>(bin-pack,<sp/>sort,<sp/>zorder)&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>this.rewriter<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SparkZOrderDataRewriter(spark(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>,<sp/>Arrays.asList(columnNames));</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="147" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4a18364af82fa46330aadd9cd7e68a35" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction" kindref="compound">RewriteDataFilesSparkAction</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4a18364af82fa46330aadd9cd7e68a35" kindref="member">filter</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref><sp/>expression)<sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a5b2586fe1ffe2ccf5863b5911112cff4" kindref="member">filter</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions" kindref="compound">Expressions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions_1ab5f3130e4b4bc72d48c2c120cabf2193" kindref="member">and</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a5b2586fe1ffe2ccf5863b5911112cff4" kindref="member">filter</ref>,<sp/>expression);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="153" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a6641dbd84d025fe2993973a518499191" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles" kindref="compound">RewriteDataFiles</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1_1Result" kindref="compound">Result</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a6641dbd84d025fe2993973a518499191" kindref="member">execute</ref>()<sp/>{</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a5c4df259908bf1a7e85b7264de73f943" kindref="member">currentSnapshot</ref>()<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a9a96559c27ac173ac47f010f799cc35d" kindref="member">EMPTY_RESULT</ref>;</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>startingSnapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a5c4df259908bf1a7e85b7264de73f943" kindref="member">currentSnapshot</ref>().<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1aad24e075e95dfc00842c2eea7081154a" kindref="member">snapshotId</ref>();</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Default<sp/>to<sp/>BinPack<sp/>if<sp/>no<sp/>strategy<sp/>selected</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(this.rewriter<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.rewriter<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>SparkBinPackDataRewriter(spark(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>);</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/>validateAndInitOptions();</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap&lt;List&lt;List&lt;FileScanTask&gt;</ref>&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4b2b91802aa47e962da9f204b5899c33" kindref="member">fileGroupsByPartition</ref><sp/>=</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>planFileGroups(startingSnapshotId);</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>RewriteExecutionContext<sp/>ctx<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>RewriteExecutionContext(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4b2b91802aa47e962da9f204b5899c33" kindref="member">fileGroupsByPartition</ref>);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ctx.totalGroupCount()<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3c76743f9a1ea7f31643a6aedfd186f4" kindref="member">LOG</ref>.info(</highlight><highlight class="stringliteral">&quot;Nothing<sp/>found<sp/>to<sp/>rewrite<sp/>in<sp/>{}&quot;</highlight><highlight class="normal">,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1ac3bd999ff367dc8f622ca14e9b85277e" kindref="member">name</ref>());</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a9a96559c27ac173ac47f010f799cc35d" kindref="member">EMPTY_RESULT</ref>;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>Stream&lt;RewriteFileGroup&gt;<sp/>groupStream<sp/>=<sp/>toGroupStream(ctx,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4b2b91802aa47e962da9f204b5899c33" kindref="member">fileGroupsByPartition</ref>);</highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aa4652465f54af7a4736ae91cdd01c304" kindref="member">partialProgressEnabled</ref>)<sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a2f79cb4342e57f660c27af77234f5cf7" kindref="member">doExecuteWithPartialProgress</ref>(ctx,<sp/>groupStream,<sp/>commitManager(startingSnapshotId));</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a5866d37075f0657d702a74854e7bd7e8" kindref="member">doExecute</ref>(ctx,<sp/>groupStream,<sp/>commitManager(startingSnapshotId));</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap&lt;List&lt;List&lt;FileScanTask&gt;</ref>&gt;&gt;<sp/>planFileGroups(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>startingSnapshotId)<sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1CloseableIterable" kindref="compound">CloseableIterable&lt;FileScanTask&gt;</ref><sp/>fileScanTasks<sp/>=</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a1d059631f06e0bf08f1be5e6e921fc23" kindref="member">newScan</ref>()</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1TableScan_1a48bcb69c9aa85d603dbbf56f9b219c58" kindref="member">useSnapshot</ref>(startingSnapshotId)</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Scan_1afa54ee3e31aa55e0519d8af3e5a18f27" kindref="member">filter</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a5b2586fe1ffe2ccf5863b5911112cff4" kindref="member">filter</ref>)</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.ignoreResiduals()</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.planFiles();</highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1StructType" kindref="compound">StructType</ref><sp/>partitionType<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a896bd81a171a850db849109694a5b9ce" kindref="member">spec</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a276cbb9b64c6be830314d70e412cb554" kindref="member">partitionType</ref>();</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap&lt;List&lt;FileScanTask&gt;</ref>&gt;<sp/>filesByPartition<sp/>=</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1ad393a4edf3d256641c88895b2b569d98" kindref="member">groupByPartition</ref>(partitionType,<sp/>fileScanTasks);</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4b2b91802aa47e962da9f204b5899c33" kindref="member">fileGroupsByPartition</ref>(filesByPartition);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">finally</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fileScanTasks.close();</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(IOException<sp/>io)<sp/>{</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3c76743f9a1ea7f31643a6aedfd186f4" kindref="member">LOG</ref>.error(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>properly<sp/>close<sp/>file<sp/>iterable<sp/>while<sp/>planning<sp/>for<sp/>rewrite&quot;</highlight><highlight class="normal">,<sp/>io);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1ad393a4edf3d256641c88895b2b569d98" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap&lt;List&lt;FileScanTask&gt;</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1ad393a4edf3d256641c88895b2b569d98" kindref="member">groupByPartition</ref>(</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1StructType" kindref="compound">StructType</ref><sp/>partitionType,<sp/>Iterable&lt;FileScanTask&gt;<sp/>tasks)<sp/>{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap&lt;List&lt;FileScanTask&gt;</ref>&gt;<sp/>filesByPartition<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap_1a6593a952a009b00aab56c8163ee389ff" kindref="member">create</ref>(partitionType);</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref><sp/>emptyStruct<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1data_1_1GenericRecord" kindref="compound">GenericRecord</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1data_1_1GenericRecord_1a791a2398c2c045bbcc2c874137051fa6" kindref="member">create</ref>(partitionType);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1FileScanTask" kindref="compound">FileScanTask</ref><sp/>task<sp/>:<sp/>tasks)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>a<sp/>task<sp/>uses<sp/>an<sp/>incompatible<sp/>partition<sp/>spec<sp/>the<sp/>data<sp/>inside<sp/>could<sp/>contain<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>which<sp/>belong<sp/>to<sp/>multiple<sp/>partitions<sp/>in<sp/>the<sp/>current<sp/>spec.<sp/>Treating<sp/>all<sp/>such<sp/>files<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>un-partitioned<sp/>and<sp/>grouping<sp/>them<sp/>together<sp/>helps<sp/>to<sp/>minimize<sp/>new<sp/>files<sp/>made.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref><sp/>taskPartition<sp/>=</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>task.file().specId()<sp/>==<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a896bd81a171a850db849109694a5b9ce" kindref="member">spec</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a717532406f4cf60207b057607b89c0ec" kindref="member">specId</ref>()<sp/>?<sp/>task.file().partition()<sp/>:<sp/>emptyStruct;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;FileScanTask&gt;<sp/>files<sp/>=<sp/>filesByPartition.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap_1aba75cb3361119476bc291c2e75118204" kindref="member">get</ref>(taskPartition);</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(files<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>files<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>files.add(task);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>filesByPartition.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap_1ac522195be155fdc3cc236fcc68f7dd40" kindref="member">put</ref>(taskPartition,<sp/>files);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>filesByPartition;</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4b2b91802aa47e962da9f204b5899c33" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap&lt;List&lt;List&lt;FileScanTask&gt;</ref>&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4b2b91802aa47e962da9f204b5899c33" kindref="member">fileGroupsByPartition</ref>(</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap</ref>&lt;List&lt;FileScanTask&gt;&gt;<sp/>filesByPartition)<sp/>{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>filesByPartition.transformValues(this::planFileGroups);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1461aaad352724951ed90bf68d58dd36" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>List&lt;List&lt;FileScanTask&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1461aaad352724951ed90bf68d58dd36" kindref="member">planFileGroups</ref>(List&lt;FileScanTask&gt;<sp/>tasks)<sp/>{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ImmutableList.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref>.planFileGroups(tasks));</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/>@VisibleForTesting</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup" kindref="compound">RewriteFileGroup</ref><sp/>rewriteFiles(RewriteExecutionContext<sp/>ctx,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup" kindref="compound">RewriteFileGroup</ref><sp/>fileGroup)<sp/>{</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>String<sp/>desc<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a993857ba71ba97a1c871af6c38e9a4b6" kindref="member">jobDesc</ref>(fileGroup,<sp/>ctx);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>Set&lt;DataFile&gt;<sp/>addedFiles<sp/>=</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>withJobGroupInfo(</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newJobGroupInfo(</highlight><highlight class="stringliteral">&quot;REWRITE-DATA-FILES&quot;</highlight><highlight class="normal">,<sp/>desc),</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>()<sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref>.rewrite(fileGroup.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1affd647d5e57695cea6202f4063470545" kindref="member">fileScans</ref>()));</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>fileGroup.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1acff627a9bc2eebfdeb85b26ff0fd6bcb" kindref="member">setOutputFiles</ref>(addedFiles);</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3c76743f9a1ea7f31643a6aedfd186f4" kindref="member">LOG</ref>.info(</highlight><highlight class="stringliteral">&quot;Rewrite<sp/>Files<sp/>Ready<sp/>to<sp/>be<sp/>Committed<sp/>-<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>desc);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>fileGroup;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight></codeline>
<codeline lineno="253" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>ExecutorService<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref>()<sp/>{</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>MoreExecutors.getExitingExecutorService(</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(ThreadPoolExecutor)</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Executors.newFixedThreadPool(</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4d4bf89bbc8dae1d49d4b93113857faa" kindref="member">maxConcurrentFileGroupRewrites</ref>,</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>ThreadFactoryBuilder().setNameFormat(</highlight><highlight class="stringliteral">&quot;Rewrite-Service-%d&quot;</highlight><highlight class="normal">).build()));</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/>@VisibleForTesting</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager" kindref="compound">RewriteDataFilesCommitManager</ref><sp/>commitManager(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>startingSnapshotId)<sp/>{</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager" kindref="compound">RewriteDataFilesCommitManager</ref>(</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>,<sp/>startingSnapshotId,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1af39d17bc8a1b7a9d6f1c577a1c2eaeaf" kindref="member">useStartingSequenceNumber</ref>,<sp/>commitSummary());</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight></codeline>
<codeline lineno="267" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a5866d37075f0657d702a74854e7bd7e8" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1_1Result" kindref="compound">Result</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a5866d37075f0657d702a74854e7bd7e8" kindref="member">doExecute</ref>(</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>RewriteExecutionContext<sp/>ctx,</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Stream&lt;RewriteFileGroup&gt;<sp/>groupStream,</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager" kindref="compound">RewriteDataFilesCommitManager</ref><sp/>commitManager)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/>ExecutorService<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref>();</highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>ConcurrentLinkedQueue&lt;RewriteFileGroup&gt;<sp/>rewrittenGroups<sp/>=<sp/>Queues.newConcurrentLinkedQueue();</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks" kindref="compound">Tasks</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks_1_1Builder" kindref="compound">Builder</ref>&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup" kindref="compound">RewriteFileGroup</ref>&gt;<sp/>rewriteTaskBuilder<sp/>=</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks" kindref="compound">Tasks</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks_1a4e02a04c6d01b1feceec7c0b1b4fbf12" kindref="member">foreach</ref>(groupStream)</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.executeWith(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref>)</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.stopOnFailure()</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.noRetry()</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.onFailure(</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(fileGroup,<sp/>exception)<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3c76743f9a1ea7f31643a6aedfd186f4" kindref="member">LOG</ref>.warn(</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Failure<sp/>during<sp/>rewrite<sp/>process<sp/>for<sp/>group<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>fileGroup.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1af533eaba586f2f61c36c41ea0c7099fb" kindref="member">info</ref>(),<sp/>exception);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rewriteTaskBuilder.run(</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fileGroup<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rewrittenGroups.add(rewriteFiles(ctx,<sp/>fileGroup));</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>});</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>At<sp/>least<sp/>one<sp/>rewrite<sp/>group<sp/>failed,<sp/>clean<sp/>up<sp/>all<sp/>completed<sp/>rewrites</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3c76743f9a1ea7f31643a6aedfd186f4" kindref="member">LOG</ref>.error(</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>complete<sp/>rewrite,<sp/>{}<sp/>is<sp/>not<sp/>enabled<sp/>and<sp/>one<sp/>of<sp/>the<sp/>file<sp/>set<sp/>groups<sp/>failed<sp/>to<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;be<sp/>rewritten.<sp/>This<sp/>error<sp/>occurred<sp/>during<sp/>the<sp/>writing<sp/>of<sp/>new<sp/>files,<sp/>not<sp/>during<sp/>the<sp/>commit<sp/>process.<sp/>This<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;indicates<sp/>something<sp/>is<sp/>wrong<sp/>that<sp/>doesn&apos;t<sp/>involve<sp/>conflicts<sp/>with<sp/>other<sp/>Iceberg<sp/>operations.<sp/>Enabling<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;{}<sp/>may<sp/>help<sp/>in<sp/>this<sp/>case<sp/>but<sp/>the<sp/>root<sp/>cause<sp/>should<sp/>be<sp/>investigated.<sp/>Cleaning<sp/>up<sp/>{}<sp/>groups<sp/>which<sp/>finished<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;being<sp/>written.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a80c92481ed2c97677ea68d9e27faaea0" kindref="member">PARTIAL_PROGRESS_ENABLED</ref>,</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a80c92481ed2c97677ea68d9e27faaea0" kindref="member">PARTIAL_PROGRESS_ENABLED</ref>,</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rewrittenGroups.size(),</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>e);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks" kindref="compound">Tasks</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks_1a4e02a04c6d01b1feceec7c0b1b4fbf12" kindref="member">foreach</ref>(rewrittenGroups)</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.suppressFailureWhenFinished()</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.run(commitManager::abortFileGroup);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>e;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">finally</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref>.shutdown();</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>commitManager.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager_1adffe7fcfe8419507c4b7ba26220acad1" kindref="member">commitOrClean</ref>(Sets.newHashSet(rewrittenGroups));</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref><sp/>|<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1CommitFailedException" kindref="compound">CommitFailedException</ref><sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>errorMessage<sp/>=</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>commit<sp/>rewrite<sp/>because<sp/>of<sp/>a<sp/>ValidationException<sp/>or<sp/>CommitFailedException.<sp/>This<sp/>usually<sp/>means<sp/>that<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;this<sp/>rewrite<sp/>has<sp/>conflicted<sp/>with<sp/>another<sp/>concurrent<sp/>Iceberg<sp/>operation.<sp/>To<sp/>reduce<sp/>the<sp/>likelihood<sp/>of<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;conflicts,<sp/>set<sp/>%s<sp/>which<sp/>will<sp/>break<sp/>up<sp/>the<sp/>rewrite<sp/>into<sp/>multiple<sp/>smaller<sp/>commits<sp/>controlled<sp/>by<sp/>%s.<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;Separate<sp/>smaller<sp/>rewrite<sp/>commits<sp/>can<sp/>succeed<sp/>independently<sp/>while<sp/>any<sp/>commits<sp/>that<sp/>conflict<sp/>with<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;another<sp/>Iceberg<sp/>operation<sp/>will<sp/>be<sp/>ignored.<sp/>This<sp/>mode<sp/>will<sp/>create<sp/>additional<sp/>snapshots<sp/>in<sp/>the<sp/>table<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;history,<sp/>one<sp/>for<sp/>each<sp/>commit.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a80c92481ed2c97677ea68d9e27faaea0" kindref="member">PARTIAL_PROGRESS_ENABLED</ref>,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a792298ea627c7a4dfe368946dc1f0186" kindref="member">PARTIAL_PROGRESS_MAX_COMMITS</ref>);</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>RuntimeException(errorMessage,<sp/>e);</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;FileGroupRewriteResult&gt;<sp/>rewriteResults<sp/>=</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rewrittenGroups.stream().map(<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1a359f412d070ed5fd4fa9094cda0980e3" kindref="member">RewriteFileGroup::asResult</ref>).collect(Collectors.toList());</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles" kindref="compound">ImmutableRewriteDataFiles</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles_1_1Result" kindref="compound">Result</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles_1_1Result_1a5ea4139befcb9dfd562ce3cb970b2d67" kindref="member">builder</ref>().rewriteResults(rewriteResults).build();</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a2f79cb4342e57f660c27af77234f5cf7" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1_1Result" kindref="compound">Result</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a2f79cb4342e57f660c27af77234f5cf7" kindref="member">doExecuteWithPartialProgress</ref>(</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>RewriteExecutionContext<sp/>ctx,</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Stream&lt;RewriteFileGroup&gt;<sp/>groupStream,</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager" kindref="compound">RewriteDataFilesCommitManager</ref><sp/>commitManager)<sp/>{</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>ExecutorService<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref>();</highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>start<sp/>commit<sp/>service</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>groupsPerCommit<sp/>=<sp/>IntMath.divide(ctx.totalGroupCount(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aaf42595de165e54948aaf223852a9bdd" kindref="member">maxCommits</ref>,<sp/>RoundingMode.CEILING);</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager" kindref="compound">RewriteDataFilesCommitManager</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager_1_1CommitService" kindref="compound">CommitService</ref><sp/>commitService<sp/>=</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>commitManager.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFilesCommitManager_1a33446d13eb796b41232d7ebd1308aa79" kindref="member">service</ref>(groupsPerCommit);</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>commitService.start();</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/>Collection&lt;FileGroupFailureResult&gt;<sp/>rewriteFailures<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>ConcurrentLinkedQueue&lt;&gt;();</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>start<sp/>rewrite<sp/>tasks</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks" kindref="compound">Tasks</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Tasks_1a4e02a04c6d01b1feceec7c0b1b4fbf12" kindref="member">foreach</ref>(groupStream)</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.suppressFailureWhenFinished()</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.executeWith(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref>)</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.noRetry()</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.onFailure(</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(fileGroup,<sp/>exception)<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3c76743f9a1ea7f31643a6aedfd186f4" kindref="member">LOG</ref>.error(</highlight><highlight class="stringliteral">&quot;Failure<sp/>during<sp/>rewrite<sp/>group<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>fileGroup.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1af533eaba586f2f61c36c41ea0c7099fb" kindref="member">info</ref>(),<sp/>exception);</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rewriteFailures.add(</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles" kindref="compound">ImmutableRewriteDataFiles</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles_1_1FileGroupFailureResult" kindref="compound">FileGroupFailureResult</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles_1_1FileGroupFailureResult_1a0bc74bc875f049ecc65e431f61882e40" kindref="member">builder</ref>()</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.info(fileGroup.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1af533eaba586f2f61c36c41ea0c7099fb" kindref="member">info</ref>())</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.dataFilesCount(fileGroup.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1aa6b3d1ae5db8336f96640879f469eca6" kindref="member">numFiles</ref>())</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.build());</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.run(fileGroup<sp/>-&gt;<sp/>commitService.offer(rewriteFiles(ctx,<sp/>fileGroup)));</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a054448b41eb188b1fc1061c29f7d4ef7" kindref="member">rewriteService</ref>.shutdown();</highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>stop<sp/>commit<sp/>service</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/>commitService.close();</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>failedCommits<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aaf42595de165e54948aaf223852a9bdd" kindref="member">maxCommits</ref><sp/>-<sp/>commitService.succeededCommits();</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(failedCommits<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>failedCommits<sp/>&lt;=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acdb6f82df7a8a7a3b7a21f01dfcbd988" kindref="member">maxFailedCommits</ref>)<sp/>{</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a3c76743f9a1ea7f31643a6aedfd186f4" kindref="member">LOG</ref>.warn(</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;{}<sp/>is<sp/>true<sp/>but<sp/>{}<sp/>rewrite<sp/>commits<sp/>failed.<sp/>Check<sp/>the<sp/>logs<sp/>to<sp/>determine<sp/>why<sp/>the<sp/>individual<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;commits<sp/>failed.<sp/>If<sp/>this<sp/>is<sp/>persistent<sp/>it<sp/>may<sp/>help<sp/>to<sp/>increase<sp/>{}<sp/>which<sp/>will<sp/>split<sp/>the<sp/>rewrite<sp/>operation<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;into<sp/>smaller<sp/>commits.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a80c92481ed2c97677ea68d9e27faaea0" kindref="member">PARTIAL_PROGRESS_ENABLED</ref>,</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>failedCommits,</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a792298ea627c7a4dfe368946dc1f0186" kindref="member">PARTIAL_PROGRESS_MAX_COMMITS</ref>);</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(failedCommits<sp/>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acdb6f82df7a8a7a3b7a21f01dfcbd988" kindref="member">maxFailedCommits</ref>)<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>errorMessage<sp/>=</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;%s<sp/>is<sp/>true<sp/>but<sp/>%d<sp/>rewrite<sp/>commits<sp/>failed.<sp/>This<sp/>is<sp/>more<sp/>than<sp/>the<sp/>maximum<sp/>allowed<sp/>failures<sp/>of<sp/>%d.<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;Check<sp/>the<sp/>logs<sp/>to<sp/>determine<sp/>why<sp/>the<sp/>individual<sp/>commits<sp/>failed.<sp/>If<sp/>this<sp/>is<sp/>persistent<sp/>it<sp/>may<sp/>help<sp/>to<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;increase<sp/>%s<sp/>which<sp/>will<sp/>split<sp/>the<sp/>rewrite<sp/>operation<sp/>into<sp/>smaller<sp/>commits.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a80c92481ed2c97677ea68d9e27faaea0" kindref="member">PARTIAL_PROGRESS_ENABLED</ref>,</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>failedCommits,</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acdb6f82df7a8a7a3b7a21f01dfcbd988" kindref="member">maxFailedCommits</ref>,</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a792298ea627c7a4dfe368946dc1f0186" kindref="member">PARTIAL_PROGRESS_MAX_COMMITS</ref>);</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>RuntimeException(errorMessage);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles" kindref="compound">ImmutableRewriteDataFiles</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles_1_1Result" kindref="compound">Result</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles_1_1Result_1a5ea4139befcb9dfd562ce3cb970b2d67" kindref="member">builder</ref>()</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.rewriteResults(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acc86dd1b33a254074e0a1212cbbc17e1" kindref="member">toRewriteResults</ref>(commitService.results()))</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.rewriteFailures(rewriteFailures)</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.build();</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/>Stream&lt;RewriteFileGroup&gt;<sp/>toGroupStream(</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>RewriteExecutionContext<sp/>ctx,<sp/>Map&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref>,<sp/>List&lt;List&lt;FileScanTask&gt;&gt;&gt;<sp/>groupsByPartition)<sp/>{</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>groupsByPartition.entrySet().stream()</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.filter(e<sp/>-&gt;<sp/>e.getValue().size()<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.flatMap(</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>e<sp/>-&gt;<sp/>{</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref><sp/>partition<sp/>=<sp/>e.getKey();</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;List&lt;FileScanTask&gt;&gt;<sp/>scanGroups<sp/>=<sp/>e.getValue();</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>scanGroups.stream().map(tasks<sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a81daac2f9e50e0ace55c85f103f1480f" kindref="member">newRewriteGroup</ref>(ctx,<sp/>partition,<sp/>tasks));</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>})</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.sorted(RewriteFileGroup.comparator(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a9fd4436ec3cc807e6928f4bbf61a6a35" kindref="member">rewriteJobOrder</ref>));</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a81daac2f9e50e0ace55c85f103f1480f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup" kindref="compound">RewriteFileGroup</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a81daac2f9e50e0ace55c85f103f1480f" kindref="member">newRewriteGroup</ref>(</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>RewriteExecutionContext<sp/>ctx,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref><sp/>partition,<sp/>List&lt;FileScanTask&gt;<sp/>tasks)<sp/>{</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>globalIndex<sp/>=<sp/>ctx.currentGlobalIndex();</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>partitionIndex<sp/>=<sp/>ctx.currentPartitionIndex(partition);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1_1FileGroupInfo" kindref="compound">FileGroupInfo</ref><sp/>info<sp/>=</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles" kindref="compound">ImmutableRewriteDataFiles</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles_1_1FileGroupInfo" kindref="compound">FileGroupInfo</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1ImmutableRewriteDataFiles_1_1FileGroupInfo_1a1014d90a2e37ca4b350f1aadb5e99b11" kindref="member">builder</ref>()</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.globalIndex(globalIndex)</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.partitionIndex(partitionIndex)</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.partition(partition)</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.build();</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup" kindref="compound">RewriteFileGroup</ref>(info,<sp/>tasks);</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="418"><highlight class="normal"></highlight></codeline>
<codeline lineno="419" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acc86dd1b33a254074e0a1212cbbc17e1" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Iterable&lt;FileGroupRewriteResult&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acc86dd1b33a254074e0a1212cbbc17e1" kindref="member">toRewriteResults</ref>(List&lt;RewriteFileGroup&gt;<sp/>commitResults)<sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>commitResults.stream().map(<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1a359f412d070ed5fd4fa9094cda0980e3" kindref="member">RewriteFileGroup::asResult</ref>).collect(Collectors.toList());</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="422"><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>validateAndInitOptions()<sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>validOptions<sp/>=<sp/>Sets.newHashSet(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref>.validOptions());</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/>validOptions.addAll(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a6920f39ec89c4079e700b253cb8e8416" kindref="member">VALID_OPTIONS</ref>);</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>invalidKeys<sp/>=<sp/>Sets.newHashSet(options().keySet());</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>invalidKeys.removeAll(validOptions);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalidKeys.isEmpty(),</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>use<sp/>options<sp/>%s,<sp/>they<sp/>are<sp/>not<sp/>supported<sp/>by<sp/>the<sp/>action<sp/>or<sp/>the<sp/>rewriter<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>invalidKeys,</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref>.description());</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref>.init(options());</highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4d4bf89bbc8dae1d49d4b93113857faa" kindref="member">maxConcurrentFileGroupRewrites</ref><sp/>=</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options(),</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a25c9e1979d5699d2b572185409392b79" kindref="member">MAX_CONCURRENT_FILE_GROUP_REWRITES</ref>,</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a4607f96debc8b0cf03f01de2d22f0ac8" kindref="member">MAX_CONCURRENT_FILE_GROUP_REWRITES_DEFAULT</ref>);</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aaf42595de165e54948aaf223852a9bdd" kindref="member">maxCommits</ref><sp/>=</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options(),<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a792298ea627c7a4dfe368946dc1f0186" kindref="member">PARTIAL_PROGRESS_MAX_COMMITS</ref>,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1ae563e8b0c86d8e04f3c15e9623fe997d" kindref="member">PARTIAL_PROGRESS_MAX_COMMITS_DEFAULT</ref>);</highlight></codeline>
<codeline lineno="447"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1acdb6f82df7a8a7a3b7a21f01dfcbd988" kindref="member">maxFailedCommits</ref><sp/>=</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(options(),<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a77e6cfa8ef7130d3f0acc65bd48ac743" kindref="member">PARTIAL_PROGRESS_MAX_FAILED_COMMITS</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aaf42595de165e54948aaf223852a9bdd" kindref="member">maxCommits</ref>);</highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aa4652465f54af7a4736ae91cdd01c304" kindref="member">partialProgressEnabled</ref><sp/>=</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a815bb60acfdf24932c858baa8afe18f2" kindref="member">propertyAsBoolean</ref>(</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options(),<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a80c92481ed2c97677ea68d9e27faaea0" kindref="member">PARTIAL_PROGRESS_ENABLED</ref>,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a4fbfecf68a8b5d5fad3e0330a49ef61a" kindref="member">PARTIAL_PROGRESS_ENABLED_DEFAULT</ref>);</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1af39d17bc8a1b7a9d6f1c577a1c2eaeaf" kindref="member">useStartingSequenceNumber</ref><sp/>=</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a815bb60acfdf24932c858baa8afe18f2" kindref="member">propertyAsBoolean</ref>(</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>options(),<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1acbac59660c1162644fc3eba73ff61329" kindref="member">USE_STARTING_SEQUENCE_NUMBER</ref>,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a89a29a5ec4ca1a5faedfb06a2498adf2" kindref="member">USE_STARTING_SEQUENCE_NUMBER_DEFAULT</ref>);</highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a9fd4436ec3cc807e6928f4bbf61a6a35" kindref="member">rewriteJobOrder</ref><sp/>=</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1RewriteJobOrder" kindref="compound">RewriteJobOrder</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1RewriteJobOrder_1a2983bdd21c77df48e7a1a7cadee1c88c" kindref="member">fromName</ref>(</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1aee7b095a16e3ca041391668005771864" kindref="member">propertyAsString</ref>(options(),<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a692f9279478e8e3619a3a08f2d455fca" kindref="member">REWRITE_JOB_ORDER</ref>,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a8bed03cb0fa2486280b227d2dcfc4819" kindref="member">REWRITE_JOB_ORDER_DEFAULT</ref>));</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4d4bf89bbc8dae1d49d4b93113857faa" kindref="member">maxConcurrentFileGroupRewrites</ref><sp/>&gt;=<sp/>1,</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>%s<sp/>to<sp/>%s,<sp/>the<sp/>value<sp/>must<sp/>be<sp/>positive.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a25c9e1979d5699d2b572185409392b79" kindref="member">MAX_CONCURRENT_FILE_GROUP_REWRITES</ref>,</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4d4bf89bbc8dae1d49d4b93113857faa" kindref="member">maxConcurrentFileGroupRewrites</ref>);</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aa4652465f54af7a4736ae91cdd01c304" kindref="member">partialProgressEnabled</ref><sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aaf42595de165e54948aaf223852a9bdd" kindref="member">maxCommits</ref><sp/>&gt;<sp/>0,</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>%s<sp/>to<sp/>%s,<sp/>the<sp/>value<sp/>must<sp/>be<sp/>positive<sp/>when<sp/>%s<sp/>is<sp/>true&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a792298ea627c7a4dfe368946dc1f0186" kindref="member">PARTIAL_PROGRESS_MAX_COMMITS</ref>,</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1aaf42595de165e54948aaf223852a9bdd" kindref="member">maxCommits</ref>,</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1a80c92481ed2c97677ea68d9e27faaea0" kindref="member">PARTIAL_PROGRESS_ENABLED</ref>);</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="476"><highlight class="normal"></highlight></codeline>
<codeline lineno="477" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a993857ba71ba97a1c871af6c38e9a4b6" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a993857ba71ba97a1c871af6c38e9a4b6" kindref="member">jobDesc</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup" kindref="compound">RewriteFileGroup</ref><sp/>group,<sp/>RewriteExecutionContext<sp/>ctx)<sp/>{</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref><sp/>partition<sp/>=<sp/>group.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1af533eaba586f2f61c36c41ea0c7099fb" kindref="member">info</ref>().<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1_1FileGroupInfo_1a97d0cdaf38b34439de91817de98054a5" kindref="member">partition</ref>();</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(partition.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike_1abb7a7b0ff8b7d46694bc9acd917b6137" kindref="member">size</ref>()<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>String.format(</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Rewriting<sp/>%d<sp/>files<sp/>(%s,<sp/>file<sp/>group<sp/>%d/%d,<sp/>%s<sp/>(%d/%d))<sp/>in<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>group.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1a12cf09914630cf547537875dc5a2347a" kindref="member">rewrittenFiles</ref>().size(),</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref>.description(),</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>group.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1af533eaba586f2f61c36c41ea0c7099fb" kindref="member">info</ref>().<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1_1FileGroupInfo_1a8229a7782128a2f68f47a9f414f7084c" kindref="member">globalIndex</ref>(),</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctx.totalGroupCount(),</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partition,</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>group.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1af533eaba586f2f61c36c41ea0c7099fb" kindref="member">info</ref>().<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1_1FileGroupInfo_1aa26f0abf5b4f8f7ffeacb84ab0588ed8" kindref="member">partitionIndex</ref>(),</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctx.groupsInPartition(partition),</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1ac3bd999ff367dc8f622ca14e9b85277e" kindref="member">name</ref>());</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>String.format(</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Rewriting<sp/>%d<sp/>files<sp/>(%s,<sp/>file<sp/>group<sp/>%d/%d)<sp/>in<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>group.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1a12cf09914630cf547537875dc5a2347a" kindref="member">rewrittenFiles</ref>().size(),</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4c5d8ac87ac38bd083f2995048098244" kindref="member">rewriter</ref>.description(),</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>group.<ref refid="classorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteFileGroup_1af533eaba586f2f61c36c41ea0c7099fb" kindref="member">info</ref>().<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1actions_1_1RewriteDataFiles_1_1FileGroupInfo_1a8229a7782128a2f68f47a9f414f7084c" kindref="member">globalIndex</ref>(),</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ctx.totalGroupCount(),</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a1dcc36023b79b428a99746c701cf3662" kindref="member">table</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1ac3bd999ff367dc8f622ca14e9b85277e" kindref="member">name</ref>());</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="500"><highlight class="normal"></highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/>@VisibleForTesting</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">RewriteExecutionContext<sp/>{</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap&lt;Integer&gt;</ref><sp/>numGroupsByPartition;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>totalGroupCount;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;StructLike,<sp/>Integer&gt;<sp/>partitionIndexMap;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>AtomicInteger<sp/>groupIndex;</highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/>RewriteExecutionContext(<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1StructLikeMap" kindref="compound">StructLikeMap</ref>&lt;List&lt;List&lt;FileScanTask&gt;&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4b2b91802aa47e962da9f204b5899c33" kindref="member">fileGroupsByPartition</ref>)<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.numGroupsByPartition<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1actions_1_1RewriteDataFilesSparkAction_1a4b2b91802aa47e962da9f204b5899c33" kindref="member">fileGroupsByPartition</ref>.transformValues(List::size);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.totalGroupCount<sp/>=<sp/>numGroupsByPartition.values().stream().reduce(Integer::sum).orElse(0);</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.partitionIndexMap<sp/>=<sp/>Maps.newConcurrentMap();</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.groupIndex<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>AtomicInteger(1);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>currentGlobalIndex()<sp/>{</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>groupIndex.getAndIncrement();</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>currentPartitionIndex(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref><sp/>partition)<sp/>{</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>partitionIndexMap.merge(partition,<sp/>1,<sp/>Integer::sum);</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="522"><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>groupsInPartition(StructLike<sp/>partition)<sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numGroupsByPartition.get(partition);</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>totalGroupCount()<sp/>{</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>totalGroupCount;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="531"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="spark/v3.5/spark/src/main/java/org/apache/iceberg/spark/actions/RewriteDataFilesSparkAction.java"/>
  </compounddef>
</doxygen>
