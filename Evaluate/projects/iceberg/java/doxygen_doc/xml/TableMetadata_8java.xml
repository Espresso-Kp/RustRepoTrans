<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="TableMetadata_8java" kind="file" language="Java">
    <compoundname>TableMetadata.java</compoundname>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" prot="public">org::apache::iceberg::TableMetadata</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" prot="public">org::apache::iceberg::TableMetadata::SnapshotLogEntry</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" prot="public">org::apache::iceberg::TableMetadata::MetadataLogEntry</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" prot="public">org::apache::iceberg::TableMetadata::Builder</innerclass>
    <innernamespace refid="namespaceorg_1_1apache_1_1iceberg">org::apache::iceberg</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Licensed<sp/>to<sp/>the<sp/>Apache<sp/>Software<sp/>Foundation<sp/>(ASF)<sp/>under<sp/>one</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>or<sp/>more<sp/>contributor<sp/>license<sp/>agreements.<sp/><sp/>See<sp/>the<sp/>NOTICE<sp/>file</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>distributed<sp/>with<sp/>this<sp/>work<sp/>for<sp/>additional<sp/>information</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>regarding<sp/>copyright<sp/>ownership.<sp/><sp/>The<sp/>ASF<sp/>licenses<sp/>this<sp/>file</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>to<sp/>you<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>&quot;License&quot;);<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>with<sp/>the<sp/>License.<sp/><sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/><sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>Unless<sp/>required<sp/>by<sp/>applicable<sp/>law<sp/>or<sp/>agreed<sp/>to<sp/>in<sp/>writing,</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>software<sp/>distributed<sp/>under<sp/>the<sp/>License<sp/>is<sp/>distributed<sp/>on<sp/>an</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>&quot;AS<sp/>IS&quot;<sp/>BASIS,<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>KIND,<sp/>either<sp/>express<sp/>or<sp/>implied.<sp/><sp/>See<sp/>the<sp/>License<sp/>for<sp/>the</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and<sp/>limitations</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>under<sp/>the<sp/>License.</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">package<sp/></highlight><highlight class="normal">org.apache.iceberg;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.Serializable;</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Collection;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.List;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Map;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Set;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.UUID;</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.TimeUnit;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.concurrent.atomic.AtomicInteger;</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.function.Predicate;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.stream.Collectors;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.stream.Stream;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1exceptions" kindref="compound">exceptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.base.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1base_1_1MoreObjects" kindref="compound">MoreObjects</ref>;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.base.Objects;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.base.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1base_1_1Preconditions" kindref="compound">Preconditions</ref>;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.ImmutableList;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.ImmutableMap;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Iterables;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Lists;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1collect_1_1Maps" kindref="compound">Maps</ref>;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1collect_1_1Sets" kindref="compound">Sets</ref>;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1transforms" kindref="compound">transforms</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1transforms_1_1Transforms" kindref="compound">Transforms</ref>;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1types" kindref="compound">types</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil" kindref="compound">TypeUtil</ref>;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1LocationUtil" kindref="compound">LocationUtil</ref>;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair" kindref="compound">Pair</ref>;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier</ref>;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="50" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" refkind="compound"><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/>Serializable<sp/>{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>INITIAL_SEQUENCE_NUMBER<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>INVALID_SEQUENCE_NUMBER<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>DEFAULT_TABLE_FORMAT_VERSION<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>SUPPORTED_TABLE_FORMAT_VERSION<sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>INITIAL_SPEC_ID<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>INITIAL_SORT_ORDER_ID<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>INITIAL_SCHEMA_ID<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5e59137c29ea9b926d6d174994a6936c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5e59137c29ea9b926d6d174994a6936c" kindref="member">ONE_MINUTE</ref><sp/>=<sp/>TimeUnit.MINUTES.toMillis(1);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9fd4203393b368d9e5aaa14acf38014a" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9fd4203393b368d9e5aaa14acf38014a" kindref="member">newTableMetadata</ref>(</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>,</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>,</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>,</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>)<sp/>{</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref><sp/>=</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1aa8404f9a8c213ac178c05007df711369" kindref="member">FORMAT_VERSION</ref>,<sp/>DEFAULT_TABLE_FORMAT_VERSION);</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9fd4203393b368d9e5aaa14acf38014a" kindref="member">newTableMetadata</ref>(</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" kindref="member">persistedProperties</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>);</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7dc062787ece9d303e68e03adac8f9df" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7dc062787ece9d303e68e03adac8f9df" kindref="member">newTableMetadata</ref>(</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>,<sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>,<sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>)<sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a0df25c253d4bd778f08db5b7680ad14a" kindref="member">unsorted</ref>();</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref><sp/>=</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1aa8404f9a8c213ac178c05007df711369" kindref="member">FORMAT_VERSION</ref>,<sp/>DEFAULT_TABLE_FORMAT_VERSION);</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9fd4203393b368d9e5aaa14acf38014a" kindref="member">newTableMetadata</ref>(</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" kindref="member">persistedProperties</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a09293f58ab6d5acdaecebee2f6cb53bc" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a09293f58ab6d5acdaecebee2f6cb53bc" kindref="member">unreservedProperties</ref>(Map&lt;String,<sp/>String&gt;<sp/>rawProperties)<sp/>{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rawProperties.entrySet().stream()</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.filter(e<sp/>-&gt;<sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1ad752ba56ad725d9c9ebfadb35b591d15" kindref="member">RESERVED_PROPERTIES</ref>.contains(e.getKey()))</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.collect(Collectors.toMap(Map.Entry::getKey,<sp/>Map.Entry::getValue));</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" kindref="member">persistedProperties</ref>(Map&lt;String,<sp/>String&gt;<sp/>rawProperties)<sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" kindref="member">persistedProperties</ref><sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>explicitly<sp/>set<sp/>defaults<sp/>that<sp/>apply<sp/>only<sp/>to<sp/>new<sp/>tables</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" kindref="member">persistedProperties</ref>.put(</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1a48245b2fbafda0cf12468f04016d2c7b" kindref="member">PARQUET_COMPRESSION</ref>,</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1a859a75e203911fe58dfd26ee40f5b9a1" kindref="member">PARQUET_COMPRESSION_DEFAULT_SINCE_1_4_0</ref>);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>rawProperties.entrySet().stream()</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.filter(entry<sp/>-&gt;<sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1ad752ba56ad725d9c9ebfadb35b591d15" kindref="member">RESERVED_PROPERTIES</ref>.contains(entry.getKey()))</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.forEach(entry<sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" kindref="member">persistedProperties</ref>.put(entry.getKey(),<sp/>entry.getValue()));</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" kindref="member">persistedProperties</ref>;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9fd4203393b368d9e5aaa14acf38014a" kindref="member">newTableMetadata</ref>(</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>,</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>,</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>,</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>,</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>)<sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>.keySet().stream().noneMatch(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.RESERVED_PROPERTIES::contains),</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Table<sp/>properties<sp/>should<sp/>not<sp/>contain<sp/>reserved<sp/>properties,<sp/>but<sp/>got<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>reassign<sp/>all<sp/>column<sp/>ids<sp/>to<sp/>ensure<sp/>consistency</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>AtomicInteger<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" kindref="member">lastColumnId</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>AtomicInteger(0);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>freshSchema<sp/>=</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil" kindref="compound">TypeUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil_1a85a90df5b652ab26af8920d59269e157" kindref="member">assignFreshIds</ref>(INITIAL_SCHEMA_ID,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/>lastColumnId::incrementAndGet);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rebuild<sp/>the<sp/>partition<sp/>spec<sp/>using<sp/>the<sp/>new<sp/>column<sp/>ids</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1_1Builder" kindref="compound">Builder</ref><sp/>specBuilder<sp/>=</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a5f73aba02e3dd22ce2b33483bf460dbe" kindref="member">builderFor</ref>(freshSchema).withSpecId(INITIAL_SPEC_ID);</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>field<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a9e4d9fea3edf1aed8d8e7ef1f0392450" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>look<sp/>up<sp/>the<sp/>name<sp/>of<sp/>the<sp/>source<sp/>field<sp/>in<sp/>the<sp/>old<sp/>schema<sp/>to<sp/>get<sp/>the<sp/>new<sp/>schema&apos;s<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>sourceName<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1ab28504a59163b01a97dd03f76d7ce93e" kindref="member">findColumnName</ref>(field.sourceId());</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>reassign<sp/>all<sp/>partition<sp/>fields<sp/>with<sp/>fresh<sp/>partition<sp/>field<sp/>Ids<sp/>to<sp/>ensure<sp/>consistency</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>specBuilder.add(freshSchema.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1af6a287dd0c94d0a15ae7304a49fa87c4" kindref="member">findField</ref>(sourceName).<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1NestedField_1abc4eb81018cd54fa87a45420667b7cdb" kindref="member">fieldId</ref>(),<sp/>field.name(),<sp/>field.transform());</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>PartitionSpec<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a188d04143e3429e8f5c0cced43f2d492" kindref="member">freshSpec</ref><sp/>=<sp/>specBuilder.build();</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rebuild<sp/>the<sp/>sort<sp/>order<sp/>using<sp/>the<sp/>new<sp/>column<sp/>ids</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>freshSortOrderId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a75ddf6303546ecefbfa937557b0dfe08" kindref="member">isUnsorted</ref>()<sp/>?<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a33c4d179099cd454e31438ce54dd7aef" kindref="member">orderId</ref>()<sp/>:<sp/>INITIAL_SORT_ORDER_ID;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>SortOrder<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" kindref="member">freshSortOrder</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" kindref="member">freshSortOrder</ref>(freshSortOrderId,<sp/>freshSchema,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Validate<sp/>the<sp/>metrics<sp/>configuration.<sp/>Note:<sp/>we<sp/>only<sp/>do<sp/>this<sp/>on<sp/>new<sp/>tables<sp/>to<sp/>we<sp/>don&apos;t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>break<sp/>existing<sp/>tables.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>MetricsConfig.fromProperties(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>).validateReferencedColumns(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Builder()</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setInitialFormatVersion(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>)</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setCurrentSchema(freshSchema,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" kindref="member">lastColumnId</ref>.get())</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setDefaultPartitionSpec(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a188d04143e3429e8f5c0cced43f2d492" kindref="member">freshSpec</ref>)</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setDefaultSortOrder(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" kindref="member">freshSortOrder</ref>)</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setLocation(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>)</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.setProperties(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>)</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.build();</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" refkind="compound"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" kindref="compound">SnapshotLogEntry</ref><sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry" kindref="compound">HistoryEntry</ref><sp/>{</highlight></codeline>
<codeline lineno="152" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" kindref="member">timestampMillis</ref>;</highlight></codeline>
<codeline lineno="153" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" kindref="member">snapshotId</ref>;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" kindref="compound">SnapshotLogEntry</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" kindref="member">timestampMillis</ref>,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" kindref="member">snapshotId</ref>)<sp/>{</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.timestampMillis<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" kindref="member">timestampMillis</ref>;</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" kindref="member">snapshotId</ref>;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="161" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a4de63fafedef64c851e0bc9d76541385" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a4de63fafedef64c851e0bc9d76541385" kindref="member">timestampMillis</ref>()<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" kindref="member">timestampMillis</ref>;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="166" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a9dfef18e041ba1681d7942606d4d67b9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a9dfef18e041ba1681d7942606d4d67b9" kindref="member">snapshotId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" kindref="member">snapshotId</ref>;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="171" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a15f2db00046989e06036f9e5135c461e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a15f2db00046989e06036f9e5135c461e" kindref="member">equals</ref>(Object<sp/>other)<sp/>{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">this</highlight><highlight class="normal"><sp/>==<sp/>other)<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(other<sp/>instanceof<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" kindref="compound">SnapshotLogEntry</ref>))<sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" kindref="compound">SnapshotLogEntry</ref><sp/>that<sp/>=<sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" kindref="compound">SnapshotLogEntry</ref>)<sp/>other;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" kindref="member">timestampMillis</ref><sp/>==<sp/>that.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" kindref="member">timestampMillis</ref><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" kindref="member">snapshotId</ref><sp/>==<sp/>that.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" kindref="member">snapshotId</ref>;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="182" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1ab47828897063bd235bf4830eee40ded9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1ab47828897063bd235bf4830eee40ded9" kindref="member">hashCode</ref>()<sp/>{</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Objects.hashCode(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" kindref="member">timestampMillis</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" kindref="member">snapshotId</ref>);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="187" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a5696e2a59df97f1f77585a89bd9d0b18" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a5696e2a59df97f1f77585a89bd9d0b18" kindref="member">toString</ref>()<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>MoreObjects.toStringHelper(</highlight><highlight class="keyword">this</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.add(</highlight><highlight class="stringliteral">&quot;timestampMillis&quot;</highlight><highlight class="normal">,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a14ff5c3539b6d3a4a7064bc4104959ae" kindref="member">timestampMillis</ref>)</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.add(</highlight><highlight class="stringliteral">&quot;snapshotId&quot;</highlight><highlight class="normal">,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry_1a2e0ae6e8107abb44e29fd4be86f8451d" kindref="member">snapshotId</ref>)</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.toString();</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" refkind="compound"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref><sp/>{</highlight></codeline>
<codeline lineno="196" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref>;</highlight></codeline>
<codeline lineno="197" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" kindref="member">file</ref>;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref>,<sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" kindref="member">file</ref>)<sp/>{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.timestampMillis<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref>;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.file<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" kindref="member">file</ref>;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="204" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1a3ee2be3dcd0db1dadc80fdb8aee62c83" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1a3ee2be3dcd0db1dadc80fdb8aee62c83" kindref="member">timestampMillis</ref>()<sp/>{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref>;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1af68f76eb3d9e82b3422eae8c13512775" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1af68f76eb3d9e82b3422eae8c13512775" kindref="member">file</ref>()<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" kindref="member">file</ref>;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="213" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ada129fd6c091457836ce623bcd1edb0c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ada129fd6c091457836ce623bcd1edb0c" kindref="member">equals</ref>(Object<sp/>other)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">this</highlight><highlight class="normal"><sp/>==<sp/>other)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(other<sp/>instanceof<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref>))<sp/>{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref><sp/>that<sp/>=<sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref>)<sp/>other;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref><sp/>==<sp/>that.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref><sp/>&amp;&amp;<sp/>java.util.Objects.equals(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" kindref="member">file</ref>,<sp/>that.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" kindref="member">file</ref>);</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="224" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab3f09a94db530bf83e5e04b160ca4b3b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab3f09a94db530bf83e5e04b160ca4b3b" kindref="member">hashCode</ref>()<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>Objects.hashCode(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" kindref="member">file</ref>);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="229" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1aa17ad09ac8366f638f19df14d0ce593a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1aa17ad09ac8366f638f19df14d0ce593a" kindref="member">toString</ref>()<sp/>{</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>MoreObjects.toStringHelper(</highlight><highlight class="keyword">this</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.add(</highlight><highlight class="stringliteral">&quot;timestampMillis&quot;</highlight><highlight class="normal">,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref>)</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.add(</highlight><highlight class="stringliteral">&quot;file&quot;</highlight><highlight class="normal">,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab49e7c5ab895304dcdc5b240dee441a1" kindref="member">file</ref>)</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.toString();</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>stored<sp/>metadata</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac705dac4a1961c8c6ca368efed8824ca" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac705dac4a1961c8c6ca368efed8824ca" kindref="member">metadataFileLocation</ref>;</highlight></codeline>
<codeline lineno="239" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>;</highlight></codeline>
<codeline lineno="240" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aeaf11035990f2126554fb1c282bde048" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aeaf11035990f2126554fb1c282bde048" kindref="member">uuid</ref>;</highlight></codeline>
<codeline lineno="241" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>;</highlight></codeline>
<codeline lineno="242" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>;</highlight></codeline>
<codeline lineno="243" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref>;</highlight></codeline>
<codeline lineno="244" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" kindref="member">lastColumnId</ref>;</highlight></codeline>
<codeline lineno="245" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a32e01f41a44efcee6008285b8c7d29" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a32e01f41a44efcee6008285b8c7d29" kindref="member">currentSchemaId</ref>;</highlight></codeline>
<codeline lineno="246" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ade3734193181eeec7369a0b85cb6e8dc" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;Schema&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ade3734193181eeec7369a0b85cb6e8dc" kindref="member">schemas</ref>;</highlight></codeline>
<codeline lineno="247" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa110a34400fb957b29e0fde7810d9a16" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa110a34400fb957b29e0fde7810d9a16" kindref="member">defaultSpecId</ref>;</highlight></codeline>
<codeline lineno="248" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;PartitionSpec&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>;</highlight></codeline>
<codeline lineno="249" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad0607b9a2d14b67fd3b3511ed18bd8a2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad0607b9a2d14b67fd3b3511ed18bd8a2" kindref="member">lastAssignedPartitionId</ref>;</highlight></codeline>
<codeline lineno="250" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a371dc7fa43a395068072fcfe61687b3c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a371dc7fa43a395068072fcfe61687b3c" kindref="member">defaultSortOrderId</ref>;</highlight></codeline>
<codeline lineno="251" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;SortOrder&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>;</highlight></codeline>
<codeline lineno="252" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>;</highlight></codeline>
<codeline lineno="253" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>;</highlight></codeline>
<codeline lineno="254" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a96b74dc5c7258bf06ad0ae65a777038f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>Schema&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a96b74dc5c7258bf06ad0ae65a777038f" kindref="member">schemasById</ref>;</highlight></codeline>
<codeline lineno="255" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4f9788bbc885776fbbaefb19c8d72e1c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>PartitionSpec&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4f9788bbc885776fbbaefb19c8d72e1c" kindref="member">specsById</ref>;</highlight></codeline>
<codeline lineno="256" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaf38fa5e67b795fd0a5c111b01abc898" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>SortOrder&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaf38fa5e67b795fd0a5c111b01abc898" kindref="member">sortOrdersById</ref>;</highlight></codeline>
<codeline lineno="257" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa05771fd2ba796008ccc498ef25c40a4" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;HistoryEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa05771fd2ba796008ccc498ef25c40a4" kindref="member">snapshotLog</ref>;</highlight></codeline>
<codeline lineno="258" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7ed40349c58b7cfec01589bd5707afa2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;MetadataLogEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7ed40349c58b7cfec01589bd5707afa2" kindref="member">previousFiles</ref>;</highlight></codeline>
<codeline lineno="259" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac9321d1f30da2a5c616e0a7c594b9a5b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;StatisticsFile&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac9321d1f30da2a5c616e0a7c594b9a5b" kindref="member">statisticsFiles</ref>;</highlight></codeline>
<codeline lineno="260" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae19000a9f50443b79f61ad0e27d18c15" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;PartitionStatisticsFile&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae19000a9f50443b79f61ad0e27d18c15" kindref="member">partitionStatisticsFiles</ref>;</highlight></codeline>
<codeline lineno="261" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a25930ba1c1c77278fd0ef5fc19bf6e91" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;MetadataUpdate&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a25930ba1c1c77278fd0ef5fc19bf6e91" kindref="member">changes</ref>;</highlight></codeline>
<codeline lineno="262" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a6d3382103c6d4be0144bfe5d91ee37f9" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier&lt;List&lt;Snapshot&gt;</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a6d3382103c6d4be0144bfe5d91ee37f9" kindref="member">snapshotsSupplier</ref>;</highlight></codeline>
<codeline lineno="263" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/>List&lt;Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>;</highlight></codeline>
<codeline lineno="264" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/>Map&lt;Long,<sp/>Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>;</highlight></codeline>
<codeline lineno="265" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adb822582e40311fdbed1da1463705d84" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>SnapshotRef&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adb822582e40311fdbed1da1463705d84" kindref="member">refs</ref>;</highlight></codeline>
<codeline lineno="266" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa2ef0b186a9dca7b5624ebbb9aa8e5b2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa2ef0b186a9dca7b5624ebbb9aa8e5b2" kindref="member">snapshotsLoaded</ref>;</highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/>@SuppressWarnings(</highlight><highlight class="stringliteral">&quot;checkstyle:CyclomaticComplexity&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>(</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac705dac4a1961c8c6ca368efed8824ca" kindref="member">metadataFileLocation</ref>,</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>,</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aeaf11035990f2126554fb1c282bde048" kindref="member">uuid</ref>,</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>,</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>,</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref>,</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" kindref="member">lastColumnId</ref>,</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a32e01f41a44efcee6008285b8c7d29" kindref="member">currentSchemaId</ref>,</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ade3734193181eeec7369a0b85cb6e8dc" kindref="member">schemas</ref>,</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa110a34400fb957b29e0fde7810d9a16" kindref="member">defaultSpecId</ref>,</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>,</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad0607b9a2d14b67fd3b3511ed18bd8a2" kindref="member">lastAssignedPartitionId</ref>,</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a371dc7fa43a395068072fcfe61687b3c" kindref="member">defaultSortOrderId</ref>,</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>,</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>,</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>,</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>,</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier</ref>&lt;List&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref>&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a6d3382103c6d4be0144bfe5d91ee37f9" kindref="member">snapshotsSupplier</ref>,</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry" kindref="compound">HistoryEntry</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa05771fd2ba796008ccc498ef25c40a4" kindref="member">snapshotLog</ref>,</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7ed40349c58b7cfec01589bd5707afa2" kindref="member">previousFiles</ref>,</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adb822582e40311fdbed1da1463705d84" kindref="member">refs</ref>,</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StatisticsFile" kindref="compound">StatisticsFile</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac9321d1f30da2a5c616e0a7c594b9a5b" kindref="member">statisticsFiles</ref>,</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFile" kindref="compound">PartitionStatisticsFile</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae19000a9f50443b79f61ad0e27d18c15" kindref="member">partitionStatisticsFiles</ref>,</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a25930ba1c1c77278fd0ef5fc19bf6e91" kindref="member">changes</ref>)<sp/>{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>.isEmpty(),<sp/></highlight><highlight class="stringliteral">&quot;Partition<sp/>specs<sp/>cannot<sp/>be<sp/>null<sp/>or<sp/>empty&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>.isEmpty(),<sp/></highlight><highlight class="stringliteral">&quot;Sort<sp/>orders<sp/>cannot<sp/>be<sp/>null<sp/>or<sp/>empty&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref><sp/>&lt;=<sp/>SUPPORTED_TABLE_FORMAT_VERSION,</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Unsupported<sp/>format<sp/>version:<sp/>v%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref><sp/>==<sp/>1<sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aeaf11035990f2126554fb1c282bde048" kindref="member">uuid</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;UUID<sp/>is<sp/>required<sp/>in<sp/>format<sp/>v%s&quot;</highlight><highlight class="normal">,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref><sp/>&gt;<sp/>1<sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref><sp/>==<sp/>0,</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Sequence<sp/>number<sp/>must<sp/>be<sp/>0<sp/>in<sp/>v1:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>);</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac705dac4a1961c8c6ca368efed8824ca" kindref="member">metadataFileLocation</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a25930ba1c1c77278fd0ef5fc19bf6e91" kindref="member">changes</ref>.isEmpty(),</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>create<sp/>TableMetadata<sp/>with<sp/>a<sp/>metadata<sp/>location<sp/>and<sp/>changes&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>this.metadataFileLocation<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac705dac4a1961c8c6ca368efed8824ca" kindref="member">metadataFileLocation</ref>;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/>this.formatVersion<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>this.uuid<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aeaf11035990f2126554fb1c282bde048" kindref="member">uuid</ref>;</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>this.location<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>?<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1LocationUtil" kindref="compound">LocationUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1LocationUtil_1aa94d5984076b1ef6e53a6e4ca3793e33" kindref="member">stripTrailingSlash</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>)<sp/>:<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>this.lastSequenceNumber<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/>this.lastUpdatedMillis<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref>;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/>this.lastColumnId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" kindref="member">lastColumnId</ref>;</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>this.currentSchemaId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a32e01f41a44efcee6008285b8c7d29" kindref="member">currentSchemaId</ref>;</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/>this.schemas<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ade3734193181eeec7369a0b85cb6e8dc" kindref="member">schemas</ref>;</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/>this.specs<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/>this.defaultSpecId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa110a34400fb957b29e0fde7810d9a16" kindref="member">defaultSpecId</ref>;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/>this.lastAssignedPartitionId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad0607b9a2d14b67fd3b3511ed18bd8a2" kindref="member">lastAssignedPartitionId</ref>;</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/>this.defaultSortOrderId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a371dc7fa43a395068072fcfe61687b3c" kindref="member">defaultSortOrderId</ref>;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/>this.sortOrders<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/>this.properties<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>this.currentSnapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/>this.snapshots<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>this.snapshotsSupplier<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a6d3382103c6d4be0144bfe5d91ee37f9" kindref="member">snapshotsSupplier</ref>;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/>this.snapshotsLoaded<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a6d3382103c6d4be0144bfe5d91ee37f9" kindref="member">snapshotsSupplier</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/>this.snapshotLog<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa05771fd2ba796008ccc498ef25c40a4" kindref="member">snapshotLog</ref>;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/>this.previousFiles<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7ed40349c58b7cfec01589bd5707afa2" kindref="member">previousFiles</ref>;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>changes<sp/>are<sp/>carried<sp/>through<sp/>until<sp/>metadata<sp/>is<sp/>read<sp/>from<sp/>a<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/>this.changes<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a25930ba1c1c77278fd0ef5fc19bf6e91" kindref="member">changes</ref>;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>this.snapshotsById<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4aa7f8423b34456f606659665b496cd3" kindref="member">indexAndValidateSnapshots</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/>this.schemasById<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a410d1e3ce9fc256ef45965d023ff27ed" kindref="member">indexSchemas</ref>();</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/>this.specsById<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a95e23f2284be9cf307e734a67721b201" kindref="member">indexSpecs</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>);</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>this.sortOrdersById<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac0f11e4580453c944f8f5735fb070f82" kindref="member">indexSortOrders</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/>this.refs<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaab201974579e85286a054778717e11b" kindref="member">validateRefs</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adb822582e40311fdbed1da1463705d84" kindref="member">refs</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>);</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>this.statisticsFiles<sp/>=<sp/>ImmutableList.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac9321d1f30da2a5c616e0a7c594b9a5b" kindref="member">statisticsFiles</ref>);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/>this.partitionStatisticsFiles<sp/>=<sp/>ImmutableList.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae19000a9f50443b79f61ad0e27d18c15" kindref="member">partitionStatisticsFiles</ref>);</highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry" kindref="compound">HistoryEntry</ref><sp/>last<sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry" kindref="compound">HistoryEntry</ref><sp/>logEntry<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa05771fd2ba796008ccc498ef25c40a4" kindref="member">snapshotLog</ref>)<sp/>{</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(last<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(logEntry.timestampMillis()<sp/>-<sp/>last.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry_1a4fdf8903c3f42e66a47fbe87a4e31476" kindref="member">timestampMillis</ref>())<sp/>&gt;=<sp/>-<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5e59137c29ea9b926d6d174994a6936c" kindref="member">ONE_MINUTE</ref>,</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[BUG]<sp/>Expected<sp/>sorted<sp/>snapshot<sp/>log<sp/>entries.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>last<sp/>=<sp/>logEntry;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(last<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>commits<sp/>can<sp/>happen<sp/>concurrently<sp/>from<sp/>different<sp/>machines.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>tolerance<sp/>helps<sp/>us<sp/>avoid<sp/>failure<sp/>for<sp/>small<sp/>clock<sp/>skew</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref><sp/>-<sp/>last.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry_1a4fdf8903c3f42e66a47fbe87a4e31476" kindref="member">timestampMillis</ref>()<sp/>&gt;=<sp/>-<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5e59137c29ea9b926d6d174994a6936c" kindref="member">ONE_MINUTE</ref>,</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>update<sp/>timestamp<sp/>%s:<sp/>before<sp/>last<sp/>snapshot<sp/>log<sp/>entry<sp/>at<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref>,</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>last.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry_1a4fdf8903c3f42e66a47fbe87a4e31476" kindref="member">timestampMillis</ref>());</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref><sp/>previous<sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref><sp/>metadataEntry<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7ed40349c58b7cfec01589bd5707afa2" kindref="member">previousFiles</ref>)<sp/>{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(previous<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>commits<sp/>can<sp/>happen<sp/>concurrently<sp/>from<sp/>different<sp/>machines.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>tolerance<sp/>helps<sp/>us<sp/>avoid<sp/>failure<sp/>for<sp/>small<sp/>clock<sp/>skew</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(metadataEntry.timestampMillis()<sp/>-<sp/>previous.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref>())<sp/>&gt;=<sp/>-<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5e59137c29ea9b926d6d174994a6936c" kindref="member">ONE_MINUTE</ref>,</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[BUG]<sp/>Expected<sp/>sorted<sp/>previous<sp/>metadata<sp/>log<sp/>entries.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>previous<sp/>=<sp/>metadataEntry;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>that<sp/>this<sp/>update&apos;s<sp/>lastUpdatedMillis<sp/>is<sp/>&gt;<sp/>max(previousFile&apos;s<sp/>timestamp)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(previous<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>commits<sp/>can<sp/>happen<sp/>concurrently<sp/>from<sp/>different<sp/>machines.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>tolerance<sp/>helps<sp/>us<sp/>avoid<sp/>failure<sp/>for<sp/>small<sp/>clock<sp/>skew</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref><sp/>-<sp/>previous.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref><sp/>&gt;=<sp/>-<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5e59137c29ea9b926d6d174994a6936c" kindref="member">ONE_MINUTE</ref>,</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>update<sp/>timestamp<sp/>%s:<sp/>before<sp/>the<sp/>latest<sp/>metadata<sp/>log<sp/>entry<sp/>timestamp<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref>,</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>previous.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry_1ab4429449392fffbee1a607d3fe418918" kindref="member">timestampMillis</ref>);</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1abe59a8710fd841ea469477fab331e669" kindref="member">validateCurrentSnapshot</ref>();</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight></codeline>
<codeline lineno="389" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5f23004a7bb48d7745f8c48955a9fca0" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5f23004a7bb48d7745f8c48955a9fca0" kindref="member">formatVersion</ref>()<sp/>{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight></codeline>
<codeline lineno="393" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac69ca8cf0da7383c95a1ebee2895bb53" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac69ca8cf0da7383c95a1ebee2895bb53" kindref="member">metadataFileLocation</ref>()<sp/>{</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac705dac4a1961c8c6ca368efed8824ca" kindref="member">metadataFileLocation</ref>;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight></codeline>
<codeline lineno="397" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1af0d139e1132bf3f2e701f010d9f375bd" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1af0d139e1132bf3f2e701f010d9f375bd" kindref="member">uuid</ref>()<sp/>{</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aeaf11035990f2126554fb1c282bde048" kindref="member">uuid</ref>;</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1afa1e5b159d0ed7d9a8f28a7151593311" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1afa1e5b159d0ed7d9a8f28a7151593311" kindref="member">lastSequenceNumber</ref>()<sp/>{</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>;</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1abcef801526a6d0d84dd61f98e0541d9f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1abcef801526a6d0d84dd61f98e0541d9f" kindref="member">nextSequenceNumber</ref>()<sp/>{</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref><sp/>&gt;<sp/>1<sp/>?<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref><sp/>+<sp/>1<sp/>:<sp/>INITIAL_SEQUENCE_NUMBER;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aae5bbd718efe6fa57ee16b1400916df3" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aae5bbd718efe6fa57ee16b1400916df3" kindref="member">lastUpdatedMillis</ref>()<sp/>{</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref>;</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1abe26ddfa30f0fd5b0580b9d87045598f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1abe26ddfa30f0fd5b0580b9d87045598f" kindref="member">lastColumnId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" kindref="member">lastColumnId</ref>;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>()<sp/>{</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a96b74dc5c7258bf06ad0ae65a777038f" kindref="member">schemasById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a32e01f41a44efcee6008285b8c7d29" kindref="member">currentSchemaId</ref>);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="420"><highlight class="normal"></highlight></codeline>
<codeline lineno="421" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae1c15a0430a60bfca6bdb474ecbcab9c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;Schema&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae1c15a0430a60bfca6bdb474ecbcab9c" kindref="member">schemas</ref>()<sp/>{</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ade3734193181eeec7369a0b85cb6e8dc" kindref="member">schemas</ref>;</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a99ceed74739d8b3fe1ffb1177173015b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>Schema&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a99ceed74739d8b3fe1ffb1177173015b" kindref="member">schemasById</ref>()<sp/>{</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a96b74dc5c7258bf06ad0ae65a777038f" kindref="member">schemasById</ref>;</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="428"><highlight class="normal"></highlight></codeline>
<codeline lineno="429" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7f540c12ca49532d6fcbd73e3cb4f3b2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7f540c12ca49532d6fcbd73e3cb4f3b2" kindref="member">currentSchemaId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a32e01f41a44efcee6008285b8c7d29" kindref="member">currentSchemaId</ref>;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"></highlight></codeline>
<codeline lineno="433" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>()<sp/>{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4f9788bbc885776fbbaefb19c8d72e1c" kindref="member">specsById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa110a34400fb957b29e0fde7810d9a16" kindref="member">defaultSpecId</ref>);</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a326a6dd737995461af85bf7c2d444caf" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a326a6dd737995461af85bf7c2d444caf" kindref="member">spec</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">id</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4f9788bbc885776fbbaefb19c8d72e1c" kindref="member">specsById</ref>.get(</highlight><highlight class="keywordtype">id</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4043302147344faf129f412dfcee1af3" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;PartitionSpec&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4043302147344faf129f412dfcee1af3" kindref="member">specs</ref>()<sp/>{</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>;</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"></highlight></codeline>
<codeline lineno="445" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad931e3fc293c67183d0eeecb64147668" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>PartitionSpec&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad931e3fc293c67183d0eeecb64147668" kindref="member">specsById</ref>()<sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4f9788bbc885776fbbaefb19c8d72e1c" kindref="member">specsById</ref>;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa4fe84485df3cf92a861e2da039312cb" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa4fe84485df3cf92a861e2da039312cb" kindref="member">lastAssignedPartitionId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad0607b9a2d14b67fd3b3511ed18bd8a2" kindref="member">lastAssignedPartitionId</ref>;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a8386b8835c61102bdbd581c0bfe05af9" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a8386b8835c61102bdbd581c0bfe05af9" kindref="member">defaultSpecId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa110a34400fb957b29e0fde7810d9a16" kindref="member">defaultSpecId</ref>;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="456"><highlight class="normal"></highlight></codeline>
<codeline lineno="457" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ace781a1b9d651003149bc5dd710650b5" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ace781a1b9d651003149bc5dd710650b5" kindref="member">defaultSortOrderId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a371dc7fa43a395068072fcfe61687b3c" kindref="member">defaultSortOrderId</ref>;</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="460"><highlight class="normal"></highlight></codeline>
<codeline lineno="461" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>()<sp/>{</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaf38fa5e67b795fd0a5c111b01abc898" kindref="member">sortOrdersById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a371dc7fa43a395068072fcfe61687b3c" kindref="member">defaultSortOrderId</ref>);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4e98cd73ddddffc80a28dddda49c00c8" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;SortOrder&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4e98cd73ddddffc80a28dddda49c00c8" kindref="member">sortOrders</ref>()<sp/>{</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>;</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5743692ee155100a708074ca69c738b4" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>SortOrder&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5743692ee155100a708074ca69c738b4" kindref="member">sortOrdersById</ref>()<sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaf38fa5e67b795fd0a5c111b01abc898" kindref="member">sortOrdersById</ref>;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="472"><highlight class="normal"></highlight></codeline>
<codeline lineno="473" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae084f4b769df3ac226e0f0109c946357" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae084f4b769df3ac226e0f0109c946357" kindref="member">location</ref>()<sp/>{</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>;</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="476"><highlight class="normal"></highlight></codeline>
<codeline lineno="477" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a465ef0619cca62c75f4ad70f98aa94be" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a465ef0619cca62c75f4ad70f98aa94be" kindref="member">properties</ref>()<sp/>{</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>;</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>(String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>,<sp/>String<sp/>defaultValue)<sp/>{</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>.getOrDefault(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>,<sp/>defaultValue);</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3921b997369301ca5ae29e09d1881dde" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3921b997369301ca5ae29e09d1881dde" kindref="member">propertyAsBoolean</ref>(String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>,<sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>defaultValue)<sp/>{</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a815bb60acfdf24932c858baa8afe18f2" kindref="member">propertyAsBoolean</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>,<sp/>defaultValue);</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a65ae7896b35ff573f7823196457d5f9a" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a65ae7896b35ff573f7823196457d5f9a" kindref="member">propertyAsInt</ref>(String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>defaultValue)<sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>,<sp/>defaultValue);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9e7d8fd618daa9f74774e4cc17b620dd" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9e7d8fd618daa9f74774e4cc17b620dd" kindref="member">propertyAsLong</ref>(String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>defaultValue)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a3aa85645457d631be688a88d88007f72" kindref="member">propertyAsLong</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a595cb9c0526b63e344f4c15c6bc9018e" kindref="member">property</ref>,<sp/>defaultValue);</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight></codeline>
<codeline lineno="497" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId)<sp/>{</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>.containsKey(snapshotId))<sp/>{</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aac330c5e0996704ca30376abfb5decfe" kindref="member">ensureSnapshotsLoaded</ref>();</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>.get(snapshotId);</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight></codeline>
<codeline lineno="505" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adc8f2689257e98a9bc85c7818accddd8" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adc8f2689257e98a9bc85c7818accddd8" kindref="member">currentSnapshot</ref>()<sp/>{</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>);</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight></codeline>
<codeline lineno="509" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac8c5769bd032b6700347a3c4227bb042" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac8c5769bd032b6700347a3c4227bb042" kindref="member">snapshots</ref>()<sp/>{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aac330c5e0996704ca30376abfb5decfe" kindref="member">ensureSnapshotsLoaded</ref>();</highlight></codeline>
<codeline lineno="511"><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>;</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aac330c5e0996704ca30376abfb5decfe" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">synchronized</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aac330c5e0996704ca30376abfb5decfe" kindref="member">ensureSnapshotsLoaded</ref>()<sp/>{</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa2ef0b186a9dca7b5624ebbb9aa8e5b2" kindref="member">snapshotsLoaded</ref>)<sp/>{</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Snapshot&gt;<sp/>loadedSnapshots<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a6d3382103c6d4be0144bfe5d91ee37f9" kindref="member">snapshotsSupplier</ref>.get());</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>loadedSnapshots.removeIf(s<sp/>-&gt;<sp/>s.sequenceNumber()<sp/>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>);</highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshots<sp/>=<sp/>ImmutableList.copyOf(loadedSnapshots);</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotsById<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4aa7f8423b34456f606659665b496cd3" kindref="member">indexAndValidateSnapshots</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>);</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1abe59a8710fd841ea469477fab331e669" kindref="member">validateCurrentSnapshot</ref>();</highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.refs<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaab201974579e85286a054778717e11b" kindref="member">validateRefs</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adb822582e40311fdbed1da1463705d84" kindref="member">refs</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>);</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotsLoaded<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotsSupplier<sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>(String<sp/>name)<sp/>{</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adb822582e40311fdbed1da1463705d84" kindref="member">refs</ref>.get(name);</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="534"><highlight class="normal"></highlight></codeline>
<codeline lineno="535" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7c7044d50342fa87fe86425d2d4ff9ba" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>SnapshotRef&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7c7044d50342fa87fe86425d2d4ff9ba" kindref="member">refs</ref>()<sp/>{</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adb822582e40311fdbed1da1463705d84" kindref="member">refs</ref>;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="538"><highlight class="normal"></highlight></codeline>
<codeline lineno="539" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7fa1d44adef1a3b56b24109575ef6267" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;StatisticsFile&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7fa1d44adef1a3b56b24109575ef6267" kindref="member">statisticsFiles</ref>()<sp/>{</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac9321d1f30da2a5c616e0a7c594b9a5b" kindref="member">statisticsFiles</ref>;</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="542"><highlight class="normal"></highlight></codeline>
<codeline lineno="543" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee1ba51871f62351a86a88719d345d58" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;PartitionStatisticsFile&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee1ba51871f62351a86a88719d345d58" kindref="member">partitionStatisticsFiles</ref>()<sp/>{</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae19000a9f50443b79f61ad0e27d18c15" kindref="member">partitionStatisticsFiles</ref>;</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a27a38c62a168ac63afa453b8dbd71082" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;HistoryEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a27a38c62a168ac63afa453b8dbd71082" kindref="member">snapshotLog</ref>()<sp/>{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa05771fd2ba796008ccc498ef25c40a4" kindref="member">snapshotLog</ref>;</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight></codeline>
<codeline lineno="551" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0df6aa8aaa76fa7a0bebc1959a1d1e8c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;MetadataLogEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0df6aa8aaa76fa7a0bebc1959a1d1e8c" kindref="member">previousFiles</ref>()<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7ed40349c58b7cfec01589bd5707afa2" kindref="member">previousFiles</ref>;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight></codeline>
<codeline lineno="555" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab501afa8037a60908e297533d8dfc64c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>List&lt;MetadataUpdate&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab501afa8037a60908e297533d8dfc64c" kindref="member">changes</ref>()<sp/>{</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a25930ba1c1c77278fd0ef5fc19bf6e91" kindref="member">changes</ref>;</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="558"><highlight class="normal"></highlight></codeline>
<codeline lineno="559" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2751e1dac0e1c7cb7736da891b2c9275" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2751e1dac0e1c7cb7736da891b2c9275" kindref="member">withUUID</ref>()<sp/>{</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a292683cefa306ae450215f96fda8da88" kindref="member">assignUUID</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight></codeline>
<codeline lineno="563" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2d942871b700fc8aadd827bbd50b5b92" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2d942871b700fc8aadd827bbd50b5b92" kindref="member">updateSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>newSchema,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newLastColumnId)<sp/>{</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaf1befe08150633195495fad52f4a845" kindref="member">setCurrentSchema</ref>(newSchema,<sp/>newLastColumnId).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>caller<sp/>is<sp/>responsible<sp/>to<sp/>pass<sp/>a<sp/>newPartitionSpec<sp/>with<sp/>correct<sp/>partition<sp/>field<sp/>IDs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a86bf65536ace29bb3888bdb0f4432024" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a86bf65536ace29bb3888bdb0f4432024" kindref="member">updatePartitionSpec</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>newPartitionSpec)<sp/>{</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7d1665b8a905880ef8da5c95cef2901f" kindref="member">setDefaultPartitionSpec</ref>(newPartitionSpec).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0c5a21ceec48d966120d813045db90de" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0c5a21ceec48d966120d813045db90de" kindref="member">replaceSortOrder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>newOrder)<sp/>{</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab431e64d955ca5738205a469457d9ee6" kindref="member">setDefaultSortOrder</ref>(newOrder).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="575"><highlight class="normal"></highlight></codeline>
<codeline lineno="576" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9b4b94ce1a0b43bcc1d513227da45621" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9b4b94ce1a0b43bcc1d513227da45621" kindref="member">removeSnapshotsIf</ref>(Predicate&lt;Snapshot&gt;<sp/>removeIf)<sp/>{</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;Snapshot&gt;<sp/>toRemove<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>().stream().filter(removeIf).collect(Collectors.toList());</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6e5f3bb16df90e1c93f62f46b4116961" kindref="member">removeSnapshots</ref>(toRemove).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="580"><highlight class="normal"></highlight></codeline>
<codeline lineno="581" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75a1f54ae2cce60ef7a443fa2c826bb2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75a1f54ae2cce60ef7a443fa2c826bb2" kindref="member">replaceProperties</ref>(Map&lt;String,<sp/>String&gt;<sp/>rawProperties)<sp/>{</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(rawProperties<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>properties<sp/>to<sp/>null&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/>newProperties<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a09293f58ab6d5acdaecebee2f6cb53bc" kindref="member">unreservedProperties</ref>(rawProperties);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>removed<sp/>=<sp/>Sets.newHashSet(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>.keySet());</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/>updated<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(Map.Entry&lt;String,<sp/>String&gt;<sp/>entry<sp/>:<sp/>newProperties.entrySet())<sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>removed.remove(entry.getKey());</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>current<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>.get(entry.getKey());</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(current<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>||<sp/>!current.equals(entry.getValue()))<sp/>{</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>updated.put(entry.getKey(),<sp/>entry.getValue());</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newFormatVersion<sp/>=</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(rawProperties,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1aa8404f9a8c213ac178c05007df711369" kindref="member">FORMAT_VERSION</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>);</highlight></codeline>
<codeline lineno="597"><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a84c1c893420c444ef49336aa9847c395" kindref="member">setProperties</ref>(updated)</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a3f32bc2dde19429df5a57244a06eb7d4" kindref="member">removeProperties</ref>(removed)</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acf2fa26e3fa1f684e2eb0926c0f2e901" kindref="member">upgradeFormatVersion</ref>(newFormatVersion)</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight></codeline>
<codeline lineno="605" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1abe59a8710fd841ea469477fab331e669" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1abe59a8710fd841ea469477fab331e669" kindref="member">validateCurrentSnapshot</ref>()<sp/>{</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref><sp/>&lt;<sp/>0<sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>.containsKey(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>),</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>table<sp/>metadata:<sp/>Cannot<sp/>find<sp/>current<sp/>version&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1af1f601fcb171ce9972aed243f80ddc03" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1af1f601fcb171ce9972aed243f80ddc03" kindref="member">reassignPartitionIds</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>partitionSpec,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil" kindref="compound">TypeUtil</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil_1_1NextID" kindref="compound">NextID</ref><sp/>nextID)<sp/>{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1_1Builder" kindref="compound">Builder</ref><sp/>specBuilder<sp/>=</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a5f73aba02e3dd22ce2b33483bf460dbe" kindref="member">builderFor</ref>(partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a611f78e3b6d828a1f03b8ab49a1bfe3f" kindref="member">schema</ref>()).withSpecId(partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a717532406f4cf60207b057607b89c0ec" kindref="member">specId</ref>());</highlight></codeline>
<codeline lineno="614"><highlight class="normal"></highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref><sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>v2<sp/>and<sp/>later,<sp/>reuse<sp/>any<sp/>existing<sp/>field<sp/>IDs,<sp/>but<sp/>reproduce<sp/>the<sp/>same<sp/>spec</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;Pair&lt;Integer,<sp/>String&gt;,<sp/>Integer&gt;<sp/>transformToFieldId<sp/>=</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>.stream()</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.flatMap(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref><sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a9e4d9fea3edf1aed8d8e7ef1f0392450" kindref="member">fields</ref>().stream())</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.collect(</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Collectors.toMap(</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>field<sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair" kindref="compound">Pair</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair_1a3856d0c570993ee5a8eb67055ccc6baa" kindref="member">of</ref>(field.sourceId(),<sp/>field.transform().toString()),</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField_1a6ea2c54e63002a834c1c1e04afa5cc26" kindref="member">PartitionField::fieldId</ref>,</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Math::max));</highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>field<sp/>:<sp/>partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a9e4d9fea3edf1aed8d8e7ef1f0392450" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>reassign<sp/>the<sp/>partition<sp/>field<sp/>ids</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>partitionFieldId<sp/>=</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>transformToFieldId.computeIfAbsent(</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair" kindref="compound">Pair</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair_1a3856d0c570993ee5a8eb67055ccc6baa" kindref="member">of</ref>(field.sourceId(),<sp/>field.transform().toString()),<sp/>k<sp/>-&gt;<sp/>nextID.get());</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specBuilder.add(field.sourceId(),<sp/>partitionFieldId,<sp/>field.name(),<sp/>field.transform());</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>v1,<sp/>preserve<sp/>the<sp/>existing<sp/>spec<sp/>and<sp/>carry<sp/>forward<sp/>all<sp/>fields,<sp/>replacing<sp/>missing<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>with<sp/>void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;Pair&lt;Integer,<sp/>String&gt;,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref>&gt;<sp/>newFields<sp/>=<sp/>Maps.newLinkedHashMap();</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>newField<sp/>:<sp/>partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a9e4d9fea3edf1aed8d8e7ef1f0392450" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFields.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair" kindref="compound">Pair</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair_1a3856d0c570993ee5a8eb67055ccc6baa" kindref="member">of</ref>(newField.sourceId(),<sp/>newField.transform().toString()),<sp/>newField);</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;String&gt;<sp/>newFieldNames<sp/>=</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFields.values().stream().map(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField_1a2f3003f8472967291b852ebdb017c8ba" kindref="member">PartitionField::name</ref>).collect(Collectors.toList());</highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>field<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>().fields())<sp/>{</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ensure<sp/>each<sp/>field<sp/>is<sp/>either<sp/>carried<sp/>forward<sp/>or<sp/>replaced<sp/>with<sp/>void</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>newField<sp/>=</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFields.remove(<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair" kindref="compound">Pair</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1Pair_1a3856d0c570993ee5a8eb67055ccc6baa" kindref="member">of</ref>(field.sourceId(),<sp/>field.transform().toString()));</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newField<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>copy<sp/>the<sp/>new<sp/>field<sp/>with<sp/>the<sp/>existing<sp/>field<sp/>ID</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specBuilder.add(</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newField.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField_1ae71e677f996cbf373524eb3766857825" kindref="member">sourceId</ref>(),<sp/>field.fieldId(),<sp/>newField.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField_1a2f3003f8472967291b852ebdb017c8ba" kindref="member">name</ref>(),<sp/>newField.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField_1a960af280efef71ff02210d0360a0d6c5" kindref="member">transform</ref>());</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Rename<sp/>old<sp/>void<sp/>transforms<sp/>that<sp/>would<sp/>otherwise<sp/>conflict</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>voidName<sp/>=</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFieldNames.contains(field.name())</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>?<sp/>field.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField_1a2f3003f8472967291b852ebdb017c8ba" kindref="member">name</ref>()<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;_&quot;</highlight><highlight class="normal"><sp/>+<sp/>field.fieldId()</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>field.name();</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specBuilder.add(field.sourceId(),<sp/>field.fieldId(),<sp/>voidName,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1transforms_1_1Transforms" kindref="compound">Transforms</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1transforms_1_1Transforms_1ac4d8039a673320c73796437121003b65" kindref="member">alwaysNull</ref>());</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="661"><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>any<sp/>remaining<sp/>new<sp/>fields<sp/>at<sp/>the<sp/>end<sp/>and<sp/>assign<sp/>new<sp/>partition<sp/>field<sp/>IDs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>newField<sp/>:<sp/>newFields.values())<sp/>{</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specBuilder.add(newField.sourceId(),<sp/>nextID.get(),<sp/>newField.name(),<sp/>newField.transform());</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="667"><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>specBuilder.build();</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="670"><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>caller<sp/>is<sp/>responsible<sp/>to<sp/>pass<sp/>a<sp/>updatedPartitionSpec<sp/>with<sp/>correct<sp/>partition<sp/>field<sp/>IDs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0a1f6ac20bdca2683c7649278f6e6bf3" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0a1f6ac20bdca2683c7649278f6e6bf3" kindref="member">buildReplacement</ref>(</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>updatedSchema,</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>updatedPartitionSpec,</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>updatedSortOrder,</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>newLocation,</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/>updatedProperties)<sp/>{</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref><sp/>&gt;<sp/>1<sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.hasSequentialIds(updatedPartitionSpec),</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Spec<sp/>does<sp/>not<sp/>use<sp/>sequential<sp/>IDs<sp/>that<sp/>are<sp/>required<sp/>in<sp/>v1:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>updatedPartitionSpec);</highlight></codeline>
<codeline lineno="682"><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/>AtomicInteger<sp/>newLastColumnId<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>AtomicInteger(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" kindref="member">lastColumnId</ref>);</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>freshSchema<sp/>=</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil" kindref="compound">TypeUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1TypeUtil_1a85a90df5b652ab26af8920d59269e157" kindref="member">assignFreshIds</ref>(updatedSchema,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>(),<sp/>newLastColumnId::incrementAndGet);</highlight></codeline>
<codeline lineno="686"><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rebuild<sp/>the<sp/>partition<sp/>spec<sp/>using<sp/>the<sp/>new<sp/>column<sp/>ids<sp/>and<sp/>reassign<sp/>partition<sp/>field<sp/>ids<sp/>to<sp/>align</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>with<sp/>existing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>partition<sp/>specs<sp/>in<sp/>the<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a188d04143e3429e8f5c0cced43f2d492" kindref="member">freshSpec</ref><sp/>=</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1af1f601fcb171ce9972aed243f80ddc03" kindref="member">reassignPartitionIds</ref>(</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a188d04143e3429e8f5c0cced43f2d492" kindref="member">freshSpec</ref>(INITIAL_SPEC_ID,<sp/>freshSchema,<sp/>updatedPartitionSpec),</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>AtomicInteger(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad0607b9a2d14b67fd3b3511ed18bd8a2" kindref="member">lastAssignedPartitionId</ref>)::incrementAndGet);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rebuild<sp/>the<sp/>sort<sp/>order<sp/>using<sp/>new<sp/>column<sp/>ids</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" kindref="member">freshSortOrder</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" kindref="member">freshSortOrder</ref>(INITIAL_SORT_ORDER_ID,<sp/>freshSchema,<sp/>updatedSortOrder);</highlight></codeline>
<codeline lineno="697"><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>there<sp/>is<sp/>format<sp/>version<sp/>override</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newFormatVersion<sp/>=</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>updatedProperties,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1aa8404f9a8c213ac178c05007df711369" kindref="member">FORMAT_VERSION</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>);</highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acf2fa26e3fa1f684e2eb0926c0f2e901" kindref="member">upgradeFormatVersion</ref>(newFormatVersion)</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a65413fe541ebdc83cf7d3f8d8a9c639d" kindref="member">resetMainBranch</ref>()</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaf1befe08150633195495fad52f4a845" kindref="member">setCurrentSchema</ref>(freshSchema,<sp/>newLastColumnId.get())</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7d1665b8a905880ef8da5c95cef2901f" kindref="member">setDefaultPartitionSpec</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a188d04143e3429e8f5c0cced43f2d492" kindref="member">freshSpec</ref>)</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab431e64d955ca5738205a469457d9ee6" kindref="member">setDefaultSortOrder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" kindref="member">freshSortOrder</ref>)</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a42c8f656126e83cf2e5b3a6d4b7bc2e6" kindref="member">setLocation</ref>(newLocation)</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a84c1c893420c444ef49336aa9847c395" kindref="member">setProperties</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a3c8b4bc35251afb226e865b754f66fd0" kindref="member">persistedProperties</ref>(updatedProperties))</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="713"><highlight class="normal"></highlight></codeline>
<codeline lineno="714" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a6fb7bb9cc7e53605c25bf120fa075222" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a6fb7bb9cc7e53605c25bf120fa075222" kindref="member">updateLocation</ref>(String<sp/>newLocation)<sp/>{</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a42c8f656126e83cf2e5b3a6d4b7bc2e6" kindref="member">setLocation</ref>(newLocation).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="717"><highlight class="normal"></highlight></codeline>
<codeline lineno="718" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a61c390cd4e4917653400a250133405de" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a61c390cd4e4917653400a250133405de" kindref="member">upgradeToFormatVersion</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newFormatVersion)<sp/>{</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acf2fa26e3fa1f684e2eb0926c0f2e901" kindref="member">upgradeFormatVersion</ref>(newFormatVersion).<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="721"><highlight class="normal"></highlight></codeline>
<codeline lineno="722" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad3b5acb736a4f769009e6c80c1caf60c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad3b5acb736a4f769009e6c80c1caf60c" kindref="member">updateSpecSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>partitionSpec)<sp/>{</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1_1Builder" kindref="compound">Builder</ref><sp/>specBuilder<sp/>=</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a5f73aba02e3dd22ce2b33483bf460dbe" kindref="member">builderFor</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>).withSpecId(partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a717532406f4cf60207b057607b89c0ec" kindref="member">specId</ref>());</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>all<sp/>the<sp/>fields<sp/>to<sp/>the<sp/>builder.<sp/>IDs<sp/>should<sp/>not<sp/>change.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>field<sp/>:<sp/>partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a9e4d9fea3edf1aed8d8e7ef1f0392450" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>specBuilder.add(field.sourceId(),<sp/>field.fieldId(),<sp/>field.name(),<sp/>field.transform());</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="730"><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>build<sp/>without<sp/>validation<sp/>because<sp/>the<sp/>schema<sp/>may<sp/>have<sp/>changed<sp/>in<sp/>a<sp/>way<sp/>that<sp/>makes<sp/>this<sp/>spec</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>invalid.<sp/>the<sp/>spec</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>should<sp/>still<sp/>be<sp/>preserved<sp/>so<sp/>that<sp/>older<sp/>metadata<sp/>can<sp/>be<sp/>interpreted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>specBuilder.buildUnchecked();</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab113e524aaa93faf9aaa4facf2b58c9b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab113e524aaa93faf9aaa4facf2b58c9b" kindref="member">updateSortOrderSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>)<sp/>{</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1_1Builder" kindref="compound">Builder</ref><sp/>builder<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a445cf4d25797620e3d26b1074301c730" kindref="member">builderFor</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>).withOrderId(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a33c4d179099cd454e31438ce54dd7aef" kindref="member">orderId</ref>());</highlight></codeline>
<codeline lineno="739"><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>all<sp/>the<sp/>fields<sp/>to<sp/>the<sp/>builder.<sp/>IDs<sp/>should<sp/>not<sp/>change.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortField" kindref="compound">SortField</ref><sp/>field<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a332fdc761db41371f5da464fcdc71d52" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>builder.addSortField(</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>field.transform(),<sp/>field.sourceId(),<sp/>field.direction(),<sp/>field.nullOrder());</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="745"><highlight class="normal"></highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>build<sp/>without<sp/>validation<sp/>because<sp/>the<sp/>schema<sp/>may<sp/>have<sp/>changed<sp/>in<sp/>a<sp/>way<sp/>that<sp/>makes<sp/>this<sp/>order</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>invalid.<sp/>the<sp/>order</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>should<sp/>still<sp/>be<sp/>preserved<sp/>so<sp/>that<sp/>older<sp/>metadata<sp/>can<sp/>be<sp/>interpreted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>builder.buildUnchecked();</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="751"><highlight class="normal"></highlight></codeline>
<codeline lineno="752" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a188d04143e3429e8f5c0cced43f2d492" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a188d04143e3429e8f5c0cced43f2d492" kindref="member">freshSpec</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>specId,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>partitionSpec)<sp/>{</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundPartitionSpec" kindref="compound">UnboundPartitionSpec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundPartitionSpec_1_1Builder" kindref="compound">Builder</ref><sp/>specBuilder<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundPartitionSpec" kindref="compound">UnboundPartitionSpec</ref>.builder().withSpecId(specId);</highlight></codeline>
<codeline lineno="754"><highlight class="normal"></highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionField" kindref="compound">PartitionField</ref><sp/>field<sp/>:<sp/>partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a9e4d9fea3edf1aed8d8e7ef1f0392450" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>look<sp/>up<sp/>the<sp/>name<sp/>of<sp/>the<sp/>source<sp/>field<sp/>in<sp/>the<sp/>old<sp/>schema<sp/>to<sp/>get<sp/>the<sp/>new<sp/>schema&apos;s<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>sourceName<sp/>=<sp/>partitionSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a611f78e3b6d828a1f03b8ab49a1bfe3f" kindref="member">schema</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1ab28504a59163b01a97dd03f76d7ce93e" kindref="member">findColumnName</ref>(field.sourceId());</highlight></codeline>
<codeline lineno="758"><highlight class="normal"></highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fieldId;</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sourceName<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fieldId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1af6a287dd0c94d0a15ae7304a49fa87c4" kindref="member">findField</ref>(sourceName).<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1NestedField_1abc4eb81018cd54fa87a45420667b7cdb" kindref="member">fieldId</ref>();</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>In<sp/>the<sp/>case<sp/>of<sp/>a<sp/>null<sp/>sourceName,<sp/>the<sp/>column<sp/>has<sp/>been<sp/>deleted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>only<sp/>happens<sp/>in<sp/>V1<sp/>tables<sp/>where<sp/>the<sp/>reference<sp/>is<sp/>still<sp/>around<sp/>as<sp/>a<sp/>void<sp/>transform</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fieldId<sp/>=<sp/>field.sourceId();</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>specBuilder.addField(field.transform().toString(),<sp/>fieldId,<sp/>field.fieldId(),<sp/>field.name());</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="769"><highlight class="normal"></highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>specBuilder.build().bind(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="772"><highlight class="normal"></highlight></codeline>
<codeline lineno="773" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" kindref="member">freshSortOrder</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>orderId,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>)<sp/>{</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundSortOrder" kindref="compound">UnboundSortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundSortOrder_1_1Builder" kindref="compound">Builder</ref><sp/>builder<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundSortOrder" kindref="compound">UnboundSortOrder</ref>.builder();</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a4377e8edfd41baa3eb9239b7da4a2d3c" kindref="member">isSorted</ref>())<sp/>{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>builder.withOrderId(orderId);</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="779"><highlight class="normal"></highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortField" kindref="compound">SortField</ref><sp/>field<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a332fdc761db41371f5da464fcdc71d52" kindref="member">fields</ref>())<sp/>{</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>look<sp/>up<sp/>the<sp/>name<sp/>of<sp/>the<sp/>source<sp/>field<sp/>in<sp/>the<sp/>old<sp/>schema<sp/>to<sp/>get<sp/>the<sp/>new<sp/>schema&apos;s<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>sourceName<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a29731ba3323edef0c8fccabfc039e6a1" kindref="member">schema</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1ab28504a59163b01a97dd03f76d7ce93e" kindref="member">findColumnName</ref>(field.sourceId());</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>reassign<sp/>all<sp/>sort<sp/>fields<sp/>with<sp/>fresh<sp/>sort<sp/>field<sp/>IDs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newSourceId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1af6a287dd0c94d0a15ae7304a49fa87c4" kindref="member">findField</ref>(sourceName).<ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1NestedField_1abc4eb81018cd54fa87a45420667b7cdb" kindref="member">fieldId</ref>();</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>builder.addSortField(</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>field.transform().toString(),<sp/>newSourceId,<sp/>field.direction(),<sp/>field.nullOrder());</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="788"><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>builder.build().bind(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="791"><highlight class="normal"></highlight></codeline>
<codeline lineno="792" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4aa7f8423b34456f606659665b496cd3" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;Long,<sp/>Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4aa7f8423b34456f606659665b496cd3" kindref="member">indexAndValidateSnapshots</ref>(</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>)<sp/>{</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableMap.Builder&lt;Long,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref>&gt;<sp/>builder<sp/>=<sp/>ImmutableMap.builder();</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/>snap<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>)<sp/>{</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snap.sequenceNumber()<sp/>&lt;=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>,</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>snapshot<sp/>with<sp/>sequence<sp/>number<sp/>%s<sp/>greater<sp/>than<sp/>last<sp/>sequence<sp/>number<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snap.sequenceNumber(),</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>);</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>builder.put(snap.snapshotId(),<sp/>snap);</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>builder.build();</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="805"><highlight class="normal"></highlight></codeline>
<codeline lineno="806" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a410d1e3ce9fc256ef45965d023ff27ed" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>Schema&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a410d1e3ce9fc256ef45965d023ff27ed" kindref="member">indexSchemas</ref>()<sp/>{</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableMap.Builder&lt;Integer,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref>&gt;<sp/>builder<sp/>=<sp/>ImmutableMap.builder();</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref><sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ade3734193181eeec7369a0b85cb6e8dc" kindref="member">schemas</ref>)<sp/>{</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>builder.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a8552d7c8436cc4890a06ee15dd79e4a2" kindref="member">schemaId</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>builder.build();</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="814" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a95e23f2284be9cf307e734a67721b201" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>PartitionSpec&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a95e23f2284be9cf307e734a67721b201" kindref="member">indexSpecs</ref>(List&lt;PartitionSpec&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>)<sp/>{</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableMap.Builder&lt;Integer,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>&gt;<sp/>builder<sp/>=<sp/>ImmutableMap.builder();</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref><sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>)<sp/>{</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>builder.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a717532406f4cf60207b057607b89c0ec" kindref="member">specId</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>);</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>builder.build();</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="821"><highlight class="normal"></highlight></codeline>
<codeline lineno="822" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac0f11e4580453c944f8f5735fb070f82" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>SortOrder&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac0f11e4580453c944f8f5735fb070f82" kindref="member">indexSortOrders</ref>(List&lt;SortOrder&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>)<sp/>{</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableMap.Builder&lt;Integer,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>&gt;<sp/>builder<sp/>=<sp/>ImmutableMap.builder();</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref><sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>)<sp/>{</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>builder.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a33c4d179099cd454e31438ce54dd7aef" kindref="member">orderId</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a01c7579f149e0091cce68061ca048e94" kindref="member">sortOrder</ref>);</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>builder.build();</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="829"><highlight class="normal"></highlight></codeline>
<codeline lineno="830" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaab201974579e85286a054778717e11b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>SnapshotRef&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaab201974579e85286a054778717e11b" kindref="member">validateRefs</ref>(</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>,</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>SnapshotRef&gt;<sp/>inputRefs,</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;Long,<sp/>Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>)<sp/>{</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>:<sp/>inputRefs.values())<sp/>{</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>.containsKey(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>()),</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Snapshot<sp/>for<sp/>reference<sp/>%s<sp/>does<sp/>not<sp/>exist<sp/>in<sp/>the<sp/>existing<sp/>snapshots<sp/>list&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>);</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="840"><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/>main<sp/>=<sp/>inputRefs.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1abdf963b32b246b385e9d059f26ca4faf" kindref="member">MAIN_BRANCH</ref>);</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref><sp/>!=<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>main<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref><sp/>==<sp/>main.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>(),</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Current<sp/>snapshot<sp/>ID<sp/>does<sp/>not<sp/>match<sp/>main<sp/>branch<sp/>(%s<sp/>!=<sp/>%s)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>,</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>main<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>?<sp/>main.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>()<sp/>:<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>main<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Current<sp/>snapshot<sp/>is<sp/>not<sp/>set,<sp/>but<sp/>main<sp/>branch<sp/>exists:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>main);</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>inputRefs;</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="855"><highlight class="normal"></highlight></codeline>
<codeline lineno="856" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa4c8b99866c10cad05a0c893fe3f936d" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa4c8b99866c10cad05a0c893fe3f936d" kindref="member">buildFrom</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/>base)<sp/>{</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>(base);</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="859"><highlight class="normal"></highlight></codeline>
<codeline lineno="860" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a44f1055d32b1e739202a52f853446d12" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a44f1055d32b1e739202a52f853446d12" kindref="member">buildFromEmpty</ref>()<sp/>{</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref>();</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="863"><highlight class="normal"></highlight></codeline>
<codeline lineno="864" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" refkind="compound"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/>{</highlight></codeline>
<codeline lineno="865" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab12564490002d875f72d3f684b71f081" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab12564490002d875f72d3f684b71f081" kindref="member">LAST_ADDED</ref><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="866"><highlight class="normal"></highlight></codeline>
<codeline lineno="867" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>;</highlight></codeline>
<codeline lineno="868" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aecd2ca80e5b1c8c2f04dc28408ccf592" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aecd2ca80e5b1c8c2f04dc28408ccf592" kindref="member">metadataLocation</ref>;</highlight></codeline>
<codeline lineno="869" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" kindref="member">formatVersion</ref>;</highlight></codeline>
<codeline lineno="870" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a30ec0a42636e0c515a6e8123ec0354f2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a30ec0a42636e0c515a6e8123ec0354f2" kindref="member">uuid</ref>;</highlight></codeline>
<codeline lineno="871" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0d3da303a0898157840cfe317c5b91cb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Long<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0d3da303a0898157840cfe317c5b91cb" kindref="member">lastUpdatedMillis</ref>;</highlight></codeline>
<codeline lineno="872" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a046242c81f94ff0232ef1a2fe474b6f0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a046242c81f94ff0232ef1a2fe474b6f0" kindref="member">location</ref>;</highlight></codeline>
<codeline lineno="873" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7bcc7f95326451091cd60581196e2125" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7bcc7f95326451091cd60581196e2125" kindref="member">lastSequenceNumber</ref>;</highlight></codeline>
<codeline lineno="874" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aec67e86d475e6785d6ce440e58060137" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aec67e86d475e6785d6ce440e58060137" kindref="member">lastColumnId</ref>;</highlight></codeline>
<codeline lineno="875" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref>;</highlight></codeline>
<codeline lineno="876" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab090ceced86a8cf465599e67a003c8a1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;Schema&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab090ceced86a8cf465599e67a003c8a1" kindref="member">schemas</ref>;</highlight></codeline>
<codeline lineno="877" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abd596d3b422ab7aade58c106b732cd9a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abd596d3b422ab7aade58c106b732cd9a" kindref="member">defaultSpecId</ref>;</highlight></codeline>
<codeline lineno="878" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1adc09e5fe5ad6559834a543613180d426" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>List&lt;PartitionSpec&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1adc09e5fe5ad6559834a543613180d426" kindref="member">specs</ref>;</highlight></codeline>
<codeline lineno="879" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aad8cdec09e14351c474e0294de88e395" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aad8cdec09e14351c474e0294de88e395" kindref="member">lastAssignedPartitionId</ref>;</highlight></codeline>
<codeline lineno="880" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a02b6cec7377c51651d6c5ff0f57f5874" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a02b6cec7377c51651d6c5ff0f57f5874" kindref="member">defaultSortOrderId</ref>;</highlight></codeline>
<codeline lineno="881" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acde8c6d16236123ab526f0a39610478c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>List&lt;SortOrder&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acde8c6d16236123ab526f0a39610478c" kindref="member">sortOrders</ref>;</highlight></codeline>
<codeline lineno="882" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac3afe3a5109cd4c801659e4a1bdf17ec" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac3afe3a5109cd4c801659e4a1bdf17ec" kindref="member">properties</ref>;</highlight></codeline>
<codeline lineno="883" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>;</highlight></codeline>
<codeline lineno="884" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1af8b56637523cdc60a39a72fbca63897f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>List&lt;Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1af8b56637523cdc60a39a72fbca63897f" kindref="member">snapshots</ref>;</highlight></codeline>
<codeline lineno="885" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a2b67dc3d3792c0ff3d865f2c419a4328" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier&lt;List&lt;Snapshot&gt;</ref>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a2b67dc3d3792c0ff3d865f2c419a4328" kindref="member">snapshotsSupplier</ref>;</highlight></codeline>
<codeline lineno="886" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>SnapshotRef&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>;</highlight></codeline>
<codeline lineno="887" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1add7bb79df660a861f6cfa57f4d847743" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Long,<sp/>List&lt;StatisticsFile&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1add7bb79df660a861f6cfa57f4d847743" kindref="member">statisticsFiles</ref>;</highlight></codeline>
<codeline lineno="888" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1701b5ec82b5c95bea0a6a0b5bf58318" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Long,<sp/>List&lt;PartitionStatisticsFile&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1701b5ec82b5c95bea0a6a0b5bf58318" kindref="member">partitionStatisticsFiles</ref>;</highlight></codeline>
<codeline lineno="889" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a848587e217337791f17fb503ba6b94f6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a848587e217337791f17fb503ba6b94f6" kindref="member">suppressHistoricalSnapshots</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="890"><highlight class="normal"></highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>change<sp/>tracking</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="892" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;MetadataUpdate&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>;</highlight></codeline>
<codeline lineno="893" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1a37e27e374fcedd28b0ba37abc75dfd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1a37e27e374fcedd28b0ba37abc75dfd" kindref="member">startingChangeCount</ref>;</highlight></codeline>
<codeline lineno="894" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8b87f728247928842b221f7dea2e104e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8b87f728247928842b221f7dea2e104e" kindref="member">discardChanges</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="895" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7e30649bc6b036787d3b7b9ee5c3fe8a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Integer<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7e30649bc6b036787d3b7b9ee5c3fe8a" kindref="member">lastAddedSchemaId</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="896" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac4430fa1442c24cea3fb2b03c749f363" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Integer<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac4430fa1442c24cea3fb2b03c749f363" kindref="member">lastAddedSpecId</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="897" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae5fbaf2455c354b5e1ff8a98477feeed" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Integer<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae5fbaf2455c354b5e1ff8a98477feeed" kindref="member">lastAddedOrderId</ref><sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="898"><highlight class="normal"></highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>handled<sp/>in<sp/>build</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="900" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1b2eedec5fca5de43458417703a5638e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;HistoryEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1b2eedec5fca5de43458417703a5638e" kindref="member">snapshotLog</ref>;</highlight></codeline>
<codeline lineno="901" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa3a1c126acd609e1086f6de533b40642" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa3a1c126acd609e1086f6de533b40642" kindref="member">previousFileLocation</ref>;</highlight></codeline>
<codeline lineno="902" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>List&lt;MetadataLogEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>;</highlight></codeline>
<codeline lineno="903"><highlight class="normal"></highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>indexes<sp/>for<sp/>convenience</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="905" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Long,<sp/>Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>;</highlight></codeline>
<codeline lineno="906" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>Schema&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>;</highlight></codeline>
<codeline lineno="907" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaa27359b502cd9d3487f99da721e80db" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>PartitionSpec&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaa27359b502cd9d3487f99da721e80db" kindref="member">specsById</ref>;</highlight></codeline>
<codeline lineno="908" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a291e51381b0137fe93a7d8229dda75a6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;Integer,<sp/>SortOrder&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a291e51381b0137fe93a7d8229dda75a6" kindref="member">sortOrdersById</ref>;</highlight></codeline>
<codeline lineno="909"><highlight class="normal"></highlight></codeline>
<codeline lineno="910" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1afd7f1966fd2f319267effb0b5a56b5dd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1afd7f1966fd2f319267effb0b5a56b5dd" kindref="member">Builder</ref>()<sp/>{</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.base<sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.formatVersion<sp/>=<sp/>DEFAULT_TABLE_FORMAT_VERSION;</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastSequenceNumber<sp/>=<sp/>INITIAL_SEQUENCE_NUMBER;</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.uuid<sp/>=<sp/>UUID.randomUUID().toString();</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.schemas<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.specs<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.sortOrders<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.properties<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshots<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.currentSnapshotId<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.changes<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.startingChangeCount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotLog<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.previousFiles<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.refs<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.statisticsFiles<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.partitionStatisticsFiles<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotsById<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.schemasById<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.specsById<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.sortOrdersById<sp/>=<sp/>Maps.newHashMap();</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="933"><highlight class="normal"></highlight></codeline>
<codeline lineno="934" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8cafc751520bd468a84b1f9b55af401f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8cafc751520bd468a84b1f9b55af401f" kindref="member">Builder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>)<sp/>{</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.base<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>;</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.formatVersion<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae54894e715f34a59a65da8d17b0860dc" kindref="member">formatVersion</ref>;</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.uuid<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aeaf11035990f2126554fb1c282bde048" kindref="member">uuid</ref>;</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastUpdatedMillis<sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.location<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a96e43d31d934ff84fa15f46dac349c" kindref="member">location</ref>;</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastSequenceNumber<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a027c47955aabbb8671266c3be0942007" kindref="member">lastSequenceNumber</ref>;</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastColumnId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a75b4e6e78dee4a9062c35804cf922c81" kindref="member">lastColumnId</ref>;</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.currentSchemaId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a5a32e01f41a44efcee6008285b8c7d29" kindref="member">currentSchemaId</ref>;</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.schemas<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ade3734193181eeec7369a0b85cb6e8dc" kindref="member">schemas</ref>);</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.defaultSpecId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa110a34400fb957b29e0fde7810d9a16" kindref="member">defaultSpecId</ref>;</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.specs<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a082cc1b8ad85447e4db4ea262dc70f24" kindref="member">specs</ref>);</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastAssignedPartitionId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad0607b9a2d14b67fd3b3511ed18bd8a2" kindref="member">lastAssignedPartitionId</ref>;</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.defaultSortOrderId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a371dc7fa43a395068072fcfe61687b3c" kindref="member">defaultSortOrderId</ref>;</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.sortOrders<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab12151969d9ee1295caea376b805b34e" kindref="member">sortOrders</ref>);</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.properties<sp/>=<sp/>Maps.newHashMap(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac3d23826b623f3bb29602949337c6f55" kindref="member">properties</ref>);</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.currentSnapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a2372a588bd88f63fbcddf0426f3abdd9" kindref="member">currentSnapshotId</ref>;</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshots<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a591704b77bb6f3ebef4b74b2454bb20a" kindref="member">snapshots</ref>());</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.changes<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a25930ba1c1c77278fd0ef5fc19bf6e91" kindref="member">changes</ref>);</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.startingChangeCount<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.size();</highlight></codeline>
<codeline lineno="954"><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotLog<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa05771fd2ba796008ccc498ef25c40a4" kindref="member">snapshotLog</ref>);</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.previousFileLocation<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac705dac4a1961c8c6ca368efed8824ca" kindref="member">metadataFileLocation</ref>;</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.previousFiles<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a7ed40349c58b7cfec01589bd5707afa2" kindref="member">previousFiles</ref>;</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.refs<sp/>=<sp/>Maps.newHashMap(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1adb822582e40311fdbed1da1463705d84" kindref="member">refs</ref>);</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.statisticsFiles<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a173168a2b1e6991fa74f89376474ffb0" kindref="member">indexStatistics</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac9321d1f30da2a5c616e0a7c594b9a5b" kindref="member">statisticsFiles</ref>);</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.partitionStatisticsFiles<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5c72ee5dcad9d765bf8241131cb2f08a" kindref="member">indexPartitionStatistics</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ae19000a9f50443b79f61ad0e27d18c15" kindref="member">partitionStatisticsFiles</ref>);</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotsById<sp/>=<sp/>Maps.newHashMap(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4cc40533a43dcd9df902f40a3374559a" kindref="member">snapshotsById</ref>);</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.schemasById<sp/>=<sp/>Maps.newHashMap(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a96b74dc5c7258bf06ad0ae65a777038f" kindref="member">schemasById</ref>);</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.specsById<sp/>=<sp/>Maps.newHashMap(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a4f9788bbc885776fbbaefb19c8d72e1c" kindref="member">specsById</ref>);</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.sortOrdersById<sp/>=<sp/>Maps.newHashMap(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aaf38fa5e67b795fd0a5c111b01abc898" kindref="member">sortOrdersById</ref>);</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="966"><highlight class="normal"></highlight></codeline>
<codeline lineno="967" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0271b424cc041456b5c6b611e719d914" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0271b424cc041456b5c6b611e719d914" kindref="member">withMetadataLocation</ref>(String<sp/>newMetadataLocation)<sp/>{</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.metadataLocation<sp/>=<sp/>newMetadataLocation;</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="971"><highlight class="normal"></highlight></codeline>
<codeline lineno="972" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a292683cefa306ae450215f96fda8da88" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a292683cefa306ae450215f96fda8da88" kindref="member">assignUUID</ref>()<sp/>{</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a30ec0a42636e0c515a6e8123ec0354f2" kindref="member">uuid</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.uuid<sp/>=<sp/>UUID.randomUUID().toString();</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AssignUUID" kindref="compound">AssignUUID</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a30ec0a42636e0c515a6e8123ec0354f2" kindref="member">uuid</ref>));</highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="977"><highlight class="normal"></highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="980"><highlight class="normal"></highlight></codeline>
<codeline lineno="981" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa37481a2702dde7178414d54cdb8ee0c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa37481a2702dde7178414d54cdb8ee0c" kindref="member">assignUUID</ref>(String<sp/>newUuid)<sp/>{</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(newUuid<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>uuid<sp/>to<sp/>null&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="983"><highlight class="normal"></highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!newUuid.equals(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a30ec0a42636e0c515a6e8123ec0354f2" kindref="member">uuid</ref>))<sp/>{</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.uuid<sp/>=<sp/>newUuid;</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AssignUUID" kindref="compound">AssignUUID</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a30ec0a42636e0c515a6e8123ec0354f2" kindref="member">uuid</ref>));</highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="988"><highlight class="normal"></highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="991"><highlight class="normal"></highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>is<sp/>only<sp/>safe<sp/>to<sp/>set<sp/>the<sp/>format<sp/>version<sp/>directly<sp/>while<sp/>creating<sp/>tables</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>all<sp/>other<sp/>cases,<sp/>use<sp/>upgradeFormatVersion</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="994" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a43740b037ae6cfd7e7cdf4104b3a4799" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a43740b037ae6cfd7e7cdf4104b3a4799" kindref="member">setInitialFormatVersion</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newFormatVersion)<sp/>{</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFormatVersion<sp/>&lt;=<sp/>SUPPORTED_TABLE_FORMAT_VERSION,</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Unsupported<sp/>format<sp/>version:<sp/>v%s<sp/>(supported:<sp/>v%s)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFormatVersion,</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SUPPORTED_TABLE_FORMAT_VERSION);</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.formatVersion<sp/>=<sp/>newFormatVersion;</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"></highlight></codeline>
<codeline lineno="1004" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acf2fa26e3fa1f684e2eb0926c0f2e901" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acf2fa26e3fa1f684e2eb0926c0f2e901" kindref="member">upgradeFormatVersion</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newFormatVersion)<sp/>{</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFormatVersion<sp/>&lt;=<sp/>SUPPORTED_TABLE_FORMAT_VERSION,</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>upgrade<sp/>table<sp/>to<sp/>unsupported<sp/>format<sp/>version:<sp/>v%s<sp/>(supported:<sp/>v%s)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFormatVersion,</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SUPPORTED_TABLE_FORMAT_VERSION);</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFormatVersion<sp/>&gt;=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" kindref="member">formatVersion</ref>,</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>downgrade<sp/>v%s<sp/>table<sp/>to<sp/>v%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" kindref="member">formatVersion</ref>,</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newFormatVersion);</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newFormatVersion<sp/>==<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" kindref="member">formatVersion</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"></highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.formatVersion<sp/>=<sp/>newFormatVersion;</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1UpgradeFormatVersion" kindref="compound">UpgradeFormatVersion</ref>(newFormatVersion));</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"></highlight></codeline>
<codeline lineno="1026" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaf1befe08150633195495fad52f4a845" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaf1befe08150633195495fad52f4a845" kindref="member">setCurrentSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>newSchema,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newLastColumnId)<sp/>{</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaf1befe08150633195495fad52f4a845" kindref="member">setCurrentSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a76365cdc59574c2a18ada461474b711e" kindref="member">addSchemaInternal</ref>(newSchema,<sp/>newLastColumnId));</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"></highlight></codeline>
<codeline lineno="1031" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a987cae4ae59e737852a5231cf87dd8a5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a987cae4ae59e737852a5231cf87dd8a5" kindref="member">setCurrentSchema</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>schemaId)<sp/>{</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(schemaId<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7e30649bc6b036787d3b7b9ee5c3fe8a" kindref="member">lastAddedSchemaId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>last<sp/>added<sp/>schema:<sp/>no<sp/>schema<sp/>has<sp/>been<sp/>added&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaf1befe08150633195495fad52f4a845" kindref="member">setCurrentSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7e30649bc6b036787d3b7b9ee5c3fe8a" kindref="member">lastAddedSchemaId</ref>);</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"></highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref><sp/>==<sp/>schemaId)<sp/>{</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"></highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>.get(schemaId);</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>current<sp/>schema<sp/>to<sp/>unknown<sp/>schema:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>schemaId);</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"></highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rebuild<sp/>all<sp/>the<sp/>partition<sp/>specs<sp/>and<sp/>sort<sp/>orders<sp/>for<sp/>the<sp/>new<sp/>current<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.specs<sp/>=</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Lists.newArrayList(Iterables.transform(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1adc09e5fe5ad6559834a543613180d426" kindref="member">specs</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref><sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ad3b5acb736a4f769009e6c80c1caf60c" kindref="member">updateSpecSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>)));</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaa27359b502cd9d3487f99da721e80db" kindref="member">specsById</ref>.clear();</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaa27359b502cd9d3487f99da721e80db" kindref="member">specsById</ref>.putAll(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a95e23f2284be9cf307e734a67721b201" kindref="member">indexSpecs</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1adc09e5fe5ad6559834a543613180d426" kindref="member">specs</ref>));</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"></highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.sortOrders<sp/>=</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Lists.newArrayList(</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Iterables.transform(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acde8c6d16236123ab526f0a39610478c" kindref="member">sortOrders</ref>,<sp/>order<sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ab113e524aaa93faf9aaa4facf2b58c9b" kindref="member">updateSortOrderSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/>order)));</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a291e51381b0137fe93a7d8229dda75a6" kindref="member">sortOrdersById</ref>.clear();</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a291e51381b0137fe93a7d8229dda75a6" kindref="member">sortOrdersById</ref>.putAll(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1ac0f11e4580453c944f8f5735fb070f82" kindref="member">indexSortOrders</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acde8c6d16236123ab526f0a39610478c" kindref="member">sortOrders</ref>));</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"></highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.currentSchemaId<sp/>=<sp/>schemaId;</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"></highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7e30649bc6b036787d3b7b9ee5c3fe8a" kindref="member">lastAddedSchemaId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7e30649bc6b036787d3b7b9ee5c3fe8a" kindref="member">lastAddedSchemaId</ref><sp/>==<sp/>schemaId)<sp/>{</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetCurrentSchema" kindref="compound">SetCurrentSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab12564490002d875f72d3f684b71f081" kindref="member">LAST_ADDED</ref>));</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetCurrentSchema" kindref="compound">SetCurrentSchema</ref>(schemaId));</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"></highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"></highlight></codeline>
<codeline lineno="1069" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a827f2db9091637c38b46169b88b3626f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a827f2db9091637c38b46169b88b3626f" kindref="member">addSchema</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newLastColumnId)<sp/>{</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>remove<sp/>requirement<sp/>for<sp/>newLastColumnId</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a76365cdc59574c2a18ada461474b711e" kindref="member">addSchemaInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/>newLastColumnId);</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"></highlight></codeline>
<codeline lineno="1075" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7d1665b8a905880ef8da5c95cef2901f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7d1665b8a905880ef8da5c95cef2901f" kindref="member">setDefaultPartitionSpec</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7d1665b8a905880ef8da5c95cef2901f" kindref="member">setDefaultPartitionSpec</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6f92f5590034263416b73fa7da66a99c" kindref="member">addPartitionSpecInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>));</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"></highlight></codeline>
<codeline lineno="1080" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8dc3bee203d1920c317bdea0aecd86ee" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8dc3bee203d1920c317bdea0aecd86ee" kindref="member">setDefaultPartitionSpec</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>specId)<sp/>{</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(specId<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac4430fa1442c24cea3fb2b03c749f363" kindref="member">lastAddedSpecId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>last<sp/>added<sp/>spec:<sp/>no<sp/>spec<sp/>has<sp/>been<sp/>added&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7d1665b8a905880ef8da5c95cef2901f" kindref="member">setDefaultPartitionSpec</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac4430fa1442c24cea3fb2b03c749f363" kindref="member">lastAddedSpecId</ref>);</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"></highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abd596d3b422ab7aade58c106b732cd9a" kindref="member">defaultSpecId</ref><sp/>==<sp/>specId)<sp/>{</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>new<sp/>spec<sp/>is<sp/>already<sp/>current<sp/>and<sp/>no<sp/>change<sp/>is<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"></highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.defaultSpecId<sp/>=<sp/>specId;</highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac4430fa1442c24cea3fb2b03c749f363" kindref="member">lastAddedSpecId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac4430fa1442c24cea3fb2b03c749f363" kindref="member">lastAddedSpecId</ref><sp/>==<sp/>specId)<sp/>{</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetDefaultPartitionSpec" kindref="compound">SetDefaultPartitionSpec</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab12564490002d875f72d3f684b71f081" kindref="member">LAST_ADDED</ref>));</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetDefaultPartitionSpec" kindref="compound">SetDefaultPartitionSpec</ref>(specId));</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"></highlight></codeline>
<codeline lineno="1102" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7cb383ba581f5cda37ba07baa4c5a4e8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7cb383ba581f5cda37ba07baa4c5a4e8" kindref="member">addPartitionSpec</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundPartitionSpec" kindref="compound">UnboundPartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6f92f5590034263416b73fa7da66a99c" kindref="member">addPartitionSpecInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>.bind(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref>)));</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1106"><highlight class="normal"></highlight></codeline>
<codeline lineno="1107" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5762c09af922effae7baca004140844a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5762c09af922effae7baca004140844a" kindref="member">addPartitionSpec</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6f92f5590034263416b73fa7da66a99c" kindref="member">addPartitionSpecInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>);</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"></highlight></codeline>
<codeline lineno="1112" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab431e64d955ca5738205a469457d9ee6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab431e64d955ca5738205a469457d9ee6" kindref="member">setDefaultSortOrder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>order)<sp/>{</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab431e64d955ca5738205a469457d9ee6" kindref="member">setDefaultSortOrder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8c1e29c27959d8ca5575c0ac0fb784ca" kindref="member">addSortOrderInternal</ref>(order));</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"></highlight></codeline>
<codeline lineno="1117" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a4f89274b81001618a206da04e28acb49" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a4f89274b81001618a206da04e28acb49" kindref="member">setDefaultSortOrder</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sortOrderId)<sp/>{</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sortOrderId<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae5fbaf2455c354b5e1ff8a98477feeed" kindref="member">lastAddedOrderId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>last<sp/>added<sp/>sort<sp/>order:<sp/>no<sp/>sort<sp/>order<sp/>has<sp/>been<sp/>added&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab431e64d955ca5738205a469457d9ee6" kindref="member">setDefaultSortOrder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae5fbaf2455c354b5e1ff8a98477feeed" kindref="member">lastAddedOrderId</ref>);</highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"></highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sortOrderId<sp/>==<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a02b6cec7377c51651d6c5ff0f57f5874" kindref="member">defaultSortOrderId</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"></highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.defaultSortOrderId<sp/>=<sp/>sortOrderId;</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae5fbaf2455c354b5e1ff8a98477feeed" kindref="member">lastAddedOrderId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae5fbaf2455c354b5e1ff8a98477feeed" kindref="member">lastAddedOrderId</ref><sp/>==<sp/>sortOrderId)<sp/>{</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetDefaultSortOrder" kindref="compound">SetDefaultSortOrder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab12564490002d875f72d3f684b71f081" kindref="member">LAST_ADDED</ref>));</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetDefaultSortOrder" kindref="compound">SetDefaultSortOrder</ref>(sortOrderId));</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"></highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"></highlight></codeline>
<codeline lineno="1139" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1651e44c52700840ecdacfed48d2d310" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1651e44c52700840ecdacfed48d2d310" kindref="member">addSortOrder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundSortOrder" kindref="compound">UnboundSortOrder</ref><sp/>order)<sp/>{</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8c1e29c27959d8ca5575c0ac0fb784ca" kindref="member">addSortOrderInternal</ref>(order.<ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundSortOrder_1ad1e9b44a91e6307b9b8210d7c6c8302e" kindref="member">bind</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref>)));</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"></highlight></codeline>
<codeline lineno="1144" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8649d68c277c02d39e7c4aa389c53510" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8649d68c277c02d39e7c4aa389c53510" kindref="member">addSortOrder</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>order)<sp/>{</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8c1e29c27959d8ca5575c0ac0fb784ca" kindref="member">addSortOrderInternal</ref>(order);</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"></highlight></codeline>
<codeline lineno="1149" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a73265850a8e7a79ebc86d6d1934411d1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a73265850a8e7a79ebc86d6d1934411d1" kindref="member">addSnapshot</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>change<sp/>is<sp/>a<sp/>noop</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"></highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab090ceced86a8cf465599e67a003c8a1" kindref="member">schemas</ref>.isEmpty(),<sp/></highlight><highlight class="stringliteral">&quot;Attempting<sp/>to<sp/>add<sp/>a<sp/>snapshot<sp/>before<sp/>a<sp/>schema<sp/>is<sp/>added&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1adc09e5fe5ad6559834a543613180d426" kindref="member">specs</ref>.isEmpty(),<sp/></highlight><highlight class="stringliteral">&quot;Attempting<sp/>to<sp/>add<sp/>a<sp/>snapshot<sp/>before<sp/>a<sp/>partition<sp/>spec<sp/>is<sp/>added&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acde8c6d16236123ab526f0a39610478c" kindref="member">sortOrders</ref>.isEmpty(),<sp/></highlight><highlight class="stringliteral">&quot;Attempting<sp/>to<sp/>add<sp/>a<sp/>snapshot<sp/>before<sp/>a<sp/>sort<sp/>order<sp/>is<sp/>added&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"></highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.containsKey(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1aad24e075e95dfc00842c2eea7081154a" kindref="member">snapshotId</ref>()),</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Snapshot<sp/>already<sp/>exists<sp/>for<sp/>id:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1aad24e075e95dfc00842c2eea7081154a" kindref="member">snapshotId</ref>());</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"></highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" kindref="member">formatVersion</ref><sp/>==<sp/>1</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1a35260665de86e86825f0b2686ae184d6" kindref="member">sequenceNumber</ref>()<sp/>&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7bcc7f95326451091cd60581196e2125" kindref="member">lastSequenceNumber</ref></highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1acd3a6b3df8d7040aa0a502e425c2a523" kindref="member">parentId</ref>()<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>snapshot<sp/>with<sp/>sequence<sp/>number<sp/>%s<sp/>older<sp/>than<sp/>last<sp/>sequence<sp/>number<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1a35260665de86e86825f0b2686ae184d6" kindref="member">sequenceNumber</ref>(),</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7bcc7f95326451091cd60581196e2125" kindref="member">lastSequenceNumber</ref>);</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"></highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastUpdatedMillis<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1a28a8af80f4df47f198dc99f4d509397b" kindref="member">timestampMillis</ref>();</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastSequenceNumber<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1a35260665de86e86825f0b2686ae184d6" kindref="member">sequenceNumber</ref>();</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1af8b56637523cdc60a39a72fbca63897f" kindref="member">snapshots</ref>.add(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>);</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.put(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1aad24e075e95dfc00842c2eea7081154a" kindref="member">snapshotId</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>);</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSnapshot" kindref="compound">AddSnapshot</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>));</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"></highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"></highlight></codeline>
<codeline lineno="1184" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a70ffddbbc0ce29c64448a996e4e25ac4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a70ffddbbc0ce29c64448a996e4e25ac4" kindref="member">setSnapshotsSupplier</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1util_1_1SerializableSupplier" kindref="compound">SerializableSupplier</ref>&lt;List&lt;Snapshot&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a2b67dc3d3792c0ff3d865f2c419a4328" kindref="member">snapshotsSupplier</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshotsSupplier<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a2b67dc3d3792c0ff3d865f2c419a4328" kindref="member">snapshotsSupplier</ref>;</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"></highlight></codeline>
<codeline lineno="1189" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6d7c0d23b659009967054f8f39620402" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6d7c0d23b659009967054f8f39620402" kindref="member">setBranchSnapshot</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>,<sp/>String<sp/>branch)<sp/>{</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a73265850a8e7a79ebc86d6d1934411d1" kindref="member">addSnapshot</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>);</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1ac185c4c3002bff32b5ba8268b2e743" kindref="member">setBranchSnapshotInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>,<sp/>branch);</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"></highlight></codeline>
<codeline lineno="1195" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a17c90c043360e14e36d69ba62f4ecfee" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a17c90c043360e14e36d69ba62f4ecfee" kindref="member">setBranchSnapshot</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId,<sp/>String<sp/>branch)<sp/>{</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>.get(branch);</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>()<sp/>==<sp/>snapshotId)<sp/>{</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>change<sp/>is<sp/>a<sp/>noop</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"></highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.get(snapshotId);</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>%s<sp/>to<sp/>unknown<sp/>snapshot:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>branch,<sp/>snapshotId);</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"></highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1ac185c4c3002bff32b5ba8268b2e743" kindref="member">setBranchSnapshotInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>,<sp/>branch);</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"></highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1210"><highlight class="normal"></highlight></codeline>
<codeline lineno="1211" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ad6a0e3b776b30a09b31767771e674d4a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ad6a0e3b776b30a09b31767771e674d4a" kindref="member">setRef</ref>(String<sp/>name,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/>existingRef<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>.get(name);</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(existingRef<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>existingRef.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1adec04c24a92a6165c801bb2928660b17" kindref="member">equals</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"></highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>();</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.get(snapshotId);</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>%s<sp/>to<sp/>unknown<sp/>snapshot:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>name,<sp/>snapshotId);</highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aecfb9f8cf0dca703dca9b028f4add319" kindref="member">isAddedSnapshot</ref>(snapshotId))<sp/>{</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.lastUpdatedMillis<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1a28a8af80f4df47f198dc99f4d509397b" kindref="member">timestampMillis</ref>();</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"></highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1abdf963b32b246b385e9d059f26ca4faf" kindref="member">MAIN_BRANCH</ref>.equals(name))<sp/>{</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.currentSnapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>();</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0d3da303a0898157840cfe317c5b91cb" kindref="member">lastUpdatedMillis</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.lastUpdatedMillis<sp/>=<sp/>System.currentTimeMillis();</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1230"><highlight class="normal"></highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1b2eedec5fca5de43458417703a5638e" kindref="member">snapshotLog</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" kindref="compound">SnapshotLogEntry</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0d3da303a0898157840cfe317c5b91cb" kindref="member">lastUpdatedMillis</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>()));</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"></highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>.put(name,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>);</highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetSnapshotRef" kindref="compound">SetSnapshotRef</ref><sp/>refUpdate<sp/>=</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetSnapshotRef" kindref="compound">SetSnapshotRef</ref>(</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name,</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>(),</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1af8ea4a760d4fda7ea48e954b2752cda6" kindref="member">type</ref>(),</highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1ac38ee9ded18be50476351d4484e3077b" kindref="member">minSnapshotsToKeep</ref>(),</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a31d9d394c8fdd7c3266f1d874f6c94d6" kindref="member">maxSnapshotAgeMs</ref>(),</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a550d7fc55477deecb4fd35cfba94e521" kindref="member">maxRefAgeMs</ref>());</highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(refUpdate);</highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"></highlight></codeline>
<codeline lineno="1247" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a9c150c1335393cddec47e03ae9bacfc0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a9c150c1335393cddec47e03ae9bacfc0" kindref="member">removeRef</ref>(String<sp/>name)<sp/>{</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1abdf963b32b246b385e9d059f26ca4faf" kindref="member">MAIN_BRANCH</ref>.equals(name))<sp/>{</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.currentSnapshotId<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1b2eedec5fca5de43458417703a5638e" kindref="member">snapshotLog</ref>.clear();</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"></highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>.remove(name);</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1RemoveSnapshotRef" kindref="compound">RemoveSnapshotRef</ref>(name));</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"></highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1260"><highlight class="normal"></highlight></codeline>
<codeline lineno="1261" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a65413fe541ebdc83cf7d3f8d8a9c639d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a65413fe541ebdc83cf7d3f8d8a9c639d" kindref="member">resetMainBranch</ref>()<sp/>{</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.currentSnapshotId<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>.remove(<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1abdf963b32b246b385e9d059f26ca4faf" kindref="member">MAIN_BRANCH</ref>);</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1RemoveSnapshotRef" kindref="compound">RemoveSnapshotRef</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1abdf963b32b246b385e9d059f26ca4faf" kindref="member">MAIN_BRANCH</ref>));</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"></highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1270"><highlight class="normal"></highlight></codeline>
<codeline lineno="1271" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a26639ebcb5049d6dfaa201f32d3d3162" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a26639ebcb5049d6dfaa201f32d3d3162" kindref="member">setStatistics</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StatisticsFile" kindref="compound">StatisticsFile</ref><sp/>statisticsFile)<sp/>{</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkNotNull(statisticsFile,<sp/></highlight><highlight class="stringliteral">&quot;statisticsFile<sp/>is<sp/>null&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snapshotId<sp/>==<sp/>statisticsFile.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StatisticsFile_1a329e4fbb9ebf254b81d3ed0784836698" kindref="member">snapshotId</ref>(),</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;snapshotId<sp/>does<sp/>not<sp/>match:<sp/>%s<sp/>vs<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snapshotId,</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>statisticsFile.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StatisticsFile_1a329e4fbb9ebf254b81d3ed0784836698" kindref="member">snapshotId</ref>());</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1add7bb79df660a861f6cfa57f4d847743" kindref="member">statisticsFiles</ref>.put(statisticsFile.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StatisticsFile_1a329e4fbb9ebf254b81d3ed0784836698" kindref="member">snapshotId</ref>(),<sp/>ImmutableList.of(statisticsFile));</highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetStatistics" kindref="compound">SetStatistics</ref>(snapshotId,<sp/>statisticsFile));</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"></highlight></codeline>
<codeline lineno="1283" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a67259da72b439d9475bd66da3697c440" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a67259da72b439d9475bd66da3697c440" kindref="member">removeStatistics</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId)<sp/>{</highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1add7bb79df660a861f6cfa57f4d847743" kindref="member">statisticsFiles</ref>.remove(snapshotId)<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1RemoveStatistics" kindref="compound">RemoveStatistics</ref>(snapshotId));</highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"></highlight></codeline>
<codeline lineno="1301" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab04aca1623c0390ab80bc1fe822cbfe9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab04aca1623c0390ab80bc1fe822cbfe9" kindref="member">suppressHistoricalSnapshots</ref>()<sp/>{</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.suppressHistoricalSnapshots<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;Long&gt;<sp/>refSnapshotIds<sp/>=</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>.values().stream().map(<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">SnapshotRef::snapshotId</ref>).collect(Collectors.toSet());</highlight></codeline>
<codeline lineno="1305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;Long&gt;<sp/>suppressedSnapshotIds<sp/>=<sp/>Sets.difference(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.keySet(),<sp/>refSnapshotIds);</highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7316339b5c7dbfba72835565ab9bbb1a" kindref="member">rewriteSnapshotsInternal</ref>(suppressedSnapshotIds,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1309"><highlight class="normal"></highlight></codeline>
<codeline lineno="1310" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aea6485e8110dc3b3f2c699d2ba6581fc" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aea6485e8110dc3b3f2c699d2ba6581fc" kindref="member">setPartitionStatistics</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFile" kindref="compound">PartitionStatisticsFile</ref><sp/>file)<sp/>{</highlight></codeline>
<codeline lineno="1311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkNotNull(file,<sp/></highlight><highlight class="stringliteral">&quot;partition<sp/>statistics<sp/>file<sp/>is<sp/>null&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1701b5ec82b5c95bea0a6a0b5bf58318" kindref="member">partitionStatisticsFiles</ref>.put(file.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFile_1a88dae7b5250fa4a98720b5ea2da2c8fc" kindref="member">snapshotId</ref>(),<sp/>ImmutableList.of(file));</highlight></codeline>
<codeline lineno="1313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetPartitionStatistics" kindref="compound">SetPartitionStatistics</ref>(file));</highlight></codeline>
<codeline lineno="1314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1315"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1316"><highlight class="normal"></highlight></codeline>
<codeline lineno="1317" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa5d4a39928475634ee151bc5b881c21c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa5d4a39928475634ee151bc5b881c21c" kindref="member">removePartitionStatistics</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId)<sp/>{</highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1701b5ec82b5c95bea0a6a0b5bf58318" kindref="member">partitionStatisticsFiles</ref>.remove(snapshotId)<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1321"><highlight class="normal"></highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1RemovePartitionStatistics" kindref="compound">RemovePartitionStatistics</ref>(snapshotId));</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"></highlight></codeline>
<codeline lineno="1326" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6e5f3bb16df90e1c93f62f46b4116961" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6e5f3bb16df90e1c93f62f46b4116961" kindref="member">removeSnapshots</ref>(List&lt;Snapshot&gt;<sp/>snapshotsToRemove)<sp/>{</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;Long&gt;<sp/>idsToRemove<sp/>=</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snapshotsToRemove.stream().map(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1aad24e075e95dfc00842c2eea7081154a" kindref="member">Snapshot::snapshotId</ref>).collect(Collectors.toSet());</highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6e5f3bb16df90e1c93f62f46b4116961" kindref="member">removeSnapshots</ref>(idsToRemove);</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"></highlight></codeline>
<codeline lineno="1332" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac2d840744887edf5966bebd86cfd37ed" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac2d840744887edf5966bebd86cfd37ed" kindref="member">removeSnapshots</ref>(Collection&lt;Long&gt;<sp/>idsToRemove)<sp/>{</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7316339b5c7dbfba72835565ab9bbb1a" kindref="member">rewriteSnapshotsInternal</ref>(idsToRemove,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"></highlight></codeline>
<codeline lineno="1345" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7316339b5c7dbfba72835565ab9bbb1a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7316339b5c7dbfba72835565ab9bbb1a" kindref="member">rewriteSnapshotsInternal</ref>(Collection&lt;Long&gt;<sp/>idsToRemove,<sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>suppress)<sp/>{</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Snapshot&gt;<sp/>retainedSnapshots<sp/>=</highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Lists.newArrayListWithExpectedSize(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1af8b56637523cdc60a39a72fbca63897f" kindref="member">snapshots</ref>.size()<sp/>-<sp/>idsToRemove.size());</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref><sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1af8b56637523cdc60a39a72fbca63897f" kindref="member">snapshots</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1aad24e075e95dfc00842c2eea7081154a" kindref="member">snapshotId</ref>();</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(idsToRemove.contains(snapshotId))<sp/>{</highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.remove(snapshotId);</highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!suppress)<sp/>{</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1RemoveSnapshot" kindref="compound">RemoveSnapshot</ref>(snapshotId));</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a67259da72b439d9475bd66da3697c440" kindref="member">removeStatistics</ref>(snapshotId);</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa5d4a39928475634ee151bc5b881c21c" kindref="member">removePartitionStatistics</ref>(snapshotId);</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>retainedSnapshots.add(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>);</highlight></codeline>
<codeline lineno="1359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"></highlight></codeline>
<codeline lineno="1362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.snapshots<sp/>=<sp/>retainedSnapshots;</highlight></codeline>
<codeline lineno="1363"><highlight class="normal"></highlight></codeline>
<codeline lineno="1364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>any<sp/>refs<sp/>that<sp/>are<sp/>no<sp/>longer<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;String&gt;<sp/>danglingRefs<sp/>=<sp/>Sets.newHashSet();</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(Map.Entry&lt;String,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>&gt;<sp/>refEntry<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>.entrySet())<sp/>{</highlight></codeline>
<codeline lineno="1367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.containsKey(refEntry.getValue().snapshotId()))<sp/>{</highlight></codeline>
<codeline lineno="1368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>danglingRefs.add(refEntry.getKey());</highlight></codeline>
<codeline lineno="1369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1371"><highlight class="normal"></highlight></codeline>
<codeline lineno="1372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>danglingRefs.forEach(this::removeRef);</highlight></codeline>
<codeline lineno="1373"><highlight class="normal"></highlight></codeline>
<codeline lineno="1374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1375"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1376"><highlight class="normal"></highlight></codeline>
<codeline lineno="1377" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a84c1c893420c444ef49336aa9847c395" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a84c1c893420c444ef49336aa9847c395" kindref="member">setProperties</ref>(Map&lt;String,<sp/>String&gt;<sp/>updated)<sp/>{</highlight></codeline>
<codeline lineno="1378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(updated.isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="1379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1381"><highlight class="normal"></highlight></codeline>
<codeline lineno="1382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac3afe3a5109cd4c801659e4a1bdf17ec" kindref="member">properties</ref>.putAll(updated);</highlight></codeline>
<codeline lineno="1383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetProperties" kindref="compound">SetProperties</ref>(updated));</highlight></codeline>
<codeline lineno="1384"><highlight class="normal"></highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"></highlight></codeline>
<codeline lineno="1388" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a3f32bc2dde19429df5a57244a06eb7d4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a3f32bc2dde19429df5a57244a06eb7d4" kindref="member">removeProperties</ref>(Set&lt;String&gt;<sp/>removed)<sp/>{</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(removed.isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="1390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1392"><highlight class="normal"></highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>removed.forEach(properties::remove);</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1RemoveProperties" kindref="compound">RemoveProperties</ref>(removed));</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"></highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1398"><highlight class="normal"></highlight></codeline>
<codeline lineno="1399" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a42c8f656126e83cf2e5b3a6d4b7bc2e6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a42c8f656126e83cf2e5b3a6d4b7bc2e6" kindref="member">setLocation</ref>(String<sp/>newLocation)<sp/>{</highlight></codeline>
<codeline lineno="1400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a046242c81f94ff0232ef1a2fe474b6f0" kindref="member">location</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a046242c81f94ff0232ef1a2fe474b6f0" kindref="member">location</ref>.equals(newLocation))<sp/>{</highlight></codeline>
<codeline lineno="1401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1403"><highlight class="normal"></highlight></codeline>
<codeline lineno="1404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.location<sp/>=<sp/>newLocation;</highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetLocation" kindref="compound">SetLocation</ref>(newLocation));</highlight></codeline>
<codeline lineno="1406"><highlight class="normal"></highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1409"><highlight class="normal"></highlight></codeline>
<codeline lineno="1410" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8e6373e62a7121183d6ef3afe5dec186" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8e6373e62a7121183d6ef3afe5dec186" kindref="member">discardChanges</ref>()<sp/>{</highlight></codeline>
<codeline lineno="1411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.discardChanges<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1413"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1414"><highlight class="normal"></highlight></codeline>
<codeline lineno="1415" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac8d9ff6009195736fe9c498240e61af6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder" kindref="compound">Builder</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac8d9ff6009195736fe9c498240e61af6" kindref="member">setPreviousFileLocation</ref>(String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa3a1c126acd609e1086f6de533b40642" kindref="member">previousFileLocation</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.previousFileLocation<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa3a1c126acd609e1086f6de533b40642" kindref="member">previousFileLocation</ref>;</highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">this</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1418"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1419"><highlight class="normal"></highlight></codeline>
<codeline lineno="1420" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5650f7cabe6adc35d760e085139d71de" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5650f7cabe6adc35d760e085139d71de" kindref="member">hasChanges</ref>()<sp/>{</highlight></codeline>
<codeline lineno="1421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.size()<sp/>!=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1a37e27e374fcedd28b0ba37abc75dfd" kindref="member">startingChangeCount</ref></highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>||<sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8b87f728247928842b221f7dea2e104e" kindref="member">discardChanges</ref><sp/>&amp;&amp;<sp/>!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.isEmpty())</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aecd2ca80e5b1c8c2f04dc28408ccf592" kindref="member">metadataLocation</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a848587e217337791f17fb503ba6b94f6" kindref="member">suppressHistoricalSnapshots</ref></highlight></codeline>
<codeline lineno="1425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>||<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>!=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a2b67dc3d3792c0ff3d865f2c419a4328" kindref="member">snapshotsSupplier</ref>;</highlight></codeline>
<codeline lineno="1426"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1427"><highlight class="normal"></highlight></codeline>
<codeline lineno="1428" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0e93027bc37d672c094b6cf09718e531" kindref="member">build</ref>()<sp/>{</highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5650f7cabe6adc35d760e085139d71de" kindref="member">hasChanges</ref>())<sp/>{</highlight></codeline>
<codeline lineno="1430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>;</highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1432"><highlight class="normal"></highlight></codeline>
<codeline lineno="1433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0d3da303a0898157840cfe317c5b91cb" kindref="member">lastUpdatedMillis</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.lastUpdatedMillis<sp/>=<sp/>System.currentTimeMillis();</highlight></codeline>
<codeline lineno="1435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1436"><highlight class="normal"></highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>when<sp/>associated<sp/>with<sp/>a<sp/>metadata<sp/>file,<sp/>table<sp/>metadata<sp/>must<sp/>have<sp/>no<sp/>changes<sp/>so<sp/>that<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>metadata<sp/>matches<sp/>exactly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>what<sp/>is<sp/>in<sp/>the<sp/>metadata<sp/>file,<sp/>which<sp/>does<sp/>not<sp/>store<sp/>changes.<sp/>metadata<sp/>location<sp/>with<sp/>changes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>inconsistent.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.size()<sp/>==<sp/>0<sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8b87f728247928842b221f7dea2e104e" kindref="member">discardChanges</ref><sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aecd2ca80e5b1c8c2f04dc28408ccf592" kindref="member">metadataLocation</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>metadata<sp/>location<sp/>with<sp/>changes<sp/>to<sp/>table<sp/>metadata:<sp/>%s<sp/>changes&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.size());</highlight></codeline>
<codeline lineno="1445"><highlight class="normal"></highlight></codeline>
<codeline lineno="1446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref>);</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.checkCompatibility(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaa27359b502cd9d3487f99da721e80db" kindref="member">specsById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abd596d3b422ab7aade58c106b732cd9a" kindref="member">defaultSpecId</ref>),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1abf10832d7f1862c166ed18381de1d3be" kindref="member">checkCompatibility</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a291e51381b0137fe93a7d8229dda75a6" kindref="member">sortOrdersById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a02b6cec7377c51651d6c5ff0f57f5874" kindref="member">defaultSortOrderId</ref>),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"></highlight></codeline>
<codeline lineno="1450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;MetadataLogEntry&gt;<sp/>metadataHistory;</highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>metadataHistory<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>metadataHistory<sp/>=</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a4c0901ac08d89099e06bbd9dd0c116a2" kindref="member">addPreviousFile</ref>(</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa3a1c126acd609e1086f6de533b40642" kindref="member">previousFileLocation</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a41e65e8a35545940dbdad39e62bc03ce" kindref="member">base</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aee627f566690cd19e05bf5263da75c38" kindref="member">lastUpdatedMillis</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac3afe3a5109cd4c801659e4a1bdf17ec" kindref="member">properties</ref>);</highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;HistoryEntry&gt;<sp/>newSnapshotLog<sp/>=</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a96b6453ba7320df00ab8b6984cf3487c" kindref="member">updateSnapshotLog</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1b2eedec5fca5de43458417703a5638e" kindref="member">snapshotLog</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>);</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"></highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>(</highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aecd2ca80e5b1c8c2f04dc28408ccf592" kindref="member">metadataLocation</ref>,</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" kindref="member">formatVersion</ref>,</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a30ec0a42636e0c515a6e8123ec0354f2" kindref="member">uuid</ref>,</highlight></codeline>
<codeline lineno="1465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a046242c81f94ff0232ef1a2fe474b6f0" kindref="member">location</ref>,</highlight></codeline>
<codeline lineno="1466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7bcc7f95326451091cd60581196e2125" kindref="member">lastSequenceNumber</ref>,</highlight></codeline>
<codeline lineno="1467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a0d3da303a0898157840cfe317c5b91cb" kindref="member">lastUpdatedMillis</ref>,</highlight></codeline>
<codeline lineno="1468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aec67e86d475e6785d6ce440e58060137" kindref="member">lastColumnId</ref>,</highlight></codeline>
<codeline lineno="1469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref>,</highlight></codeline>
<codeline lineno="1470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab090ceced86a8cf465599e67a003c8a1" kindref="member">schemas</ref>),</highlight></codeline>
<codeline lineno="1471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abd596d3b422ab7aade58c106b732cd9a" kindref="member">defaultSpecId</ref>,</highlight></codeline>
<codeline lineno="1472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1adc09e5fe5ad6559834a543613180d426" kindref="member">specs</ref>),</highlight></codeline>
<codeline lineno="1473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aad8cdec09e14351c474e0294de88e395" kindref="member">lastAssignedPartitionId</ref>,</highlight></codeline>
<codeline lineno="1474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a02b6cec7377c51651d6c5ff0f57f5874" kindref="member">defaultSortOrderId</ref>,</highlight></codeline>
<codeline lineno="1475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acde8c6d16236123ab526f0a39610478c" kindref="member">sortOrders</ref>),</highlight></codeline>
<codeline lineno="1476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableMap.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac3afe3a5109cd4c801659e4a1bdf17ec" kindref="member">properties</ref>),</highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>,</highlight></codeline>
<codeline lineno="1478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1af8b56637523cdc60a39a72fbca63897f" kindref="member">snapshots</ref>),</highlight></codeline>
<codeline lineno="1479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a2b67dc3d3792c0ff3d865f2c419a4328" kindref="member">snapshotsSupplier</ref>,</highlight></codeline>
<codeline lineno="1480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.copyOf(newSnapshotLog),</highlight></codeline>
<codeline lineno="1481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.copyOf(metadataHistory),</highlight></codeline>
<codeline lineno="1482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableMap.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>),</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1add7bb79df660a861f6cfa57f4d847743" kindref="member">statisticsFiles</ref>.values().stream().flatMap(List::stream).collect(Collectors.toList()),</highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1701b5ec82b5c95bea0a6a0b5bf58318" kindref="member">partitionStatisticsFiles</ref>.values().stream()</highlight></codeline>
<codeline lineno="1485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.flatMap(List::stream)</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.collect(Collectors.toList()),</highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8b87f728247928842b221f7dea2e104e" kindref="member">discardChanges</ref><sp/>?<sp/>ImmutableList.of()<sp/>:<sp/>ImmutableList.copyOf(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>));</highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1489"><highlight class="normal"></highlight></codeline>
<codeline lineno="1490" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a76365cdc59574c2a18ada461474b711e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a76365cdc59574c2a18ada461474b711e" kindref="member">addSchemaInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newLastColumnId)<sp/>{</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="1492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newLastColumnId<sp/>&gt;=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aec67e86d475e6785d6ce440e58060137" kindref="member">lastColumnId</ref>,</highlight></codeline>
<codeline lineno="1493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>last<sp/>column<sp/>ID:<sp/>%s<sp/>&lt;<sp/>%s<sp/>(previous<sp/>last<sp/>column<sp/>ID)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newLastColumnId,</highlight></codeline>
<codeline lineno="1495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aec67e86d475e6785d6ce440e58060137" kindref="member">lastColumnId</ref>);</highlight></codeline>
<codeline lineno="1496"><highlight class="normal"></highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newSchemaId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a27a10645ecadf5051a68d72e0ee7cf96" kindref="member">reuseOrCreateNewSchemaId</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>schemaFound<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>.containsKey(newSchemaId);</highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(schemaFound<sp/>&amp;&amp;<sp/>newLastColumnId<sp/>==<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aec67e86d475e6785d6ce440e58060137" kindref="member">lastColumnId</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>new<sp/>spec<sp/>and<sp/>last<sp/>column<sp/>id<sp/>is<sp/>already<sp/>current<sp/>and<sp/>no<sp/>change<sp/>is<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>lastAddedSchemaId<sp/>if<sp/>the<sp/>schema<sp/>was<sp/>added<sp/>in<sp/>this<sp/>set<sp/>of<sp/>changes<sp/>(since<sp/>it<sp/>is<sp/>now</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>last)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>isNewSchema<sp/>=</highlight></codeline>
<codeline lineno="1504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7e30649bc6b036787d3b7b9ee5c3fe8a" kindref="member">lastAddedSchemaId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSchema" kindref="compound">AddSchema</ref>.class)</highlight></codeline>
<codeline lineno="1506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.anyMatch(added<sp/>-&gt;<sp/>added.schema().schemaId()<sp/>==<sp/>newSchemaId);</highlight></codeline>
<codeline lineno="1507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.lastAddedSchemaId<sp/>=<sp/>isNewSchema<sp/>?<sp/>newSchemaId<sp/>:<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newSchemaId;</highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1510"><highlight class="normal"></highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastColumnId<sp/>=<sp/>newLastColumnId;</highlight></codeline>
<codeline lineno="1512"><highlight class="normal"></highlight></codeline>
<codeline lineno="1513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>newSchema;</highlight></codeline>
<codeline lineno="1514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newSchemaId<sp/>!=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a8552d7c8436cc4890a06ee15dd79e4a2" kindref="member">schemaId</ref>())<sp/>{</highlight></codeline>
<codeline lineno="1515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newSchema<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref>(newSchemaId,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a503ecd80a74c35c4b05435bb6afc9415" kindref="member">columns</ref>(),<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a44fe5a49a1703e4644531edee63dfe4a" kindref="member">identifierFieldIds</ref>());</highlight></codeline>
<codeline lineno="1516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newSchema<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>;</highlight></codeline>
<codeline lineno="1518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1519"><highlight class="normal"></highlight></codeline>
<codeline lineno="1520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!schemaFound)<sp/>{</highlight></codeline>
<codeline lineno="1521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab090ceced86a8cf465599e67a003c8a1" kindref="member">schemas</ref>.add(newSchema);</highlight></codeline>
<codeline lineno="1522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>.put(newSchema.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a8552d7c8436cc4890a06ee15dd79e4a2" kindref="member">schemaId</ref>(),<sp/>newSchema);</highlight></codeline>
<codeline lineno="1523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1524"><highlight class="normal"></highlight></codeline>
<codeline lineno="1525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSchema" kindref="compound">AddSchema</ref>(newSchema,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aec67e86d475e6785d6ce440e58060137" kindref="member">lastColumnId</ref>));</highlight></codeline>
<codeline lineno="1526"><highlight class="normal"></highlight></codeline>
<codeline lineno="1527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastAddedSchemaId<sp/>=<sp/>newSchemaId;</highlight></codeline>
<codeline lineno="1528"><highlight class="normal"></highlight></codeline>
<codeline lineno="1529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newSchemaId;</highlight></codeline>
<codeline lineno="1530"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1531"><highlight class="normal"></highlight></codeline>
<codeline lineno="1532" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a27a10645ecadf5051a68d72e0ee7cf96" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a27a10645ecadf5051a68d72e0ee7cf96" kindref="member">reuseOrCreateNewSchemaId</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>newSchema)<sp/>{</highlight></codeline>
<codeline lineno="1533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>schema<sp/>already<sp/>exists,<sp/>use<sp/>its<sp/>id;<sp/>otherwise<sp/>use<sp/>the<sp/>highest<sp/>id<sp/>+<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newSchemaId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref>;</highlight></codeline>
<codeline lineno="1535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref><sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ab090ceced86a8cf465599e67a003c8a1" kindref="member">schemas</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a1e1351a8943fdb731b9bbfefe6570e2d" kindref="member">sameSchema</ref>(newSchema))<sp/>{</highlight></codeline>
<codeline lineno="1537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a8552d7c8436cc4890a06ee15dd79e4a2" kindref="member">schemaId</ref>();</highlight></codeline>
<codeline lineno="1538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a8552d7c8436cc4890a06ee15dd79e4a2" kindref="member">schemaId</ref>()<sp/>&gt;=<sp/>newSchemaId)<sp/>{</highlight></codeline>
<codeline lineno="1539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newSchemaId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a8552d7c8436cc4890a06ee15dd79e4a2" kindref="member">schemaId</ref>()<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="1540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newSchemaId;</highlight></codeline>
<codeline lineno="1543"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1544"><highlight class="normal"></highlight></codeline>
<codeline lineno="1545" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6f92f5590034263416b73fa7da66a99c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6f92f5590034263416b73fa7da66a99c" kindref="member">addPartitionSpecInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newSpecId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a77ef6ec67618e0943b4f374e40be41a3" kindref="member">reuseOrCreateNewSpecId</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>);</highlight></codeline>
<codeline lineno="1547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaa27359b502cd9d3487f99da721e80db" kindref="member">specsById</ref>.containsKey(newSpecId))<sp/>{</highlight></codeline>
<codeline lineno="1548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>lastAddedSpecId<sp/>if<sp/>the<sp/>spec<sp/>was<sp/>added<sp/>in<sp/>this<sp/>set<sp/>of<sp/>changes<sp/>(since<sp/>it<sp/>is<sp/>now<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>last)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>isNewSpec<sp/>=</highlight></codeline>
<codeline lineno="1551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac4430fa1442c24cea3fb2b03c749f363" kindref="member">lastAddedSpecId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddPartitionSpec" kindref="compound">AddPartitionSpec</ref>.class)</highlight></codeline>
<codeline lineno="1553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.anyMatch(added<sp/>-&gt;<sp/>added.spec().specId()<sp/>==<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac4430fa1442c24cea3fb2b03c749f363" kindref="member">lastAddedSpecId</ref>);</highlight></codeline>
<codeline lineno="1554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.lastAddedSpecId<sp/>=<sp/>isNewSpec<sp/>?<sp/>newSpecId<sp/>:<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newSpecId;</highlight></codeline>
<codeline lineno="1556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1557"><highlight class="normal"></highlight></codeline>
<codeline lineno="1558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref>);</highlight></codeline>
<codeline lineno="1559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.checkCompatibility(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" kindref="member">formatVersion</ref><sp/>&gt;<sp/>1<sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.hasSequentialIds(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>),</highlight></codeline>
<codeline lineno="1562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Spec<sp/>does<sp/>not<sp/>use<sp/>sequential<sp/>IDs<sp/>that<sp/>are<sp/>required<sp/>in<sp/>v1:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>);</highlight></codeline>
<codeline lineno="1564"><highlight class="normal"></highlight></codeline>
<codeline lineno="1565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>newSpec<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a188d04143e3429e8f5c0cced43f2d492" kindref="member">freshSpec</ref>(newSpecId,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>);</highlight></codeline>
<codeline lineno="1566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastAssignedPartitionId<sp/>=</highlight></codeline>
<codeline lineno="1567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Math.max(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aad8cdec09e14351c474e0294de88e395" kindref="member">lastAssignedPartitionId</ref>,<sp/>newSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1ad3973380e93c6cbe41f4388350216d6b" kindref="member">lastAssignedFieldId</ref>());</highlight></codeline>
<codeline lineno="1568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1adc09e5fe5ad6559834a543613180d426" kindref="member">specs</ref>.add(newSpec);</highlight></codeline>
<codeline lineno="1569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aaa27359b502cd9d3487f99da721e80db" kindref="member">specsById</ref>.put(newSpecId,<sp/>newSpec);</highlight></codeline>
<codeline lineno="1570"><highlight class="normal"></highlight></codeline>
<codeline lineno="1571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddPartitionSpec" kindref="compound">AddPartitionSpec</ref>(newSpec));</highlight></codeline>
<codeline lineno="1572"><highlight class="normal"></highlight></codeline>
<codeline lineno="1573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastAddedSpecId<sp/>=<sp/>newSpecId;</highlight></codeline>
<codeline lineno="1574"><highlight class="normal"></highlight></codeline>
<codeline lineno="1575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newSpecId;</highlight></codeline>
<codeline lineno="1576"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1577"><highlight class="normal"></highlight></codeline>
<codeline lineno="1578" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a77ef6ec67618e0943b4f374e40be41a3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a77ef6ec67618e0943b4f374e40be41a3" kindref="member">reuseOrCreateNewSpecId</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>newSpec)<sp/>{</highlight></codeline>
<codeline lineno="1579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>spec<sp/>already<sp/>exists,<sp/>use<sp/>the<sp/>same<sp/>ID.<sp/>otherwise,<sp/>use<sp/>1<sp/>more<sp/>than<sp/>the<sp/>highest<sp/>ID.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newSpecId<sp/>=<sp/>INITIAL_SPEC_ID;</highlight></codeline>
<codeline lineno="1581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref><sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1adc09e5fe5ad6559834a543613180d426" kindref="member">specs</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a0f283a5d49b2d2240b7c87f5f57f9b9f" kindref="member">compatibleWith</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a717532406f4cf60207b057607b89c0ec" kindref="member">specId</ref>();</highlight></codeline>
<codeline lineno="1584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newSpecId<sp/>&lt;=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a717532406f4cf60207b057607b89c0ec" kindref="member">specId</ref>())<sp/>{</highlight></codeline>
<codeline lineno="1585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newSpecId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a1e1d99e4c1b84632a6460bf631892a43" kindref="member">spec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a717532406f4cf60207b057607b89c0ec" kindref="member">specId</ref>()<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="1586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1588"><highlight class="normal"></highlight></codeline>
<codeline lineno="1589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newSpecId;</highlight></codeline>
<codeline lineno="1590"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1591"><highlight class="normal"></highlight></codeline>
<codeline lineno="1592" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8c1e29c27959d8ca5575c0ac0fb784ca" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a8c1e29c27959d8ca5575c0ac0fb784ca" kindref="member">addSortOrderInternal</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>order)<sp/>{</highlight></codeline>
<codeline lineno="1593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newOrderId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a168ec6b0832d9305e919cade4ed645b8" kindref="member">reuseOrCreateNewSortOrderId</ref>(order);</highlight></codeline>
<codeline lineno="1594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a291e51381b0137fe93a7d8229dda75a6" kindref="member">sortOrdersById</ref>.containsKey(newOrderId))<sp/>{</highlight></codeline>
<codeline lineno="1595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>lastAddedOrderId<sp/>if<sp/>the<sp/>order<sp/>was<sp/>added<sp/>in<sp/>this<sp/>set<sp/>of<sp/>changes<sp/>(since<sp/>it<sp/>is<sp/>now</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>last)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>isNewOrder<sp/>=</highlight></codeline>
<codeline lineno="1598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae5fbaf2455c354b5e1ff8a98477feeed" kindref="member">lastAddedOrderId</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSortOrder" kindref="compound">AddSortOrder</ref>.class)</highlight></codeline>
<codeline lineno="1600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.anyMatch(added<sp/>-&gt;<sp/>added.sortOrder().orderId()<sp/>==<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae5fbaf2455c354b5e1ff8a98477feeed" kindref="member">lastAddedOrderId</ref>);</highlight></codeline>
<codeline lineno="1601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.lastAddedOrderId<sp/>=<sp/>isNewOrder<sp/>?<sp/>newOrderId<sp/>:<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newOrderId;</highlight></codeline>
<codeline lineno="1603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1604"><highlight class="normal"></highlight></codeline>
<codeline lineno="1605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aed297831cc9d3119b5d96bb526e557e5" kindref="member">schemasById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a491c0bc7e01f9380b6df97f3ac8acd24" kindref="member">currentSchemaId</ref>);</highlight></codeline>
<codeline lineno="1606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1abf10832d7f1862c166ed18381de1d3be" kindref="member">checkCompatibility</ref>(order,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>);</highlight></codeline>
<codeline lineno="1607"><highlight class="normal"></highlight></codeline>
<codeline lineno="1608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>newOrder;</highlight></codeline>
<codeline lineno="1609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(order.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a75ddf6303546ecefbfa937557b0dfe08" kindref="member">isUnsorted</ref>())<sp/>{</highlight></codeline>
<codeline lineno="1610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newOrder<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a0df25c253d4bd778f08db5b7680ad14a" kindref="member">unsorted</ref>();</highlight></codeline>
<codeline lineno="1611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rebuild<sp/>the<sp/>sort<sp/>order<sp/>using<sp/>new<sp/>column<sp/>ids</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newOrder<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a00908be59c54cb04be3fcbe591658dec" kindref="member">freshSortOrder</ref>(newOrderId,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1aa6aa3163273a7b1df14219ff178ed5c2" kindref="member">schema</ref>,<sp/>order);</highlight></codeline>
<codeline lineno="1614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1615"><highlight class="normal"></highlight></codeline>
<codeline lineno="1616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acde8c6d16236123ab526f0a39610478c" kindref="member">sortOrders</ref>.add(newOrder);</highlight></codeline>
<codeline lineno="1617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a291e51381b0137fe93a7d8229dda75a6" kindref="member">sortOrdersById</ref>.put(newOrderId,<sp/>newOrder);</highlight></codeline>
<codeline lineno="1618"><highlight class="normal"></highlight></codeline>
<codeline lineno="1619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSortOrder" kindref="compound">AddSortOrder</ref>(newOrder));</highlight></codeline>
<codeline lineno="1620"><highlight class="normal"></highlight></codeline>
<codeline lineno="1621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.lastAddedOrderId<sp/>=<sp/>newOrderId;</highlight></codeline>
<codeline lineno="1622"><highlight class="normal"></highlight></codeline>
<codeline lineno="1623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newOrderId;</highlight></codeline>
<codeline lineno="1624"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1625"><highlight class="normal"></highlight></codeline>
<codeline lineno="1626" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a168ec6b0832d9305e919cade4ed645b8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a168ec6b0832d9305e919cade4ed645b8" kindref="member">reuseOrCreateNewSortOrderId</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>newOrder)<sp/>{</highlight></codeline>
<codeline lineno="1627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newOrder.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a75ddf6303546ecefbfa937557b0dfe08" kindref="member">isUnsorted</ref>())<sp/>{</highlight></codeline>
<codeline lineno="1628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a0df25c253d4bd778f08db5b7680ad14a" kindref="member">unsorted</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a33c4d179099cd454e31438ce54dd7aef" kindref="member">orderId</ref>();</highlight></codeline>
<codeline lineno="1629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1630"><highlight class="normal"></highlight></codeline>
<codeline lineno="1631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>determine<sp/>the<sp/>next<sp/>order<sp/>id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newOrderId<sp/>=<sp/>INITIAL_SORT_ORDER_ID;</highlight></codeline>
<codeline lineno="1633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>order<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1acde8c6d16236123ab526f0a39610478c" kindref="member">sortOrders</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(order.sameOrder(newOrder))<sp/>{</highlight></codeline>
<codeline lineno="1635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>order.orderId();</highlight></codeline>
<codeline lineno="1636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newOrderId<sp/>&lt;=<sp/>order.orderId())<sp/>{</highlight></codeline>
<codeline lineno="1637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newOrderId<sp/>=<sp/>order.orderId()<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="1638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1640"><highlight class="normal"></highlight></codeline>
<codeline lineno="1641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newOrderId;</highlight></codeline>
<codeline lineno="1642"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1643"><highlight class="normal"></highlight></codeline>
<codeline lineno="1644" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1ac185c4c3002bff32b5ba8268b2e743" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1ac185c4c3002bff32b5ba8268b2e743" kindref="member">setBranchSnapshotInternal</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>,<sp/>String<sp/>branch)<sp/>{</highlight></codeline>
<codeline lineno="1645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>replacementSnapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1aad24e075e95dfc00842c2eea7081154a" kindref="member">snapshotId</ref>();</highlight></codeline>
<codeline lineno="1646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a653c449637afbcff797e1b5eca790763" kindref="member">refs</ref>.get(branch);</highlight></codeline>
<codeline lineno="1647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a028c4d136da16b326124d1ad0240b3cd" kindref="member">isBranch</ref>(),<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>update<sp/>branch:<sp/>%s<sp/>is<sp/>a<sp/>tag&quot;</highlight><highlight class="normal">,<sp/>branch);</highlight></codeline>
<codeline lineno="1649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1a99315e6b8e67fdc548b2c018a8696c9f" kindref="member">snapshotId</ref>()<sp/>==<sp/>replacementSnapshotId)<sp/>{</highlight></codeline>
<codeline lineno="1650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1653"><highlight class="normal"></highlight></codeline>
<codeline lineno="1654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a81b37acffddb3602b9479b40c25f1004" kindref="member">formatVersion</ref><sp/>==<sp/>1<sp/>||<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1a35260665de86e86825f0b2686ae184d6" kindref="member">sequenceNumber</ref>()<sp/>&lt;=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7bcc7f95326451091cd60581196e2125" kindref="member">lastSequenceNumber</ref>,</highlight></codeline>
<codeline lineno="1656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Last<sp/>sequence<sp/>number<sp/>%s<sp/>is<sp/>less<sp/>than<sp/>existing<sp/>snapshot<sp/>sequence<sp/>number<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a7bcc7f95326451091cd60581196e2125" kindref="member">lastSequenceNumber</ref>,</highlight></codeline>
<codeline lineno="1658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a9562ae79fd02e0d0a327e1b01e9ab5f5" kindref="member">snapshot</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1a35260665de86e86825f0b2686ae184d6" kindref="member">sequenceNumber</ref>());</highlight></codeline>
<codeline lineno="1659"><highlight class="normal"></highlight></codeline>
<codeline lineno="1660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/>newRef;</highlight></codeline>
<codeline lineno="1661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newRef<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1afb676d20b9ec8b0dba73450fd291ebc8" kindref="member">builderFrom</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1a0ed29485d27f37f3f1727af08c3e862d" kindref="member">ref</ref>,<sp/>replacementSnapshotId).<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1_1Builder_1a624e8042a4d1404c703591620941af5f" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="1663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newRef<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1ac77b1ac69b07cf773834ee2adab7d8b8" kindref="member">branchBuilder</ref>(replacementSnapshotId).<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1_1Builder_1a624e8042a4d1404c703591620941af5f" kindref="member">build</ref>();</highlight></codeline>
<codeline lineno="1665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1666"><highlight class="normal"></highlight></codeline>
<codeline lineno="1667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ad6a0e3b776b30a09b31767771e674d4a" kindref="member">setRef</ref>(branch,<sp/>newRef);</highlight></codeline>
<codeline lineno="1668"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1669"><highlight class="normal"></highlight></codeline>
<codeline lineno="1670" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a4c0901ac08d89099e06bbd9dd0c116a2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>List&lt;MetadataLogEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a4c0901ac08d89099e06bbd9dd0c116a2" kindref="member">addPreviousFile</ref>(</highlight></codeline>
<codeline lineno="1671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;MetadataLogEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>,</highlight></codeline>
<codeline lineno="1672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa3a1c126acd609e1086f6de533b40642" kindref="member">previousFileLocation</ref>,</highlight></codeline>
<codeline lineno="1673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>timestampMillis,</highlight></codeline>
<codeline lineno="1674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac3afe3a5109cd4c801659e4a1bdf17ec" kindref="member">properties</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa3a1c126acd609e1086f6de533b40642" kindref="member">previousFileLocation</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>;</highlight></codeline>
<codeline lineno="1677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1678"><highlight class="normal"></highlight></codeline>
<codeline lineno="1679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>maxSize<sp/>=</highlight></codeline>
<codeline lineno="1680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Math.max(</highlight></codeline>
<codeline lineno="1681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1,</highlight></codeline>
<codeline lineno="1682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil" kindref="compound">PropertyUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1PropertyUtil_1a67a6b8cb30cce34999ca41378b22077a" kindref="member">propertyAsInt</ref>(</highlight></codeline>
<codeline lineno="1683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ac3afe3a5109cd4c801659e4a1bdf17ec" kindref="member">properties</ref>,</highlight></codeline>
<codeline lineno="1684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1afeb4afc43992ee4d398d08417f39ad31" kindref="member">METADATA_PREVIOUS_VERSIONS_MAX</ref>,</highlight></codeline>
<codeline lineno="1685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties" kindref="compound">TableProperties</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableProperties_1ad315218a056fb8066fdfd009532079b4" kindref="member">METADATA_PREVIOUS_VERSIONS_MAX_DEFAULT</ref>));</highlight></codeline>
<codeline lineno="1686"><highlight class="normal"></highlight></codeline>
<codeline lineno="1687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;MetadataLogEntry&gt;<sp/>newMetadataLog;</highlight></codeline>
<codeline lineno="1688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>.size()<sp/>&gt;=<sp/>maxSize)<sp/>{</highlight></codeline>
<codeline lineno="1689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>removeIndex<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>.size()<sp/>-<sp/>maxSize<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="1690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newMetadataLog<sp/>=</highlight></codeline>
<codeline lineno="1691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>.subList(removeIndex,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>.size()));</highlight></codeline>
<codeline lineno="1692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newMetadataLog<sp/>=<sp/>Lists.newArrayList(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a425e5ca5859b83bc8ff6ba0b057f7031" kindref="member">previousFiles</ref>);</highlight></codeline>
<codeline lineno="1694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>newMetadataLog.add(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref>(timestampMillis,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aa3a1c126acd609e1086f6de533b40642" kindref="member">previousFileLocation</ref>));</highlight></codeline>
<codeline lineno="1696"><highlight class="normal"></highlight></codeline>
<codeline lineno="1697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newMetadataLog;</highlight></codeline>
<codeline lineno="1698"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1699"><highlight class="normal"></highlight></codeline>
<codeline lineno="1714" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5d2d808082f191eba761fd3556cef4ba" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Set&lt;Long&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5d2d808082f191eba761fd3556cef4ba" kindref="member">intermediateSnapshotIdSet</ref>(</highlight></codeline>
<codeline lineno="1715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;MetadataUpdate&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;Long&gt;<sp/>addedSnapshotIds<sp/>=<sp/>Sets.newHashSet();</highlight></codeline>
<codeline lineno="1717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;Long&gt;<sp/>intermediateSnapshotIds<sp/>=<sp/>Sets.newHashSet();</highlight></codeline>
<codeline lineno="1718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref><sp/>update<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(update<sp/>instanceof<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSnapshot" kindref="compound">AddSnapshot</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>adds<sp/>must<sp/>always<sp/>come<sp/>before<sp/>set<sp/>current<sp/>snapshot</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSnapshot" kindref="compound">AddSnapshot</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a73265850a8e7a79ebc86d6d1934411d1" kindref="member">addSnapshot</ref><sp/>=<sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSnapshot" kindref="compound">AddSnapshot</ref>)<sp/>update;</highlight></codeline>
<codeline lineno="1722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>addedSnapshotIds.add(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a73265850a8e7a79ebc86d6d1934411d1" kindref="member">addSnapshot</ref>.snapshot().snapshotId());</highlight></codeline>
<codeline lineno="1723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(update<sp/>instanceof<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetSnapshotRef" kindref="compound">SetSnapshotRef</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetSnapshotRef" kindref="compound">SetSnapshotRef</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ad6a0e3b776b30a09b31767771e674d4a" kindref="member">setRef</ref><sp/>=<sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1SetSnapshotRef" kindref="compound">SetSnapshotRef</ref>)<sp/>update;</highlight></codeline>
<codeline lineno="1725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ad6a0e3b776b30a09b31767771e674d4a" kindref="member">setRef</ref>.snapshotId();</highlight></codeline>
<codeline lineno="1726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(addedSnapshotIds.contains(snapshotId)</highlight></codeline>
<codeline lineno="1727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1abdf963b32b246b385e9d059f26ca4faf" kindref="member">MAIN_BRANCH</ref>.equals(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ad6a0e3b776b30a09b31767771e674d4a" kindref="member">setRef</ref>.name())</highlight></codeline>
<codeline lineno="1728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;&amp;<sp/>snapshotId<sp/>!=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>intermediateSnapshotIds.add(snapshotId);</highlight></codeline>
<codeline lineno="1730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1733"><highlight class="normal"></highlight></codeline>
<codeline lineno="1734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>intermediateSnapshotIds;</highlight></codeline>
<codeline lineno="1735"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1736"><highlight class="normal"></highlight></codeline>
<codeline lineno="1737" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a96b6453ba7320df00ab8b6984cf3487c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>List&lt;HistoryEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a96b6453ba7320df00ab8b6984cf3487c" kindref="member">updateSnapshotLog</ref>(</highlight></codeline>
<codeline lineno="1738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;HistoryEntry&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1b2eedec5fca5de43458417703a5638e" kindref="member">snapshotLog</ref>,</highlight></codeline>
<codeline lineno="1739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;Long,<sp/>Snapshot&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>,</highlight></codeline>
<codeline lineno="1740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>,</highlight></codeline>
<codeline lineno="1741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;MetadataUpdate&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Set&lt;Long&gt;<sp/>intermediateSnapshotIds<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5d2d808082f191eba761fd3556cef4ba" kindref="member">intermediateSnapshotIdSet</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>);</highlight></codeline>
<codeline lineno="1743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>hasIntermediateSnapshots<sp/>=<sp/>!intermediateSnapshotIds.isEmpty();</highlight></codeline>
<codeline lineno="1744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>hasRemovedSnapshots<sp/>=</highlight></codeline>
<codeline lineno="1745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.stream().anyMatch(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1RemoveSnapshot" kindref="compound">RemoveSnapshot</ref>.class::isInstance);</highlight></codeline>
<codeline lineno="1746"><highlight class="normal"></highlight></codeline>
<codeline lineno="1747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!hasIntermediateSnapshots<sp/>&amp;&amp;<sp/>!hasRemovedSnapshots)<sp/>{</highlight></codeline>
<codeline lineno="1748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1b2eedec5fca5de43458417703a5638e" kindref="member">snapshotLog</ref>;</highlight></codeline>
<codeline lineno="1749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1750"><highlight class="normal"></highlight></codeline>
<codeline lineno="1751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>the<sp/>snapshot<sp/>log</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;HistoryEntry&gt;<sp/>newSnapshotLog<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="1753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry" kindref="compound">HistoryEntry</ref><sp/>logEntry<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a1b2eedec5fca5de43458417703a5638e" kindref="member">snapshotLog</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId<sp/>=<sp/>logEntry.snapshotId();</highlight></codeline>
<codeline lineno="1755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.containsKey(snapshotId))<sp/>{</highlight></codeline>
<codeline lineno="1756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!intermediateSnapshotIds.contains(snapshotId))<sp/>{</highlight></codeline>
<codeline lineno="1757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>copy<sp/>the<sp/>log<sp/>entries<sp/>that<sp/>are<sp/>still<sp/>valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newSnapshotLog.add(logEntry);</highlight></codeline>
<codeline lineno="1759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(hasRemovedSnapshots)<sp/>{</highlight></codeline>
<codeline lineno="1761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>any<sp/>invalid<sp/>entry<sp/>causes<sp/>the<sp/>history<sp/>before<sp/>it<sp/>to<sp/>be<sp/>removed.<sp/>otherwise,<sp/>there<sp/>could<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>history<sp/>gaps<sp/>that<sp/>cause<sp/>time-travel<sp/>queries<sp/>to<sp/>produce<sp/>incorrect<sp/>results.<sp/>for<sp/>example,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>history<sp/>is<sp/>[(t1,<sp/>s1),<sp/>(t2,<sp/>s2),<sp/>(t3,<sp/>s3)]<sp/>and<sp/>s2<sp/>is<sp/>removed,<sp/>the<sp/>history<sp/>cannot<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>[(t1,<sp/>s1),<sp/>(t3,<sp/>s3)]<sp/>because<sp/>it<sp/>appears<sp/>that<sp/>s3<sp/>was<sp/>current<sp/>during<sp/>the<sp/>time<sp/>between<sp/>t2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>t3<sp/>when<sp/>in<sp/>fact<sp/>s2<sp/>was<sp/>the<sp/>current<sp/>snapshot.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>newSnapshotLog.clear();</highlight></codeline>
<codeline lineno="1767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1769"><highlight class="normal"></highlight></codeline>
<codeline lineno="1770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a6fd32685526df9119c371b482d350ada" kindref="member">snapshotsById</ref>.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>)<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException" kindref="compound">ValidationException</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1ValidationException_1a67cd18a4bc1ec478ffba008a6c62b79c" kindref="member">check</ref>(</highlight></codeline>
<codeline lineno="1772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Iterables.getLast(newSnapshotLog).snapshotId()<sp/>==<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1abc9a425d819e4741f913a2ffb9b5551a" kindref="member">currentSnapshotId</ref>,</highlight></codeline>
<codeline lineno="1773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>set<sp/>invalid<sp/>snapshot<sp/>log:<sp/>latest<sp/>entry<sp/>is<sp/>not<sp/>the<sp/>current<sp/>snapshot&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1775"><highlight class="normal"></highlight></codeline>
<codeline lineno="1776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>newSnapshotLog;</highlight></codeline>
<codeline lineno="1777"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1778"><highlight class="normal"></highlight></codeline>
<codeline lineno="1779" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a173168a2b1e6991fa74f89376474ffb0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;Long,<sp/>List&lt;StatisticsFile&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a173168a2b1e6991fa74f89376474ffb0" kindref="member">indexStatistics</ref>(List&lt;StatisticsFile&gt;<sp/>files)<sp/>{</highlight></codeline>
<codeline lineno="1780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>files.stream().collect(Collectors.groupingBy(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StatisticsFile_1a329e4fbb9ebf254b81d3ed0784836698" kindref="member">StatisticsFile::snapshotId</ref>));</highlight></codeline>
<codeline lineno="1781"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1782"><highlight class="normal"></highlight></codeline>
<codeline lineno="1783" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5c72ee5dcad9d765bf8241131cb2f08a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;Long,<sp/>List&lt;PartitionStatisticsFile&gt;&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1a5c72ee5dcad9d765bf8241131cb2f08a" kindref="member">indexPartitionStatistics</ref>(</highlight></codeline>
<codeline lineno="1784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;PartitionStatisticsFile&gt;<sp/>files)<sp/>{</highlight></codeline>
<codeline lineno="1785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>files.stream().collect(Collectors.groupingBy(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFile_1a88dae7b5250fa4a98720b5ea2da2c8fc" kindref="member">PartitionStatisticsFile::snapshotId</ref>));</highlight></codeline>
<codeline lineno="1786"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1787"><highlight class="normal"></highlight></codeline>
<codeline lineno="1788" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aecfb9f8cf0dca703dca9b028f4add319" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1aecfb9f8cf0dca703dca9b028f4add319" kindref="member">isAddedSnapshot</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>snapshotId)<sp/>{</highlight></codeline>
<codeline lineno="1789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1MetadataUpdate" kindref="compound">MetadataUpdate</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1MetadataUpdate_1_1AddSnapshot" kindref="compound">AddSnapshot</ref>.class)</highlight></codeline>
<codeline lineno="1790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.anyMatch(add<sp/>-&gt;<sp/>add.snapshot().snapshotId()<sp/>==<sp/>snapshotId);</highlight></codeline>
<codeline lineno="1791"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1792"><highlight class="normal"></highlight></codeline>
<codeline lineno="1793"><highlight class="normal"><sp/><sp/><sp/><sp/>private<sp/>&lt;U<sp/>extends<sp/>MetadataUpdate&gt;<sp/>Stream&lt;U&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>(Class&lt;U&gt;<sp/>updateClass)<sp/>{</highlight></codeline>
<codeline lineno="1794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1Builder_1ae723dc9628ba59c681ef40145a9a2992" kindref="member">changes</ref>.stream().filter(updateClass::isInstance).map(updateClass::cast);</highlight></codeline>
<codeline lineno="1795"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1796"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1797"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="core/src/main/java/org/apache/iceberg/TableMetadata.java"/>
  </compounddef>
</doxygen>
