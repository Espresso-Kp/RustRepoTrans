<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil" kind="class" language="Java" prot="package">
    <compoundname>org::apache::iceberg::flink::sink::shuffle::SketchUtil</compoundname>
      <sectiondef kind="package-static-attrib">
      <memberdef kind="variable" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a94a5a72d9c1dc21349d091bbaffa0cd1" prot="package" static="yes" mutable="no">
        <type>final int</type>
        <definition>final int org.apache.iceberg.flink.sink.shuffle.SketchUtil.COORDINATOR_MIN_RESERVOIR_SIZE</definition>
        <argsstring></argsstring>
        <name>COORDINATOR_MIN_RESERVOIR_SIZE</name>
        <initializer>= 10_000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="30" column="20" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="30" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1ad518ff982f55df111756aba00c9eab6b" prot="package" static="yes" mutable="no">
        <type>final int</type>
        <definition>final int org.apache.iceberg.flink.sink.shuffle.SketchUtil.COORDINATOR_MAX_RESERVOIR_SIZE</definition>
        <argsstring></argsstring>
        <name>COORDINATOR_MAX_RESERVOIR_SIZE</name>
        <initializer>= 1_000_000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="31" column="20" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="31" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a775fb1a1bda50373403ce4d178c456ef" prot="package" static="yes" mutable="no">
        <type>final int</type>
        <definition>final int org.apache.iceberg.flink.sink.shuffle.SketchUtil.COORDINATOR_TARGET_PARTITIONS_MULTIPLIER</definition>
        <argsstring></argsstring>
        <name>COORDINATOR_TARGET_PARTITIONS_MULTIPLIER</name>
        <initializer>= 100</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="32" column="20" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="32" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a1ce19b1cd03f99d71b6618c0fd465cd1" prot="package" static="yes" mutable="no">
        <type>final int</type>
        <definition>final int org.apache.iceberg.flink.sink.shuffle.SketchUtil.OPERATOR_OVER_SAMPLE_RATIO</definition>
        <argsstring></argsstring>
        <name>OPERATOR_OVER_SAMPLE_RATIO</name>
        <initializer>= 10</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="33" column="20" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="33" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1ace8205357bb990d786a45de96a3f5fba" prot="package" static="yes" mutable="no">
        <type>final int</type>
        <definition>final int org.apache.iceberg.flink.sink.shuffle.SketchUtil.OPERATOR_SKETCH_SWITCH_THRESHOLD</definition>
        <argsstring></argsstring>
        <name>OPERATOR_SKETCH_SWITCH_THRESHOLD</name>
        <initializer>= 10_000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="37" column="20" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="37" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a906036565768b3c6c19e9f4ca759beb5" prot="package" static="yes" mutable="no">
        <type>final int</type>
        <definition>final int org.apache.iceberg.flink.sink.shuffle.SketchUtil.COORDINATOR_SKETCH_SWITCH_THRESHOLD</definition>
        <argsstring></argsstring>
        <name>COORDINATOR_SKETCH_SWITCH_THRESHOLD</name>
        <initializer>= 100_000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="38" column="20" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="38" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="private-func">
      <memberdef kind="function" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a48546dee627ab67ea29eba067524eadd" prot="private" static="no" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type></type>
        <definition>org.apache.iceberg.flink.sink.shuffle.SketchUtil.SketchUtil</definition>
        <argsstring>()</argsstring>
        <name>SketchUtil</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="40" column="11" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="40" bodyend="40"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="package-static-func">
      <memberdef kind="function" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1af69d450026e5695e8e0fa9e89271ff4a" prot="package" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>int</type>
        <definition>static int org.apache.iceberg.flink.sink.shuffle.SketchUtil.determineCoordinatorReservoirSize</definition>
        <argsstring>(int numPartitions)</argsstring>
        <name>determineCoordinatorReservoirSize</name>
        <param>
          <type>int</type>
          <declname>numPartitions</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>The larger the reservoir size, the more accurate for range bounds calculation and the more balanced range distribution.</para>
<para>Here are the heuristic rules Target size: numPartitions x 100 to achieve good accuracy and is easier to calculate the range bounds Min is 10K to achieve good accuracy while memory footprint is still relatively small Max is 1M to cap the memory footprint on coordinator</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>numPartitions</parametername>
</parameternamelist>
<parameterdescription>
<para>number of range partitions which equals to downstream operator parallelism </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>reservoir size </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="55" column="14" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="55" bodyend="69"/>
      </memberdef>
      <memberdef kind="function" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a3b3b35bdbc40e8daeb631b81dfb3cfa7" prot="package" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>int</type>
        <definition>static int org.apache.iceberg.flink.sink.shuffle.SketchUtil.determineOperatorReservoirSize</definition>
        <argsstring>(int operatorParallelism, int numPartitions)</argsstring>
        <name>determineOperatorReservoirSize</name>
        <param>
          <type>int</type>
          <declname>operatorParallelism</declname>
        </param>
        <param>
          <type>int</type>
          <declname>numPartitions</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Determine the sampling reservoir size where operator subtasks collect data statistics.</para>
<para>Here are the heuristic rules Target size is &quot;coordinator reservoir size * over sampling ration (10) / operator
    parallelism&quot; Min is 1K to achieve good accuracy while memory footprint is still relatively small Max is 100K to cap the memory footprint on coordinator</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>numPartitions</parametername>
</parameternamelist>
<parameterdescription>
<para>number of range partitions which equals to downstream operator parallelism </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>operatorParallelism</parametername>
</parameternamelist>
<parameterdescription>
<para>data statistics operator parallelism </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>reservoir size </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="84" column="14" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="84" bodyend="88"/>
      </memberdef>
      <memberdef kind="function" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a0326f184c2389241f56a38e5026f48f4" prot="package" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type><ref refid="classorg_1_1apache_1_1iceberg_1_1SortKey" kindref="compound">SortKey</ref>[]</type>
        <definition>static SortKey [] org.apache.iceberg.flink.sink.shuffle.SketchUtil.rangeBounds</definition>
        <argsstring>(int numPartitions, Comparator&lt; StructLike &gt; comparator, ReservoirItemsSketch&lt; SortKey &gt; sketch)</argsstring>
        <name>rangeBounds</name>
        <param>
          <type>int</type>
          <declname>numPartitions</declname>
        </param>
        <param>
          <type>Comparator&lt; <ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref> &gt;</type>
          <declname>comparator</declname>
        </param>
        <param>
          <type>ReservoirItemsSketch&lt; <ref refid="classorg_1_1apache_1_1iceberg_1_1SortKey" kindref="compound">SortKey</ref> &gt;</type>
          <declname>sketch</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>To understand how range bounds are used in range partitioning, here is an example for human ages with 4 partitions: [15, 32, 60]. The 4 ranges would be age &lt;= 15 age &gt; 15 &amp;&amp; age &lt;= 32 age &gt;32 &amp;&amp; age &lt;= 60 age &gt; 60</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>numPartitions</parametername>
</parameternamelist>
<parameterdescription>
<para>number of partitions which maps to downstream operator parallelism </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>sketch</parametername>
</parameternamelist>
<parameterdescription>
<para>aggregated reservoir sampling sketch </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>list of range partition bounds. It should be a sorted list (ascending). Number of items should be<programlisting><codeline><highlight class="normal">numPartitions<sp/>-<sp/>1<sp/></highlight></codeline>
</programlisting> . if numPartitions is 1, return an empty list </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="103" column="18" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="103" bodyend="107"/>
      </memberdef>
      <memberdef kind="function" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a56a1d3ca20994130a250bedff2977547" prot="package" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type><ref refid="classorg_1_1apache_1_1iceberg_1_1SortKey" kindref="compound">SortKey</ref>[]</type>
        <definition>static SortKey [] org.apache.iceberg.flink.sink.shuffle.SketchUtil.determineBounds</definition>
        <argsstring>(int numPartitions, Comparator&lt; StructLike &gt; comparator, SortKey[] sortKeys)</argsstring>
        <name>determineBounds</name>
        <param>
          <type>int</type>
          <declname>numPartitions</declname>
        </param>
        <param>
          <type>Comparator&lt; <ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StructLike" kindref="compound">StructLike</ref> &gt;</type>
          <declname>comparator</declname>
        </param>
        <param>
          <type><ref refid="classorg_1_1apache_1_1iceberg_1_1SortKey" kindref="compound">SortKey</ref>[]</type>
          <declname>sortKeys</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This assumes the sort keys have equal weight, which is usually the case for high-cardinality scenarios (like device_id, user_id, uuid etc.). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="113" column="18" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="113" bodyend="136"/>
      </memberdef>
      <memberdef kind="function" id="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a78ea36d35582dbd4c54ecc84e0c3a918" prot="package" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>void</type>
        <definition>static void org.apache.iceberg.flink.sink.shuffle.SketchUtil.convertMapToSketch</definition>
        <argsstring>(Map&lt; SortKey, Long &gt; taskMapStats, Consumer&lt; SortKey &gt; sketchConsumer)</argsstring>
        <name>convertMapToSketch</name>
        <param>
          <type>Map&lt; <ref refid="classorg_1_1apache_1_1iceberg_1_1SortKey" kindref="compound">SortKey</ref>, Long &gt;</type>
          <declname>taskMapStats</declname>
        </param>
        <param>
          <type>Consumer&lt; <ref refid="classorg_1_1apache_1_1iceberg_1_1SortKey" kindref="compound">SortKey</ref> &gt;</type>
          <declname>sketchConsumer</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This can be a bit expensive since it is quadratic. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="139" column="15" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="139" bodyend="147"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <location file="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" line="29" column="17" bodyfile="flink/v1.19/flink/src/main/java/org/apache/iceberg/flink/sink/shuffle/SketchUtil.java" bodystart="29" bodyend="148"/>
    <listofallmembers>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a78ea36d35582dbd4c54ecc84e0c3a918" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>convertMapToSketch</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1ad518ff982f55df111756aba00c9eab6b" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>COORDINATOR_MAX_RESERVOIR_SIZE</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a94a5a72d9c1dc21349d091bbaffa0cd1" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>COORDINATOR_MIN_RESERVOIR_SIZE</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a906036565768b3c6c19e9f4ca759beb5" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>COORDINATOR_SKETCH_SWITCH_THRESHOLD</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a775fb1a1bda50373403ce4d178c456ef" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>COORDINATOR_TARGET_PARTITIONS_MULTIPLIER</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a56a1d3ca20994130a250bedff2977547" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>determineBounds</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1af69d450026e5695e8e0fa9e89271ff4a" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>determineCoordinatorReservoirSize</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a3b3b35bdbc40e8daeb631b81dfb3cfa7" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>determineOperatorReservoirSize</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a1ce19b1cd03f99d71b6618c0fd465cd1" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>OPERATOR_OVER_SAMPLE_RATIO</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1ace8205357bb990d786a45de96a3f5fba" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>OPERATOR_SKETCH_SWITCH_THRESHOLD</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a0326f184c2389241f56a38e5026f48f4" prot="package" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>rangeBounds</name></member>
      <member refid="classorg_1_1apache_1_1iceberg_1_1flink_1_1sink_1_1shuffle_1_1SketchUtil_1a48546dee627ab67ea29eba067524eadd" prot="private" virt="non-virtual"><scope>org::apache::iceberg::flink::sink::shuffle::SketchUtil</scope><name>SketchUtil</name></member>
    </listofallmembers>
  </compounddef>
</doxygen>
