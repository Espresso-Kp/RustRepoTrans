<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="v3_85_2spark_2src_2main_2java_2org_2apache_2iceberg_2spark_2source_2SparkWrite_8java" kind="file" language="Java">
    <compoundname>SparkWrite.java</compoundname>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite" prot="package">org::apache::iceberg::spark::source::SparkWrite</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite" prot="private">org::apache::iceberg::spark::source::SparkWrite::BaseBatchWrite</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BatchAppend" prot="private">org::apache::iceberg::spark::source::SparkWrite::BatchAppend</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1DynamicOverwrite" prot="private">org::apache::iceberg::spark::source::SparkWrite::DynamicOverwrite</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter" prot="private">org::apache::iceberg::spark::source::SparkWrite::OverwriteByFilter</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation" prot="private">org::apache::iceberg::spark::source::SparkWrite::CopyOnWriteOperation</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles" prot="private">org::apache::iceberg::spark::source::SparkWrite::RewriteFiles</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite" prot="private">org::apache::iceberg::spark::source::SparkWrite::BaseStreamingWrite</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingAppend" prot="private">org::apache::iceberg::spark::source::SparkWrite::StreamingAppend</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingOverwrite" prot="private">org::apache::iceberg::spark::source::SparkWrite::StreamingOverwrite</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit" prot="public">org::apache::iceberg::spark::source::SparkWrite::TaskCommit</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory" prot="private">org::apache::iceberg::spark::source::SparkWrite::WriterFactory</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter" prot="private">org::apache::iceberg::spark::source::SparkWrite::UnpartitionedDataWriter</innerclass>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter" prot="private">org::apache::iceberg::spark::source::SparkWrite::PartitionedDataWriter</innerclass>
    <innernamespace refid="namespaceorg_1_1apache_1_1iceberg_1_1spark_1_1source">org::apache::iceberg::spark::source</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Licensed<sp/>to<sp/>the<sp/>Apache<sp/>Software<sp/>Foundation<sp/>(ASF)<sp/>under<sp/>one</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>or<sp/>more<sp/>contributor<sp/>license<sp/>agreements.<sp/><sp/>See<sp/>the<sp/>NOTICE<sp/>file</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>distributed<sp/>with<sp/>this<sp/>work<sp/>for<sp/>additional<sp/>information</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>regarding<sp/>copyright<sp/>ownership.<sp/><sp/>The<sp/>ASF<sp/>licenses<sp/>this<sp/>file</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>to<sp/>you<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>&quot;License&quot;);<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>with<sp/>the<sp/>License.<sp/><sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/><sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>Unless<sp/>required<sp/>by<sp/>applicable<sp/>law<sp/>or<sp/>agreed<sp/>to<sp/>in<sp/>writing,</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>software<sp/>distributed<sp/>under<sp/>the<sp/>License<sp/>is<sp/>distributed<sp/>on<sp/>an</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>&quot;AS<sp/>IS&quot;<sp/>BASIS,<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>KIND,<sp/>either<sp/>express<sp/>or<sp/>implied.<sp/><sp/>See<sp/>the<sp/>License<sp/>for<sp/>the</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and<sp/>limitations</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>under<sp/>the<sp/>License.</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">package<sp/></highlight><highlight class="normal">org.apache.iceberg.spark.source;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel" kindref="compound">IsolationLevel</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel_1a51cac92520b137af89702d5725c0cc6d" kindref="member">SERIALIZABLE</ref>;</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel" kindref="compound">IsolationLevel</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel_1a09377886c3d2af7d45ccbef04af72d2e" kindref="member">SNAPSHOT</ref>;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.IOException;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Arrays;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.List;</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Map;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.stream.Collectors;</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1AppendFiles" kindref="compound">AppendFiles</ref>;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref>;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1FileFormat" kindref="compound">FileFormat</ref>;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1FileScanTask" kindref="compound">FileScanTask</ref>;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel" kindref="compound">IsolationLevel</ref>;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles" kindref="compound">OverwriteFiles</ref>;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionKey" kindref="compound">PartitionKey</ref>;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ReplacePartitions" kindref="compound">ReplacePartitions</ref>;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref>;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref>;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotSummary" kindref="compound">SnapshotSummary</ref>;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1SnapshotUpdate" kindref="compound">SnapshotUpdate</ref>;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table" kindref="compound">Table</ref>;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1exceptions" kindref="compound">exceptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1CommitStateUnknownException" kindref="compound">CommitStateUnknownException</ref>;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1expressions" kindref="compound">expressions</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref>;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1expressions" kindref="compound">expressions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions" kindref="compound">Expressions</ref>;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1ClusteredDataWriter" kindref="compound">ClusteredDataWriter</ref>;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult" kindref="compound">DataWriteResult</ref>;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1FanoutDataWriter" kindref="compound">FanoutDataWriter</ref>;</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref>;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileWriter" kindref="compound">FileWriter</ref>;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1OutputFileFactory" kindref="compound">OutputFileFactory</ref>;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1PartitioningWriter" kindref="compound">PartitioningWriter</ref>;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1RollingDataWriter" kindref="compound">RollingDataWriter</ref>;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.ImmutableList;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.ImmutableSet;</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Lists;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1spark" kindref="compound">spark</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1CommitMetadata" kindref="compound">CommitMetadata</ref>;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1spark" kindref="compound">spark</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1FileRewriteCoordinator" kindref="compound">FileRewriteCoordinator</ref>;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1spark" kindref="compound">spark</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1SparkWriteConf" kindref="compound">SparkWriteConf</ref>;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1spark" kindref="compound">spark</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1SparkWriteRequirements" kindref="compound">SparkWriteRequirements</ref>;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.TaskContext;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.TaskContext$;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.api.java.JavaSparkContext;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.broadcast.Broadcast;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.executor.OutputMetrics;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.SparkSession;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1catalyst" kindref="compound">catalyst</ref>.InternalRow;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.distributions.Distribution;</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.expressions.SortOrder;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.BatchWrite;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.DataWriter;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.DataWriterFactory;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.LogicalWriteInfo;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.PhysicalWriteInfo;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.RequiresDistributionAndOrdering;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.Write;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.WriterCommitMessage;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.streaming.StreamingDataWriterFactory;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql_1_1connector" kindref="compound">connector</ref>.write.streaming.StreamingWrite;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1spark" kindref="compound">spark</ref>.<ref refid="namespaceorg_1_1apache_1_1spark_1_1sql" kindref="compound">sql</ref>.types.StructType;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.slf4j.Logger;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.slf4j.LoggerFactory;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight><highlight class="keyword">abstract</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">SparkWrite<sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/>Write,<sp/>RequiresDistributionAndOrdering<sp/>{</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Logger<sp/>LOG<sp/>=<sp/>LoggerFactory.getLogger(SparkWrite.class);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>JavaSparkContext<sp/>sparkContext;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>SparkWriteConf<sp/>writeConf;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Table<sp/>table;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>queryId;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>FileFormat<sp/>format;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>applicationId;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>wapEnabled;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>wapId;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>outputSpecId;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>branch;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>targetFileSize;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Schema<sp/>writeSchema;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>StructType<sp/>dsSchema;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/>extraSnapshotMetadata;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>useFanoutWriter;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>SparkWriteRequirements<sp/>writeRequirements;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/>writeProperties;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>cleanupOnAbort<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/>SparkWrite(</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkSession<sp/>spark,</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Table<sp/>table,</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkWriteConf<sp/>writeConf,</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>LogicalWriteInfo<sp/>writeInfo,</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>applicationId,</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Schema<sp/>writeSchema,</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>StructType<sp/>dsSchema,</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkWriteRequirements<sp/>writeRequirements)<sp/>{</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>this.sparkContext<sp/>=<sp/>JavaSparkContext.fromSparkContext(spark.sparkContext());</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>this.table<sp/>=<sp/>table;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>this.writeConf<sp/>=<sp/>writeConf;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>this.queryId<sp/>=<sp/>writeInfo.queryId();</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>this.format<sp/>=<sp/>writeConf.dataFileFormat();</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>this.applicationId<sp/>=<sp/>applicationId;</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/>this.wapEnabled<sp/>=<sp/>writeConf.wapEnabled();</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>this.wapId<sp/>=<sp/>writeConf.wapId();</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>this.branch<sp/>=<sp/>writeConf.branch();</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>this.targetFileSize<sp/>=<sp/>writeConf.targetDataFileSize();</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>this.writeSchema<sp/>=<sp/>writeSchema;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/>this.dsSchema<sp/>=<sp/>dsSchema;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>this.extraSnapshotMetadata<sp/>=<sp/>writeConf.extraSnapshotMetadata();</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>this.useFanoutWriter<sp/>=<sp/>writeConf.useFanoutWriter(writeRequirements);</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>this.writeRequirements<sp/>=<sp/>writeRequirements;</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>this.outputSpecId<sp/>=<sp/>writeConf.outputSpecId();</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>this.writeProperties<sp/>=<sp/>writeConf.writeProperties();</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>Distribution<sp/>requiredDistribution()<sp/>{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>Distribution<sp/>distribution<sp/>=<sp/>writeRequirements.distribution();</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>LOG.info(</highlight><highlight class="stringliteral">&quot;Requesting<sp/>{}<sp/>as<sp/>write<sp/>distribution<sp/>for<sp/>table<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>distribution,<sp/>table.name());</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>distribution;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>distributionStrictlyRequired()<sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>SortOrder[]<sp/>requiredOrdering()<sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>SortOrder[]<sp/>ordering<sp/>=<sp/>writeRequirements.ordering();</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/>LOG.info(</highlight><highlight class="stringliteral">&quot;Requesting<sp/>{}<sp/>as<sp/>write<sp/>ordering<sp/>for<sp/>table<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>ordering,<sp/>table.name());</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ordering;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>advisoryPartitionSizeInBytes()<sp/>{</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>size<sp/>=<sp/>writeRequirements.advisoryPartitionSize();</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/>LOG.info(</highlight><highlight class="stringliteral">&quot;Requesting<sp/>{}<sp/>bytes<sp/>advisory<sp/>partition<sp/>size<sp/>for<sp/>table<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>size,<sp/>table.name());</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>size;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/>BatchWrite<sp/>asBatchAppend()<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>BatchAppend();</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/>BatchWrite<sp/>asDynamicOverwrite()<sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>DynamicOverwrite();</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/>BatchWrite<sp/>asOverwriteByFilter(Expression<sp/>overwriteExpr)<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>OverwriteByFilter(overwriteExpr);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/>BatchWrite<sp/>asCopyOnWriteOperation(SparkCopyOnWriteScan<sp/>scan,<sp/>IsolationLevel<sp/>isolationLevel)<sp/>{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>CopyOnWriteOperation(scan,<sp/>isolationLevel);</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/>BatchWrite<sp/>asRewrite(String<sp/>fileSetID)<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>RewriteFiles(fileSetID);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/>StreamingWrite<sp/>asStreamingAppend()<sp/>{</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>StreamingAppend();</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/>StreamingWrite<sp/>asStreamingOverwrite()<sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>StreamingOverwrite();</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>writer<sp/>factory<sp/>works<sp/>for<sp/>both<sp/>batch<sp/>and<sp/>streaming</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>WriterFactory<sp/>createWriterFactory()<sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>broadcast<sp/>the<sp/>table<sp/>metadata<sp/>as<sp/>the<sp/>writer<sp/>factory<sp/>will<sp/>be<sp/>sent<sp/>to<sp/>executors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>Broadcast&lt;Table&gt;<sp/>tableBroadcast<sp/>=</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sparkContext.broadcast(SerializableTableWithSize.copyOf(table));</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>WriterFactory(</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tableBroadcast,</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>queryId,</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>format,</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outputSpecId,</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>targetFileSize,</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>writeSchema,</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dsSchema,</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>useFanoutWriter,</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>writeProperties);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>commitOperation(SnapshotUpdate&lt;?&gt;<sp/>operation,<sp/>String<sp/>description)<sp/>{</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>LOG.info(</highlight><highlight class="stringliteral">&quot;Committing<sp/>{}<sp/>to<sp/>table<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>description,<sp/>table);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(applicationId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>operation.set(</highlight><highlight class="stringliteral">&quot;spark.app.id&quot;</highlight><highlight class="normal">,<sp/>applicationId);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!extraSnapshotMetadata.isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>extraSnapshotMetadata.forEach(operation::set);</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!CommitMetadata.commitProperties().isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>CommitMetadata.commitProperties().forEach(operation::set);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wapEnabled<sp/>&amp;&amp;<sp/>wapId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>write-audit-publish<sp/>is<sp/>enabled<sp/>for<sp/>this<sp/>table<sp/>and<sp/>job</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>stage<sp/>the<sp/>changes<sp/>without<sp/>changing<sp/>the<sp/>current<sp/>snapshot</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>operation.set(SnapshotSummary.STAGED_WAP_ID_PROP,<sp/>wapId);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>operation.stageOnly();</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(branch<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>operation.toBranch(branch);</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>start<sp/>=<sp/>System.currentTimeMillis();</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>operation.commit();<sp/></highlight><highlight class="comment">//<sp/>abort<sp/>is<sp/>automatically<sp/>called<sp/>if<sp/>this<sp/>fails</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>duration<sp/>=<sp/>System.currentTimeMillis()<sp/>-<sp/>start;</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>LOG.info(</highlight><highlight class="stringliteral">&quot;Committed<sp/>in<sp/>{}<sp/>ms&quot;</highlight><highlight class="normal">,<sp/>duration);</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(CommitStateUnknownException<sp/>commitStateUnknownException)<sp/>{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>cleanupOnAbort<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>commitStateUnknownException;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>abort(WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cleanupOnAbort)<sp/>{</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkCleanupUtil.deleteFiles(</highlight><highlight class="stringliteral">&quot;job<sp/>abort&quot;</highlight><highlight class="normal">,<sp/>table.io(),<sp/>files(messages));</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>LOG.warn(</highlight><highlight class="stringliteral">&quot;Skipping<sp/>cleanup<sp/>of<sp/>written<sp/>files&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>List&lt;DataFile&gt;<sp/>files(WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;DataFile&gt;<sp/>files<sp/>=<sp/>Lists.newArrayList();</highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(WriterCommitMessage<sp/>message<sp/>:<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(message<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TaskCommit<sp/>taskCommit<sp/>=<sp/>(TaskCommit)<sp/>message;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>files.addAll(Arrays.asList(taskCommit.files()));</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>files;</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/>toString()<sp/>{</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>String.format(</highlight><highlight class="stringliteral">&quot;IcebergWrite(table=%s,<sp/>format=%s)&quot;</highlight><highlight class="normal">,<sp/>table,<sp/>format);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">abstract</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">BaseBatchWrite<sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/>BatchWrite<sp/>{</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="270" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite_1ac8308c406e51e007736690d5ca741dba" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>DataWriterFactory<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite_1ac8308c406e51e007736690d5ca741dba" kindref="member">createBatchWriterFactory</ref>(PhysicalWriteInfo<sp/>info)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>createWriterFactory();</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="275" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite_1a5ca573e649f1d9f63ec1e658b7432cb4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite_1a5ca573e649f1d9f63ec1e658b7432cb4" kindref="member">useCommitCoordinator</ref>()<sp/>{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="280" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite_1a552bee1250690b402b453ecf736d5db7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite_1a552bee1250690b402b453ecf736d5db7" kindref="member">abort</ref>(WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkWrite.this.abort(messages);</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="285" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite_1a9685f6808777f35c3248f2f1b40fb336" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseBatchWrite_1a9685f6808777f35c3248f2f1b40fb336" kindref="member">toString</ref>()<sp/>{</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>String.format(</highlight><highlight class="stringliteral">&quot;IcebergBatchWrite(table=%s,<sp/>format=%s)&quot;</highlight><highlight class="normal">,<sp/>table,<sp/>format);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">BatchAppend<sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>BaseBatchWrite<sp/>{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="292" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BatchAppend_1a82ca9e038895e46f28d057f8a6b62f28" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BatchAppend_1a82ca9e038895e46f28d057f8a6b62f28" kindref="member">commit</ref>(WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1AppendFiles" kindref="compound">AppendFiles</ref><sp/>append<sp/>=<sp/>table.newAppend();</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numFiles<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref><sp/>file<sp/>:<sp/>files(messages))<sp/>{</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numFiles<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>append.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1AppendFiles_1a9ba3bc298597d2c593ee12bbfff2bc78" kindref="member">appendFile</ref>(file);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>commitOperation(append,<sp/>String.format(</highlight><highlight class="stringliteral">&quot;append<sp/>with<sp/>%d<sp/>new<sp/>data<sp/>files&quot;</highlight><highlight class="normal">,<sp/>numFiles));</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">DynamicOverwrite<sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>BaseBatchWrite<sp/>{</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="307" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1DynamicOverwrite_1ac2a00376faaba823e954f7c9a3cdfd65" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1DynamicOverwrite_1ac2a00376faaba823e954f7c9a3cdfd65" kindref="member">commit</ref>(WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;DataFile&gt;<sp/>files<sp/>=<sp/>files(messages);</highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(files.isEmpty())<sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LOG.info(</highlight><highlight class="stringliteral">&quot;Dynamic<sp/>overwrite<sp/>is<sp/>empty,<sp/>skipping<sp/>commit&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ReplacePartitions" kindref="compound">ReplacePartitions</ref><sp/>dynamicOverwrite<sp/>=<sp/>table.newReplacePartitions();</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel" kindref="compound">IsolationLevel</ref><sp/>isolationLevel<sp/>=<sp/>writeConf.isolationLevel();</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/>validateFromSnapshotId<sp/>=<sp/>writeConf.validateFromSnapshotId();</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isolationLevel<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>validateFromSnapshotId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dynamicOverwrite.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ReplacePartitions_1ae590d8603b5882eb5b36f16831a60982" kindref="member">validateFromSnapshot</ref>(validateFromSnapshotId);</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isolationLevel<sp/>==<sp/>SERIALIZABLE)<sp/>{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dynamicOverwrite.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ReplacePartitions_1a60156c94b5822e01cef26405aa672234" kindref="member">validateNoConflictingData</ref>();</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dynamicOverwrite.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ReplacePartitions_1a5c7a15c071132d855ea8bf9f9f59ae9d" kindref="member">validateNoConflictingDeletes</ref>();</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isolationLevel<sp/>==<sp/>SNAPSHOT)<sp/>{</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dynamicOverwrite.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ReplacePartitions_1a5c7a15c071132d855ea8bf9f9f59ae9d" kindref="member">validateNoConflictingDeletes</ref>();</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numFiles<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref><sp/>file<sp/>:<sp/>files)<sp/>{</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numFiles<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dynamicOverwrite.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ReplacePartitions_1a377b87e801de5bda9b11edab79639ebe" kindref="member">addFile</ref>(file);</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>commitOperation(</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dynamicOverwrite,</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight><highlight class="stringliteral">&quot;dynamic<sp/>partition<sp/>overwrite<sp/>with<sp/>%d<sp/>new<sp/>data<sp/>files&quot;</highlight><highlight class="normal">,<sp/>numFiles));</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">OverwriteByFilter<sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>BaseBatchWrite<sp/>{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1acc27e71acb464cb99152b98828888e92" kindref="member">overwriteExpr</ref>;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight></codeline>
<codeline lineno="346" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1abb0c8f6422871d4e78557daddd585566" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1abb0c8f6422871d4e78557daddd585566" kindref="member">OverwriteByFilter</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1acc27e71acb464cb99152b98828888e92" kindref="member">overwriteExpr</ref>)<sp/>{</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.overwriteExpr<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1acc27e71acb464cb99152b98828888e92" kindref="member">overwriteExpr</ref>;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="351" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1a575c54fcff6da51fc7987c95970fb9e2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1a575c54fcff6da51fc7987c95970fb9e2" kindref="member">commit</ref>(WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles" kindref="compound">OverwriteFiles</ref><sp/>overwriteFiles<sp/>=<sp/>table.newOverwrite();</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a8f6f95273052cce588c4a56e6492e7cd" kindref="member">overwriteByRowFilter</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1acc27e71acb464cb99152b98828888e92" kindref="member">overwriteExpr</ref>);</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numFiles<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref><sp/>file<sp/>:<sp/>files(messages))<sp/>{</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numFiles<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a5e46314c362978d66b42bc61632d3d61" kindref="member">addFile</ref>(file);</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel" kindref="compound">IsolationLevel</ref><sp/>isolationLevel<sp/>=<sp/>writeConf.isolationLevel();</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/>validateFromSnapshotId<sp/>=<sp/>writeConf.validateFromSnapshotId();</highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isolationLevel<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>validateFromSnapshotId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a9b8c7e871771610b91b78877e94590b3" kindref="member">validateFromSnapshot</ref>(validateFromSnapshotId);</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isolationLevel<sp/>==<sp/>SERIALIZABLE)<sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1ab2e0ee8a7adae699ba617de0414a7dec" kindref="member">validateNoConflictingDeletes</ref>();</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1ab75f23e2650a65d5184255693bf28d5e" kindref="member">validateNoConflictingData</ref>();</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isolationLevel<sp/>==<sp/>SNAPSHOT)<sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1ab2e0ee8a7adae699ba617de0414a7dec" kindref="member">validateNoConflictingDeletes</ref>();</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>commitMsg<sp/>=</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight><highlight class="stringliteral">&quot;overwrite<sp/>by<sp/>filter<sp/>%s<sp/>with<sp/>%d<sp/>new<sp/>data<sp/>files&quot;</highlight><highlight class="normal">,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1OverwriteByFilter_1acc27e71acb464cb99152b98828888e92" kindref="member">overwriteExpr</ref>,<sp/>numFiles);</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>commitOperation(overwriteFiles,<sp/>commitMsg);</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">CopyOnWriteOperation<sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>BaseBatchWrite<sp/>{</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>SparkCopyOnWriteScan<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref>;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel" kindref="compound">IsolationLevel</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1ac4a88d9400de7c5ff4f00c128a674b70" kindref="member">isolationLevel</ref>;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a169a96487e7a193918765e27cd866464" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a169a96487e7a193918765e27cd866464" kindref="member">CopyOnWriteOperation</ref>(SparkCopyOnWriteScan<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref>,<sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1IsolationLevel" kindref="compound">IsolationLevel</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1ac4a88d9400de7c5ff4f00c128a674b70" kindref="member">isolationLevel</ref>)<sp/>{</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.scan<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref>;</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.isolationLevel<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1ac4a88d9400de7c5ff4f00c128a674b70" kindref="member">isolationLevel</ref>;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a86d6ef3621a905e6151933c471a13c0e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>List&lt;DataFile&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a86d6ef3621a905e6151933c471a13c0e" kindref="member">overwrittenFiles</ref>()<sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref><sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ImmutableList.of();</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref>.tasks().stream().map(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ContentScanTask_1aa15f447b4d93d067dad725838d22411c" kindref="member">FileScanTask::file</ref>).collect(Collectors.toList());</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"></highlight></codeline>
<codeline lineno="399" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" kindref="member">conflictDetectionFilter</ref>()<sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>list<sp/>of<sp/>filter<sp/>expressions<sp/>may<sp/>be<sp/>empty<sp/>but<sp/>is<sp/>never<sp/>null</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;Expression&gt;<sp/>scanFilterExpressions<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref>.filterExpressions();</highlight></codeline>
<codeline lineno="402"><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref><sp/>filter<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions" kindref="compound">Expressions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions_1a53d1494a86985c74259aa1f8982e55c2" kindref="member">alwaysTrue</ref>();</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref><sp/>expr<sp/>:<sp/>scanFilterExpressions)<sp/>{</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filter<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions" kindref="compound">Expressions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions_1ab5f3130e4b4bc72d48c2c120cabf2193" kindref="member">and</ref>(filter,<sp/>expr);</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>filter;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="413" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a734588c0df22674a1d83121e7ccd2f42" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a734588c0df22674a1d83121e7ccd2f42" kindref="member">commit</ref>(WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles" kindref="compound">OverwriteFiles</ref><sp/>overwriteFiles<sp/>=<sp/>table.newOverwrite();</highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>List&lt;DataFile&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a86d6ef3621a905e6151933c471a13c0e" kindref="member">overwrittenFiles</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a86d6ef3621a905e6151933c471a13c0e" kindref="member">overwrittenFiles</ref>();</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numOverwrittenFiles<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a86d6ef3621a905e6151933c471a13c0e" kindref="member">overwrittenFiles</ref>.size();</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref><sp/>overwrittenFile<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a86d6ef3621a905e6151933c471a13c0e" kindref="member">overwrittenFiles</ref>)<sp/>{</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a187142fde7313fdcc6449bf470b39022" kindref="member">deleteFile</ref>(overwrittenFile);</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numAddedFiles<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref><sp/>file<sp/>:<sp/>files(messages))<sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numAddedFiles<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a5e46314c362978d66b42bc61632d3d61" kindref="member">addFile</ref>(file);</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>scan<sp/>may<sp/>be<sp/>null<sp/>if<sp/>the<sp/>optimizer<sp/>replaces<sp/>it<sp/>with<sp/>an<sp/>empty<sp/>relation<sp/>(e.g.<sp/>false<sp/>cond)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>no<sp/>validation<sp/>is<sp/>needed<sp/>in<sp/>this<sp/>case<sp/>as<sp/>the<sp/>command<sp/>does<sp/>not<sp/>depend<sp/>on<sp/>the<sp/>table<sp/>state</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref><sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1ac4a88d9400de7c5ff4f00c128a674b70" kindref="member">isolationLevel</ref><sp/>==<sp/>SERIALIZABLE)<sp/>{</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1af5139e644a1b73892db24f831503fe36" kindref="member">commitWithSerializableIsolation</ref>(overwriteFiles,<sp/>numOverwrittenFiles,<sp/>numAddedFiles);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1ac4a88d9400de7c5ff4f00c128a674b70" kindref="member">isolationLevel</ref><sp/>==<sp/>SNAPSHOT)<sp/>{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a3d7644f89764a7189b7bca5b2072c757" kindref="member">commitWithSnapshotIsolation</ref>(overwriteFiles,<sp/>numOverwrittenFiles,<sp/>numAddedFiles);</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>IllegalArgumentException(</highlight><highlight class="stringliteral">&quot;Unsupported<sp/>isolation<sp/>level:<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1ac4a88d9400de7c5ff4f00c128a674b70" kindref="member">isolationLevel</ref>);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>commitOperation(</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles,</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight><highlight class="stringliteral">&quot;overwrite<sp/>with<sp/>%d<sp/>new<sp/>data<sp/>files<sp/>(no<sp/>validation)&quot;</highlight><highlight class="normal">,<sp/>numAddedFiles));</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1af5139e644a1b73892db24f831503fe36" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1af5139e644a1b73892db24f831503fe36" kindref="member">commitWithSerializableIsolation</ref>(</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles" kindref="compound">OverwriteFiles</ref><sp/>overwriteFiles,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numOverwrittenFiles,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numAddedFiles)<sp/>{</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/>scanSnapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref>.snapshotId();</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(scanSnapshotId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a9b8c7e871771610b91b78877e94590b3" kindref="member">validateFromSnapshot</ref>(scanSnapshotId);</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" kindref="member">conflictDetectionFilter</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" kindref="member">conflictDetectionFilter</ref>();</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a3122a7534477ce184d860447540fe964" kindref="member">conflictDetectionFilter</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" kindref="member">conflictDetectionFilter</ref>);</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1ab75f23e2650a65d5184255693bf28d5e" kindref="member">validateNoConflictingData</ref>();</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1ab2e0ee8a7adae699ba617de0414a7dec" kindref="member">validateNoConflictingDeletes</ref>();</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>commitMsg<sp/>=</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;overwrite<sp/>of<sp/>%d<sp/>data<sp/>files<sp/>with<sp/>%d<sp/>new<sp/>data<sp/>files,<sp/>scanSnapshotId:<sp/>%d,<sp/>conflictDetectionFilter:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numOverwrittenFiles,<sp/>numAddedFiles,<sp/>scanSnapshotId,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" kindref="member">conflictDetectionFilter</ref>);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>commitOperation(overwriteFiles,<sp/>commitMsg);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a3d7644f89764a7189b7bca5b2072c757" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a3d7644f89764a7189b7bca5b2072c757" kindref="member">commitWithSnapshotIsolation</ref>(</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles" kindref="compound">OverwriteFiles</ref><sp/>overwriteFiles,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numOverwrittenFiles,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numAddedFiles)<sp/>{</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/>scanSnapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a22256bbadd20ef3c9f36f77e9219bf4f" kindref="member">scan</ref>.snapshotId();</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(scanSnapshotId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a9b8c7e871771610b91b78877e94590b3" kindref="member">validateFromSnapshot</ref>(scanSnapshotId);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1expressions_1_1Expression" kindref="compound">Expression</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" kindref="member">conflictDetectionFilter</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" kindref="member">conflictDetectionFilter</ref>();</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a3122a7534477ce184d860447540fe964" kindref="member">conflictDetectionFilter</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1CopyOnWriteOperation_1a41c25b52b521d95b2e952e0969391ab5" kindref="member">conflictDetectionFilter</ref>);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1ab2e0ee8a7adae699ba617de0414a7dec" kindref="member">validateNoConflictingDeletes</ref>();</highlight></codeline>
<codeline lineno="475"><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>commitMsg<sp/>=</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;overwrite<sp/>of<sp/>%d<sp/>data<sp/>files<sp/>with<sp/>%d<sp/>new<sp/>data<sp/>files&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numOverwrittenFiles,<sp/>numAddedFiles);</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>commitOperation(overwriteFiles,<sp/>commitMsg);</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1RewriteFiles" kindref="compound">RewriteFiles</ref><sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>BaseBatchWrite<sp/>{</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles_1ab28ad4ac81f44d44c086499e8e25eaf9" kindref="member">fileSetID</ref>;</highlight></codeline>
<codeline lineno="486"><highlight class="normal"></highlight></codeline>
<codeline lineno="487" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles_1ada75f8a44e74ebfd8f7527ff74aa0a77" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles_1ada75f8a44e74ebfd8f7527ff74aa0a77" kindref="member">RewriteFiles</ref>(String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles_1ab28ad4ac81f44d44c086499e8e25eaf9" kindref="member">fileSetID</ref>)<sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.fileSetID<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles_1ab28ad4ac81f44d44c086499e8e25eaf9" kindref="member">fileSetID</ref>;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="492" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles_1a1eafc95d7bc81f2ea4031e9f389306ba" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles_1a1eafc95d7bc81f2ea4031e9f389306ba" kindref="member">commit</ref>(WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1FileRewriteCoordinator" kindref="compound">FileRewriteCoordinator</ref><sp/>coordinator<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1FileRewriteCoordinator" kindref="compound">FileRewriteCoordinator</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1FileRewriteCoordinator_1a2dd29b90cca1fd7e27b28d9154c44505" kindref="member">get</ref>();</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>coordinator.stageRewrite(table,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1RewriteFiles_1ab28ad4ac81f44d44c086499e8e25eaf9" kindref="member">fileSetID</ref>,<sp/>ImmutableSet.copyOf(files(messages)));</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">abstract</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">BaseStreamingWrite<sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/>StreamingWrite<sp/>{</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1aff4af550973b9662812384af9dbcc189" kindref="member">QUERY_ID_PROPERTY</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;spark.sql.streaming.queryId&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1ab4d31984190675d161032258f859e335" kindref="member">EPOCH_ID_PROPERTY</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;spark.sql.streaming.epochId&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">protected</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">abstract</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1ad3564e4ccfcd01c5587cab440841f489" kindref="member">mode</ref>();</highlight></codeline>
<codeline lineno="503"><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="505" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a23ec2f10776d25601b217a639bb813cd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>StreamingDataWriterFactory<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a23ec2f10776d25601b217a639bb813cd" kindref="member">createStreamingWriterFactory</ref>(PhysicalWriteInfo<sp/>info)<sp/>{</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>createWriterFactory();</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="510" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a2417617966ff7c9bc48d5f39d12eaff8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a2417617966ff7c9bc48d5f39d12eaff8" kindref="member">useCommitCoordinator</ref>()<sp/>{</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="515" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a23c4a9aa4c039b5d55b6d9cfb26c52ee" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a23c4a9aa4c039b5d55b6d9cfb26c52ee" kindref="member">commit</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>epochId,<sp/>WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>LOG.info(</highlight><highlight class="stringliteral">&quot;Committing<sp/>epoch<sp/>{}<sp/>for<sp/>query<sp/>{}<sp/>in<sp/>{}<sp/>mode&quot;</highlight><highlight class="normal">,<sp/>epochId,<sp/>queryId,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1ad3564e4ccfcd01c5587cab440841f489" kindref="member">mode</ref>());</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>table.refresh();</highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/>lastCommittedEpochId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1adc5eaa608e435a443060dddd06b21685" kindref="member">findLastCommittedEpochId</ref>();</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(lastCommittedEpochId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>epochId<sp/>&lt;=<sp/>lastCommittedEpochId)<sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LOG.info(</highlight><highlight class="stringliteral">&quot;Skipping<sp/>epoch<sp/>{}<sp/>for<sp/>query<sp/>{}<sp/>as<sp/>it<sp/>was<sp/>already<sp/>committed&quot;</highlight><highlight class="normal">,<sp/>epochId,<sp/>queryId);</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a58df6f2294cf1c3ff7c7759d9d6f9c2d" kindref="member">doCommit</ref>(epochId,<sp/>messages);</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="528"><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">protected</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">abstract</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a58df6f2294cf1c3ff7c7759d9d6f9c2d" kindref="member">doCommit</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>epochId,<sp/>WriterCommitMessage[]<sp/>messages);</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/>protected<sp/>&lt;T&gt;<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a23c4a9aa4c039b5d55b6d9cfb26c52ee" kindref="member">commit</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1SnapshotUpdate" kindref="compound">SnapshotUpdate&lt;T&gt;</ref><sp/>snapshotUpdate,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>epochId,<sp/>String<sp/>description)<sp/>{</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>snapshotUpdate.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1SnapshotUpdate_1a72b3978b4804d7f75c70f9e0c95ef55c" kindref="member">set</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1aff4af550973b9662812384af9dbcc189" kindref="member">QUERY_ID_PROPERTY</ref>,<sp/>queryId);</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>snapshotUpdate.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1SnapshotUpdate_1a72b3978b4804d7f75c70f9e0c95ef55c" kindref="member">set</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1ab4d31984190675d161032258f859e335" kindref="member">EPOCH_ID_PROPERTY</ref>,<sp/>Long.toString(epochId));</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>commitOperation(snapshotUpdate,<sp/>description);</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="536"><highlight class="normal"></highlight></codeline>
<codeline lineno="537" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1adc5eaa608e435a443060dddd06b21685" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/>Long<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1adc5eaa608e435a443060dddd06b21685" kindref="member">findLastCommittedEpochId</ref>()<sp/>{</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/>snapshot<sp/>=<sp/>table.currentSnapshot();</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/>lastCommittedEpochId<sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(snapshot<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/>summary<sp/>=<sp/>snapshot.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1a507d93b2f0c78a80ec17187c9e596cb7" kindref="member">summary</ref>();</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>snapshotQueryId<sp/>=<sp/>summary.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1aff4af550973b9662812384af9dbcc189" kindref="member">QUERY_ID_PROPERTY</ref>);</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(queryId.equals(snapshotQueryId))<sp/>{</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lastCommittedEpochId<sp/>=<sp/>Long.valueOf(summary.get(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1ab4d31984190675d161032258f859e335" kindref="member">EPOCH_ID_PROPERTY</ref>));</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Long<sp/>parentSnapshotId<sp/>=<sp/>snapshot.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot_1acd3a6b3df8d7040aa0a502e425c2a523" kindref="member">parentId</ref>();</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snapshot<sp/>=<sp/>parentSnapshotId<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>?<sp/>table.snapshot(parentSnapshotId)<sp/>:<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>lastCommittedEpochId;</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="552"><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="554" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a8f96304618d03ecf394c0754f2982e76" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a8f96304618d03ecf394c0754f2982e76" kindref="member">abort</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>epochId,<sp/>WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkWrite.this.abort(messages);</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="559" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a5a611fd425e90480d6e0345580a03a9e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a5a611fd425e90480d6e0345580a03a9e" kindref="member">toString</ref>()<sp/>{</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>String.format(</highlight><highlight class="stringliteral">&quot;IcebergStreamingWrite(table=%s,<sp/>format=%s)&quot;</highlight><highlight class="normal">,<sp/>table,<sp/>format);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">StreamingAppend<sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>BaseStreamingWrite<sp/>{</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="566" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingAppend_1a0e0c8917df976703a8a67fdc7e17c835" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">protected</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingAppend_1a0e0c8917df976703a8a67fdc7e17c835" kindref="member">mode</ref>()<sp/>{</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;append&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="571" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingAppend_1a35cb7a0843bcd5cb2be57619f4f5a9c6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">protected</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingAppend_1a35cb7a0843bcd5cb2be57619f4f5a9c6" kindref="member">doCommit</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>epochId,<sp/>WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1AppendFiles" kindref="compound">AppendFiles</ref><sp/>append<sp/>=<sp/>table.newFastAppend();</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numFiles<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref><sp/>file<sp/>:<sp/>files(messages))<sp/>{</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>append.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1AppendFiles_1a9ba3bc298597d2c593ee12bbfff2bc78" kindref="member">appendFile</ref>(file);</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numFiles++;</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a23c4a9aa4c039b5d55b6d9cfb26c52ee" kindref="member">commit</ref>(append,<sp/>epochId,<sp/>String.format(</highlight><highlight class="stringliteral">&quot;streaming<sp/>append<sp/>with<sp/>%d<sp/>new<sp/>data<sp/>files&quot;</highlight><highlight class="normal">,<sp/>numFiles));</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="581"><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">StreamingOverwrite<sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>BaseStreamingWrite<sp/>{</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="584" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingOverwrite_1a7b0bec20c8370fc232ecd868e727a9f5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">protected</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingOverwrite_1a7b0bec20c8370fc232ecd868e727a9f5" kindref="member">mode</ref>()<sp/>{</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;complete&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="589" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingOverwrite_1a0da050e2788229cd4974004f308a5cd0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1StreamingOverwrite_1a0da050e2788229cd4974004f308a5cd0" kindref="member">doCommit</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>epochId,<sp/>WriterCommitMessage[]<sp/>messages)<sp/>{</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles" kindref="compound">OverwriteFiles</ref><sp/>overwriteFiles<sp/>=<sp/>table.newOverwrite();</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a8f6f95273052cce588c4a56e6492e7cd" kindref="member">overwriteByRowFilter</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions" kindref="compound">Expressions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1expressions_1_1Expressions_1a53d1494a86985c74259aa1f8982e55c2" kindref="member">alwaysTrue</ref>());</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numFiles<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref><sp/>file<sp/>:<sp/>files(messages))<sp/>{</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1OverwriteFiles_1a5e46314c362978d66b42bc61632d3d61" kindref="member">addFile</ref>(file);</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numFiles++;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1BaseStreamingWrite_1a23c4a9aa4c039b5d55b6d9cfb26c52ee" kindref="member">commit</ref>(</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overwriteFiles,</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>epochId,</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String.format(</highlight><highlight class="stringliteral">&quot;streaming<sp/>complete<sp/>overwrite<sp/>with<sp/>%d<sp/>new<sp/>data<sp/>files&quot;</highlight><highlight class="normal">,<sp/>numFiles));</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">TaskCommit<sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/>WriterCommitMessage<sp/>{</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref>[]<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit_1aba95bdfcc5b50c655b26aa2f50184ff8" kindref="member">taskFiles</ref>;</highlight></codeline>
<codeline lineno="606"><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/>TaskCommit(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref>[]<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit_1aba95bdfcc5b50c655b26aa2f50184ff8" kindref="member">taskFiles</ref>)<sp/>{</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.taskFiles<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit_1aba95bdfcc5b50c655b26aa2f50184ff8" kindref="member">taskFiles</ref>;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Reports<sp/>bytesWritten<sp/>and<sp/>recordsWritten<sp/>to<sp/>the<sp/>Spark<sp/>output<sp/>metrics.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Can<sp/>only<sp/>be<sp/>called<sp/>in<sp/>executor.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>reportOutputMetrics()<sp/>{</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>bytesWritten<sp/>=<sp/>0L;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>recordsWritten<sp/>=<sp/>0L;</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref><sp/>dataFile<sp/>:<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit_1aba95bdfcc5b50c655b26aa2f50184ff8" kindref="member">taskFiles</ref>)<sp/>{</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bytesWritten<sp/>+=<sp/>dataFile.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1ContentFile_1a81bb72e22fef076e30bad1a47cc8bf8f" kindref="member">fileSizeInBytes</ref>();</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>recordsWritten<sp/>+=<sp/>dataFile.recordCount();</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="620"><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>TaskContext<sp/>taskContext<sp/>=<sp/>TaskContext$.MODULE$.get();</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(taskContext<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>OutputMetrics<sp/>outputMetrics<sp/>=<sp/>taskContext.taskMetrics().outputMetrics();</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outputMetrics.setBytesWritten(bytesWritten);</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outputMetrics.setRecordsWritten(recordsWritten);</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/>DataFile[]<sp/>files()<sp/>{</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit_1aba95bdfcc5b50c655b26aa2f50184ff8" kindref="member">taskFiles</ref>;</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">WriterFactory<sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/>DataWriterFactory,<sp/>StreamingDataWriterFactory<sp/>{</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Broadcast&lt;Table&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a22dd099f949134389870ed31f848f9d1" kindref="member">tableBroadcast</ref>;</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>FileFormat<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a403b44c99d07a1d8ee8698ff4ca7d53d" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a958f38391fd0391d00e0547aed9400f6" kindref="member">outputSpecId</ref>;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a7b29613aa081f370af13a0ead50db263" kindref="member">targetFileSize</ref>;</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Schema<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1ac4bf72dd12bbc2f4492d42596c84da64" kindref="member">writeSchema</ref>;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>StructType<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a0aa40b346e14578141ed1fe245e9403a" kindref="member">dsSchema</ref>;</highlight></codeline>
<codeline lineno="641" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a053b35531f311ef0b785c4dfb52c4d83" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a053b35531f311ef0b785c4dfb52c4d83" kindref="member">useFanoutWriter</ref>;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a5c80a05ee365bb7365bb09d7c41b8900" kindref="member">queryId</ref>;</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1adb97d675fd9a9d98d186f082279d7053" kindref="member">writeProperties</ref>;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"></highlight></codeline>
<codeline lineno="645" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a345cef3626fda6f3758aa59e3de44b96" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">protected</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a345cef3626fda6f3758aa59e3de44b96" kindref="member">WriterFactory</ref>(</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Broadcast&lt;Table&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a22dd099f949134389870ed31f848f9d1" kindref="member">tableBroadcast</ref>,</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a5c80a05ee365bb7365bb09d7c41b8900" kindref="member">queryId</ref>,</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1FileFormat" kindref="compound">FileFormat</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a403b44c99d07a1d8ee8698ff4ca7d53d" kindref="member">format</ref>,</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a958f38391fd0391d00e0547aed9400f6" kindref="member">outputSpecId</ref>,</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a7b29613aa081f370af13a0ead50db263" kindref="member">targetFileSize</ref>,</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1ac4bf72dd12bbc2f4492d42596c84da64" kindref="member">writeSchema</ref>,</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1StructType" kindref="compound">StructType</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a0aa40b346e14578141ed1fe245e9403a" kindref="member">dsSchema</ref>,</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a053b35531f311ef0b785c4dfb52c4d83" kindref="member">useFanoutWriter</ref>,</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1adb97d675fd9a9d98d186f082279d7053" kindref="member">writeProperties</ref>)<sp/>{</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.tableBroadcast<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a22dd099f949134389870ed31f848f9d1" kindref="member">tableBroadcast</ref>;</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.format<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a403b44c99d07a1d8ee8698ff4ca7d53d" kindref="member">format</ref>;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.outputSpecId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a958f38391fd0391d00e0547aed9400f6" kindref="member">outputSpecId</ref>;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.targetFileSize<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a7b29613aa081f370af13a0ead50db263" kindref="member">targetFileSize</ref>;</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.writeSchema<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1ac4bf72dd12bbc2f4492d42596c84da64" kindref="member">writeSchema</ref>;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.dsSchema<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a0aa40b346e14578141ed1fe245e9403a" kindref="member">dsSchema</ref>;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.useFanoutWriter<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a053b35531f311ef0b785c4dfb52c4d83" kindref="member">useFanoutWriter</ref>;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.queryId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a5c80a05ee365bb7365bb09d7c41b8900" kindref="member">queryId</ref>;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.writeProperties<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1adb97d675fd9a9d98d186f082279d7053" kindref="member">writeProperties</ref>;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="665"><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="667" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a0cfb2c3d08cc3733cc879ee0937cf01f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter" kindref="compound">DataWriter&lt;InternalRow&gt;</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a0cfb2c3d08cc3733cc879ee0937cf01f" kindref="member">createWriter</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>partitionId,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>taskId)<sp/>{</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a0cfb2c3d08cc3733cc879ee0937cf01f" kindref="member">createWriter</ref>(partitionId,<sp/>taskId,<sp/>0);</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="670"><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="672" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1af0e1919e4e56a5e82e0ec4a719a56beb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter" kindref="compound">DataWriter&lt;InternalRow&gt;</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1af0e1919e4e56a5e82e0ec4a719a56beb" kindref="member">createWriter</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>partitionId,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>taskId,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>epochId)<sp/>{</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table" kindref="compound">Table</ref><sp/>table<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a22dd099f949134389870ed31f848f9d1" kindref="member">tableBroadcast</ref>.value();</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>spec<sp/>=<sp/>table.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1a8ad2549622317d3388535399b6b7fd05" kindref="member">specs</ref>().get(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a958f38391fd0391d00e0547aed9400f6" kindref="member">outputSpecId</ref>);</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref><sp/>io<sp/>=<sp/>table.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Table_1aae6b533eb4c5f1d348a092dfce3c789b" kindref="member">io</ref>();</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>operationId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a5c80a05ee365bb7365bb09d7c41b8900" kindref="member">queryId</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;-&quot;</highlight><highlight class="normal"><sp/>+<sp/>epochId;</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1OutputFileFactory" kindref="compound">OutputFileFactory</ref><sp/>fileFactory<sp/>=</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1OutputFileFactory" kindref="compound">OutputFileFactory</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1OutputFileFactory_1a30edfa6a8d1a201495bccba67c652274" kindref="member">builderFor</ref>(table,<sp/>partitionId,<sp/>taskId)</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1OutputFileFactory_1_1Builder_1a89196cfdde2743648b1431a5621b24da" kindref="member">format</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a403b44c99d07a1d8ee8698ff4ca7d53d" kindref="member">format</ref>)</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.operationId(operationId)</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.build();</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkFileWriterFactory<sp/>writerFactory<sp/>=</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SparkFileWriterFactory.builderFor(table)</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.dataFileFormat(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a403b44c99d07a1d8ee8698ff4ca7d53d" kindref="member">format</ref>)</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.dataSchema(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1ac4bf72dd12bbc2f4492d42596c84da64" kindref="member">writeSchema</ref>)</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.dataSparkType(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a0aa40b346e14578141ed1fe245e9403a" kindref="member">dsSchema</ref>)</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.writeProperties(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1adb97d675fd9a9d98d186f082279d7053" kindref="member">writeProperties</ref>)</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.build();</highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(spec.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1afbfdfd843c02bcae35fe72994dcd968d" kindref="member">isUnpartitioned</ref>())<sp/>{</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter" kindref="compound">UnpartitionedDataWriter</ref>(writerFactory,<sp/>fileFactory,<sp/>io,<sp/>spec,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a7b29613aa081f370af13a0ead50db263" kindref="member">targetFileSize</ref>);</highlight></codeline>
<codeline lineno="692"><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter" kindref="compound">PartitionedDataWriter</ref>(</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>writerFactory,</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fileFactory,</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>io,</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>spec,</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1ac4bf72dd12bbc2f4492d42596c84da64" kindref="member">writeSchema</ref>,</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a0aa40b346e14578141ed1fe245e9403a" kindref="member">dsSchema</ref>,</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a7b29613aa081f370af13a0ead50db263" kindref="member">targetFileSize</ref>,</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1WriterFactory_1a053b35531f311ef0b785c4dfb52c4d83" kindref="member">useFanoutWriter</ref>);</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="706"><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">UnpartitionedDataWriter<sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter" kindref="compound">DataWriter</ref>&lt;InternalRow&gt;<sp/>{</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileWriter" kindref="compound">FileWriter&lt;InternalRow, DataWriteResult&gt;</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a8c9425b18d1f947ece2c34287a2b93fd" kindref="member">delegate</ref>;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a89eb21cc3a134a90e067a6b0e3e12904" kindref="member">io</ref>;</highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a6cbf8ff96edcc04cd17d6a692a406246" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a6cbf8ff96edcc04cd17d6a692a406246" kindref="member">UnpartitionedDataWriter</ref>(</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SparkFileWriterFactory<sp/>writerFactory,</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1OutputFileFactory" kindref="compound">OutputFileFactory</ref><sp/>fileFactory,</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a89eb21cc3a134a90e067a6b0e3e12904" kindref="member">io</ref>,</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a0a6d2a6da669f557e23474a5da878230" kindref="member">spec</ref>,</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>targetFileSize)<sp/>{</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.delegate<sp/>=</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1RollingDataWriter" kindref="compound">RollingDataWriter&lt;&gt;</ref>(writerFactory,<sp/>fileFactory,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a89eb21cc3a134a90e067a6b0e3e12904" kindref="member">io</ref>,<sp/>targetFileSize,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a0a6d2a6da669f557e23474a5da878230" kindref="member">spec</ref>,<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.io<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a89eb21cc3a134a90e067a6b0e3e12904" kindref="member">io</ref>;</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="721"><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="723" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a792ca944a79e921868483b1a39348769" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a792ca944a79e921868483b1a39348769" kindref="member">write</ref>(InternalRow<sp/>record)<sp/></highlight><highlight class="keywordflow">throws</highlight><highlight class="normal"><sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a8c9425b18d1f947ece2c34287a2b93fd" kindref="member">delegate</ref>.write(record);</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="728" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a6aefb9d8bbd837cde489cbe65d35e1eb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>WriterCommitMessage<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a6aefb9d8bbd837cde489cbe65d35e1eb" kindref="member">commit</ref>()<sp/>throws<sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a218374db7e201349f9265b8984b73c24" kindref="member">close</ref>();</highlight></codeline>
<codeline lineno="730"><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult" kindref="compound">DataWriteResult</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a280b73c18114ce4b21dbc768fe8596a4" kindref="member">result</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a8c9425b18d1f947ece2c34287a2b93fd" kindref="member">delegate</ref>.result();</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit" kindref="compound">TaskCommit</ref><sp/>taskCommit<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit" kindref="compound">TaskCommit</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a280b73c18114ce4b21dbc768fe8596a4" kindref="member">result</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult_1a00dae4c0b360328116a89354922d2116" kindref="member">dataFiles</ref>().toArray(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref>[0]));</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>taskCommit.reportOutputMetrics();</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>taskCommit;</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="738" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a5b45bc11adbf931fb89ff64fa528d166" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a5b45bc11adbf931fb89ff64fa528d166" kindref="member">abort</ref>()<sp/>throws<sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a218374db7e201349f9265b8984b73c24" kindref="member">close</ref>();</highlight></codeline>
<codeline lineno="740"><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult" kindref="compound">DataWriteResult</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a280b73c18114ce4b21dbc768fe8596a4" kindref="member">result</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a8c9425b18d1f947ece2c34287a2b93fd" kindref="member">delegate</ref>.result();</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkCleanupUtil.deleteTaskFiles(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a89eb21cc3a134a90e067a6b0e3e12904" kindref="member">io</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a280b73c18114ce4b21dbc768fe8596a4" kindref="member">result</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult_1a00dae4c0b360328116a89354922d2116" kindref="member">dataFiles</ref>());</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="744"><highlight class="normal"></highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="746" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a218374db7e201349f9265b8984b73c24" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a218374db7e201349f9265b8984b73c24" kindref="member">close</ref>()<sp/>throws<sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1UnpartitionedDataWriter_1a8c9425b18d1f947ece2c34287a2b93fd" kindref="member">delegate</ref>.close();</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="750"><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal">PartitionedDataWriter<sp/></highlight><highlight class="keyword">implements</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter" kindref="compound">DataWriter</ref>&lt;InternalRow&gt;<sp/>{</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1PartitioningWriter" kindref="compound">PartitioningWriter&lt;InternalRow, DataWriteResult&gt;</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ac4d14a59e64828b5a4536857e604e875" kindref="member">delegate</ref>;</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8e44e0e135127f30ee7a4460aa87a09f" kindref="member">io</ref>;</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8a364b37e948347283d130293ae047a8" kindref="member">spec</ref>;</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionKey" kindref="compound">PartitionKey</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ada79a697f203e44d3f0080a613dc371d" kindref="member">partitionKey</ref>;</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>InternalRowWrapper<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a664bf1a5a60fbe8ae35dadd36cb76c57" kindref="member">internalRowWrapper</ref>;</highlight></codeline>
<codeline lineno="757"><highlight class="normal"></highlight></codeline>
<codeline lineno="758" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a7facc0eb483bde23928fed2d5f472aae" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a7facc0eb483bde23928fed2d5f472aae" kindref="member">PartitionedDataWriter</ref>(</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SparkFileWriterFactory<sp/>writerFactory,</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1OutputFileFactory" kindref="compound">OutputFileFactory</ref><sp/>fileFactory,</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8e44e0e135127f30ee7a4460aa87a09f" kindref="member">io</ref>,</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8a364b37e948347283d130293ae047a8" kindref="member">spec</ref>,</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>dataSchema,</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1types_1_1Types_1_1StructType" kindref="compound">StructType</ref><sp/>dataSparkType,</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>targetFileSize,</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>fanoutEnabled)<sp/>{</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fanoutEnabled)<sp/>{</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.delegate<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1FanoutDataWriter" kindref="compound">FanoutDataWriter&lt;&gt;</ref>(writerFactory,<sp/>fileFactory,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8e44e0e135127f30ee7a4460aa87a09f" kindref="member">io</ref>,<sp/>targetFileSize);</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this.delegate<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1ClusteredDataWriter" kindref="compound">ClusteredDataWriter&lt;&gt;</ref>(writerFactory,<sp/>fileFactory,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8e44e0e135127f30ee7a4460aa87a09f" kindref="member">io</ref>,<sp/>targetFileSize);</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.io<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8e44e0e135127f30ee7a4460aa87a09f" kindref="member">io</ref>;</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.spec<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8a364b37e948347283d130293ae047a8" kindref="member">spec</ref>;</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.partitionKey<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionKey" kindref="compound">PartitionKey</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8a364b37e948347283d130293ae047a8" kindref="member">spec</ref>,<sp/>dataSchema);</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.internalRowWrapper<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>InternalRowWrapper(dataSparkType,<sp/>dataSchema.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a6f726c07b15a68fc5cb6e1b1e185876c" kindref="member">asStruct</ref>());</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="777"><highlight class="normal"></highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="779" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a61a1bb04e7795db253fb311976ebd638" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a61a1bb04e7795db253fb311976ebd638" kindref="member">write</ref>(InternalRow<sp/>row)<sp/></highlight><highlight class="keywordflow">throws</highlight><highlight class="normal"><sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ada79a697f203e44d3f0080a613dc371d" kindref="member">partitionKey</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionKey_1a74071f98e089bee3a5bb8605c99a0511" kindref="member">partition</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a664bf1a5a60fbe8ae35dadd36cb76c57" kindref="member">internalRowWrapper</ref>.wrap(row));</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ac4d14a59e64828b5a4536857e604e875" kindref="member">delegate</ref>.write(row,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8a364b37e948347283d130293ae047a8" kindref="member">spec</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ada79a697f203e44d3f0080a613dc371d" kindref="member">partitionKey</ref>);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="783"><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="785" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ad0ef0668a2de5888c1d1d38e18388272" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/>WriterCommitMessage<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ad0ef0668a2de5888c1d1d38e18388272" kindref="member">commit</ref>()<sp/>throws<sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a165516c03c1894eea67428471ff70929" kindref="member">close</ref>();</highlight></codeline>
<codeline lineno="787"><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult" kindref="compound">DataWriteResult</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a280b73c18114ce4b21dbc768fe8596a4" kindref="member">result</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ac4d14a59e64828b5a4536857e604e875" kindref="member">delegate</ref>.result();</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit" kindref="compound">TaskCommit</ref><sp/>taskCommit<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1TaskCommit" kindref="compound">TaskCommit</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a280b73c18114ce4b21dbc768fe8596a4" kindref="member">result</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult_1a00dae4c0b360328116a89354922d2116" kindref="member">dataFiles</ref>().toArray(</highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1DataFile" kindref="compound">DataFile</ref>[0]));</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>taskCommit.reportOutputMetrics();</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>taskCommit;</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="793"><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="795" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1abb4b1faca3aa046ecd4c234fd797111f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1abb4b1faca3aa046ecd4c234fd797111f" kindref="member">abort</ref>()<sp/>throws<sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a165516c03c1894eea67428471ff70929" kindref="member">close</ref>();</highlight></codeline>
<codeline lineno="797"><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult" kindref="compound">DataWriteResult</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a280b73c18114ce4b21dbc768fe8596a4" kindref="member">result</ref><sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ac4d14a59e64828b5a4536857e604e875" kindref="member">delegate</ref>.result();</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>SparkCleanupUtil.deleteTaskFiles(<ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a8e44e0e135127f30ee7a4460aa87a09f" kindref="member">io</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriter_1a280b73c18114ce4b21dbc768fe8596a4" kindref="member">result</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1io_1_1DataWriteResult_1a00dae4c0b360328116a89354922d2116" kindref="member">dataFiles</ref>());</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="801"><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/>@Override</highlight></codeline>
<codeline lineno="803" refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a165516c03c1894eea67428471ff70929" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1a165516c03c1894eea67428471ff70929" kindref="member">close</ref>()<sp/>throws<sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1spark_1_1source_1_1SparkWrite_1_1PartitionedDataWriter_1ac4d14a59e64828b5a4536857e604e875" kindref="member">delegate</ref>.close();</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="807"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="spark/v3.5/spark/src/main/java/org/apache/iceberg/spark/source/SparkWrite.java"/>
  </compounddef>
</doxygen>
