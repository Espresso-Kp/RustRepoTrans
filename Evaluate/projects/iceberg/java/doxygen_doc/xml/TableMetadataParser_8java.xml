<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="TableMetadataParser_8java" kind="file" language="Java">
    <compoundname>TableMetadataParser.java</compoundname>
    <innerclass refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser" prot="public">org::apache::iceberg::TableMetadataParser</innerclass>
    <innerclass refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" prot="public">org::apache::iceberg::TableMetadataParser::Codec</innerclass>
    <innernamespace refid="namespaceorg_1_1apache_1_1iceberg">org::apache::iceberg</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>Licensed<sp/>to<sp/>the<sp/>Apache<sp/>Software<sp/>Foundation<sp/>(ASF)<sp/>under<sp/>one</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>or<sp/>more<sp/>contributor<sp/>license<sp/>agreements.<sp/><sp/>See<sp/>the<sp/>NOTICE<sp/>file</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/>distributed<sp/>with<sp/>this<sp/>work<sp/>for<sp/>additional<sp/>information</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>regarding<sp/>copyright<sp/>ownership.<sp/><sp/>The<sp/>ASF<sp/>licenses<sp/>this<sp/>file</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>to<sp/>you<sp/>under<sp/>the<sp/>Apache<sp/>License,<sp/>Version<sp/>2.0<sp/>(the</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>&quot;License&quot;);<sp/>you<sp/>may<sp/>not<sp/>use<sp/>this<sp/>file<sp/>except<sp/>in<sp/>compliance</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>with<sp/>the<sp/>License.<sp/><sp/>You<sp/>may<sp/>obtain<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>License<sp/>at</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/><sp/><sp/>http://www.apache.org/licenses/LICENSE-2.0</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/>Unless<sp/>required<sp/>by<sp/>applicable<sp/>law<sp/>or<sp/>agreed<sp/>to<sp/>in<sp/>writing,</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/>software<sp/>distributed<sp/>under<sp/>the<sp/>License<sp/>is<sp/>distributed<sp/>on<sp/>an</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/>&quot;AS<sp/>IS&quot;<sp/>BASIS,<sp/>WITHOUT<sp/>WARRANTIES<sp/>OR<sp/>CONDITIONS<sp/>OF<sp/>ANY</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/>KIND,<sp/>either<sp/>express<sp/>or<sp/>implied.<sp/><sp/>See<sp/>the<sp/>License<sp/>for<sp/>the</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*<sp/>specific<sp/>language<sp/>governing<sp/>permissions<sp/>and<sp/>limitations</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/>under<sp/>the<sp/>License.</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">package<sp/></highlight><highlight class="normal">org.apache.iceberg;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.fasterxml.jackson.core.JsonGenerator;</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>com.fasterxml.jackson.databind.JsonNode;</highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.IOException;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.InputStream;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.OutputStream;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.OutputStreamWriter;</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.io.StringWriter;</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.nio.charset.StandardCharsets;</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Iterator;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.List;</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Locale;</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.Map;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.zip.GZIPInputStream;</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>java.util.zip.GZIPOutputStream;</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref>;</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" kindref="compound">SnapshotLogEntry</ref>;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1exceptions" kindref="compound">exceptions</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1RuntimeIOException" kindref="compound">RuntimeIOException</ref>;</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref>;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile" kindref="compound">InputFile</ref>;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1io" kindref="compound">io</ref>.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile" kindref="compound">OutputFile</ref>;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.base.<ref refid="classorg_1_1apache_1_1iceberg_1_1relocated_1_1com_1_1google_1_1common_1_1base_1_1Preconditions" kindref="compound">Preconditions</ref>;</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.ImmutableList;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.ImmutableMap;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.relocated.com.google.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1common" kindref="compound">common</ref>.collect.Lists;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/><ref refid="namespaceorg" kindref="compound">org</ref>.<ref refid="namespaceorg_1_1apache" kindref="compound">apache</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg" kindref="compound">iceberg</ref>.<ref refid="namespaceorg_1_1apache_1_1iceberg_1_1util" kindref="compound">util</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser" kindref="compound">TableMetadataParser</ref><sp/>{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49" refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" refkind="compound"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref><sp/>{</highlight></codeline>
<codeline lineno="50" refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1a1f412a11db17ff43737d970cbbc2f7cf" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1a1f412a11db17ff43737d970cbbc2f7cf" kindref="member">NONE</ref>(</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="51" refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ac2c232b9b864513afa71c248150d5b58" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ac2c232b9b864513afa71c248150d5b58" kindref="member">GZIP</ref>(</highlight><highlight class="stringliteral">&quot;.gz&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53" refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1aa95f0c020de3fb835d1802a8064e18f4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1aa95f0c020de3fb835d1802a8064e18f4" kindref="member">extension</ref>;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55" refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ad9458d524b1cf239b17ad267d0ca97e1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ad9458d524b1cf239b17ad267d0ca97e1" kindref="member">Codec</ref>(String<sp/>extension)<sp/>{</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>this.extension<sp/>=<sp/>extension;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59" refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ae4ca728a643acb8a7a6c1b21ba6b6953" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ae4ca728a643acb8a7a6c1b21ba6b6953" kindref="member">fromName</ref>(String<sp/>codecName)<sp/>{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(codecName<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Codec<sp/>name<sp/>is<sp/>null&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.valueOf(codecName.toUpperCase(Locale.ENGLISH));</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(IllegalArgumentException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>IllegalArgumentException(String.format(</highlight><highlight class="stringliteral">&quot;Invalid<sp/>codec<sp/>name:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>codecName),<sp/>e);</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68" refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1aedc05252237d7866d056205828a01f8b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1aedc05252237d7866d056205828a01f8b" kindref="member">fromFileName</ref>(String<sp/>fileName)<sp/>{</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fileName.contains(</highlight><highlight class="stringliteral">&quot;.metadata.json&quot;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&quot;%s<sp/>is<sp/>not<sp/>a<sp/>valid<sp/>metadata<sp/>file&quot;</highlight><highlight class="normal">,<sp/>fileName);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>have<sp/>to<sp/>be<sp/>backward-compatible<sp/>with<sp/>.metadata.json.gz<sp/>files</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fileName.endsWith(</highlight><highlight class="stringliteral">&quot;.metadata.json.gz&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ac2c232b9b864513afa71c248150d5b58" kindref="member">GZIP</ref>;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>fileNameWithoutSuffix<sp/>=<sp/>fileName.substring(0,<sp/>fileName.lastIndexOf(</highlight><highlight class="stringliteral">&quot;.metadata.json&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fileNameWithoutSuffix.endsWith(<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ac2c232b9b864513afa71c248150d5b58" kindref="member">GZIP</ref>.extension))<sp/>{</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ac2c232b9b864513afa71c248150d5b58" kindref="member">GZIP</ref>;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1a1f412a11db17ff43737d970cbbc2f7cf" kindref="member">NONE</ref>;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a81424b2d0042077066fddff8ae6cf72b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a81424b2d0042077066fddff8ae6cf72b" kindref="member">TableMetadataParser</ref>()<sp/>{}</highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>visible<sp/>for<sp/>testing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>FORMAT_VERSION<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;format-version&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>TABLE_UUID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;table-uuid&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>LOCATION<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;location&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>LAST_SEQUENCE_NUMBER<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;last-sequence-number&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>LAST_UPDATED_MILLIS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;last-updated-ms&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>LAST_COLUMN_ID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;last-column-id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>SCHEMA<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;schema&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>SCHEMAS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;schemas&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>CURRENT_SCHEMA_ID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;current-schema-id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>PARTITION_SPEC<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;partition-spec&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>PARTITION_SPECS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;partition-specs&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>DEFAULT_SPEC_ID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;default-spec-id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>LAST_PARTITION_ID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;last-partition-id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>DEFAULT_SORT_ORDER_ID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;default-sort-order-id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>SORT_ORDERS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;sort-orders&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>PROPERTIES<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;properties&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>CURRENT_SNAPSHOT_ID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;current-snapshot-id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>REFS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;refs&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>SNAPSHOTS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;snapshots&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>SNAPSHOT_ID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;snapshot-id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>TIMESTAMP_MS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;timestamp-ms&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>SNAPSHOT_LOG<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;snapshot-log&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>METADATA_FILE<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;metadata-file&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>METADATA_LOG<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;metadata-log&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>STATISTICS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;statistics&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">final</highlight><highlight class="normal"><sp/>String<sp/>PARTITION_STATISTICS<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;partition-statistics&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a81ab758fa731202edd9e1566c402f313" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a81ab758fa731202edd9e1566c402f313" kindref="member">overwrite</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/>metadata,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile" kindref="compound">OutputFile</ref><sp/>outputFile)<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a728cf491bb8bca46c75bc1ed970c27d4" kindref="member">internalWrite</ref>(metadata,<sp/>outputFile,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a52a0e426c21c09463ea1a4ba54ed909a" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a52a0e426c21c09463ea1a4ba54ed909a" kindref="member">write</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/>metadata,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile" kindref="compound">OutputFile</ref><sp/>outputFile)<sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a728cf491bb8bca46c75bc1ed970c27d4" kindref="member">internalWrite</ref>(metadata,<sp/>outputFile,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a728cf491bb8bca46c75bc1ed970c27d4" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a728cf491bb8bca46c75bc1ed970c27d4" kindref="member">internalWrite</ref>(</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/>metadata,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile" kindref="compound">OutputFile</ref><sp/>outputFile,<sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a81ab758fa731202edd9e1566c402f313" kindref="member">overwrite</ref>)<sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">boolean</highlight><highlight class="normal"><sp/>isGzip<sp/>=<sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1aedc05252237d7866d056205828a01f8b" kindref="member">fromFileName</ref>(outputFile.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile_1aed26d2ade3d77f0ea8ee2b0afb18cdbf" kindref="member">location</ref>())<sp/>==<sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ac2c232b9b864513afa71c248150d5b58" kindref="member">GZIP</ref>;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>OutputStream<sp/>stream<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a81ab758fa731202edd9e1566c402f313" kindref="member">overwrite</ref><sp/>?<sp/>outputFile.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile_1a98df1f0f31f0073aad13be5f34011c5d" kindref="member">createOrOverwrite</ref>()<sp/>:<sp/>outputFile.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1OutputFile_1abd61f39f96a5040fbb32d06af7d700ab" kindref="member">create</ref>();</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>(OutputStream<sp/>ou<sp/>=<sp/>isGzip<sp/>?<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>GZIPOutputStream(stream)<sp/>:<sp/>stream;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>OutputStreamWriter<sp/>writer<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>OutputStreamWriter(ou,<sp/>StandardCharsets.UTF_8))<sp/>{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>JsonGenerator<sp/>generator<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1add64d71f673247671d00d68d91ae3af1" kindref="member">factory</ref>().createGenerator(writer);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.useDefaultPrettyPrinter();</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a4fa7cf7eea8f8706c6f28e1d17fe5316" kindref="member">toJson</ref>(metadata,<sp/>generator);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.flush();</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(IOException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1RuntimeIOException" kindref="compound">RuntimeIOException</ref>(e,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>write<sp/>json<sp/>to<sp/>file:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>outputFile);</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a182202a5a33a656ca66cc0cd5294d514" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a182202a5a33a656ca66cc0cd5294d514" kindref="member">getFileExtension</ref>(String<sp/>codecName)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a182202a5a33a656ca66cc0cd5294d514" kindref="member">getFileExtension</ref>(<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ae4ca728a643acb8a7a6c1b21ba6b6953" kindref="member">fromName</ref>(codecName));</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1aafe1226c677f7b37bf8c5c694cfd713d" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1aafe1226c677f7b37bf8c5c694cfd713d" kindref="member">getFileExtension</ref>(<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref><sp/>codec)<sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>codec.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1aa95f0c020de3fb835d1802a8064e18f4" kindref="member">extension</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&quot;.metadata.json&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"></highlight></codeline>
<codeline lineno="145" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a3caa0a9d0899bc493865fcebf2f3ffdb" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a3caa0a9d0899bc493865fcebf2f3ffdb" kindref="member">getOldFileExtension</ref>(<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref><sp/>codec)<sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>have<sp/>to<sp/>be<sp/>backward-compatible<sp/>with<sp/>.metadata.json.gz<sp/>files</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;.metadata.json&quot;</highlight><highlight class="normal"><sp/>+<sp/>codec.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1aa95f0c020de3fb835d1802a8064e18f4" kindref="member">extension</ref>;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a4fa7cf7eea8f8706c6f28e1d17fe5316" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>String<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a4fa7cf7eea8f8706c6f28e1d17fe5316" kindref="member">toJson</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/>metadata)<sp/>{</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>(StringWriter<sp/>writer<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>StringWriter())<sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>JsonGenerator<sp/>generator<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1add64d71f673247671d00d68d91ae3af1" kindref="member">factory</ref>().createGenerator(writer);</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a4fa7cf7eea8f8706c6f28e1d17fe5316" kindref="member">toJson</ref>(metadata,<sp/>generator);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.flush();</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>writer.toString();</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(IOException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1RuntimeIOException" kindref="compound">RuntimeIOException</ref>(e,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>write<sp/>json<sp/>for:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>metadata);</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/>@SuppressWarnings(</highlight><highlight class="stringliteral">&quot;checkstyle:CyclomaticComplexity&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="162" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a08bb0a7aadbe6542154aee91ef23b7b4" refkind="member"><highlight class="normal"><sp/><sp/>public<sp/>static<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a4fa7cf7eea8f8706c6f28e1d17fe5316" kindref="member">toJson</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/>metadata,<sp/>JsonGenerator<sp/>generator)<sp/>throws<sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeStartObject();</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeNumberField(FORMAT_VERSION,<sp/>metadata.formatVersion());</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeStringField(TABLE_UUID,<sp/>metadata.uuid());</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeStringField(LOCATION,<sp/>metadata.location());</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(metadata.formatVersion()<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeNumberField(LAST_SEQUENCE_NUMBER,<sp/>metadata.lastSequenceNumber());</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeNumberField(LAST_UPDATED_MILLIS,<sp/>metadata.lastUpdatedMillis());</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeNumberField(LAST_COLUMN_ID,<sp/>metadata.lastColumnId());</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>older<sp/>readers,<sp/>continue<sp/>writing<sp/>the<sp/>current<sp/>schema<sp/>as<sp/>&quot;schema&quot;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>is<sp/>only<sp/>needed<sp/>for<sp/>v1<sp/>because<sp/>support<sp/>for<sp/>schemas<sp/>and<sp/>current-schema-id<sp/>is<sp/>required<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>v2<sp/>and<sp/>later.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(metadata.formatVersion()<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeFieldName(SCHEMA);</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SchemaParser" kindref="compound">SchemaParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SchemaParser_1adde244e97629de53b5cc381c929b6d3c" kindref="member">toJson</ref>(metadata.schema(),<sp/>generator);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>write<sp/>the<sp/>current<sp/>schema<sp/>ID<sp/>and<sp/>schema<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeNumberField(CURRENT_SCHEMA_ID,<sp/>metadata.currentSchemaId());</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeArrayFieldStart(SCHEMAS);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>schema<sp/>:<sp/>metadata.schemas())<sp/>{</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SchemaParser" kindref="compound">SchemaParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SchemaParser_1adde244e97629de53b5cc381c929b6d3c" kindref="member">toJson</ref>(schema,<sp/>generator);</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndArray();</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>older<sp/>readers,<sp/>continue<sp/>writing<sp/>the<sp/>default<sp/>spec<sp/>as<sp/>&quot;partition-spec&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(metadata.formatVersion()<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeFieldName(PARTITION_SPEC);</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpecParser" kindref="compound">PartitionSpecParser</ref>.toJsonFields(metadata.spec(),<sp/>generator);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>write<sp/>the<sp/>default<sp/>spec<sp/>ID<sp/>and<sp/>spec<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeNumberField(DEFAULT_SPEC_ID,<sp/>metadata.defaultSpecId());</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeArrayFieldStart(PARTITION_SPECS);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref><sp/>spec<sp/>:<sp/>metadata.specs())<sp/>{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpecParser" kindref="compound">PartitionSpecParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpecParser_1aaed79513fc2dffee8bf273e0f537c16d" kindref="member">toJson</ref>(spec,<sp/>generator);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndArray();</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeNumberField(LAST_PARTITION_ID,<sp/>metadata.lastAssignedPartitionId());</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>write<sp/>the<sp/>default<sp/>order<sp/>ID<sp/>and<sp/>sort<sp/>order<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeNumberField(DEFAULT_SORT_ORDER_ID,<sp/>metadata.defaultSortOrderId());</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeArrayFieldStart(SORT_ORDERS);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>sortOrder<sp/>:<sp/>metadata.sortOrders())<sp/>{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrderParser" kindref="compound">SortOrderParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrderParser_1a33d3e845e313127bf77260ace29083f2" kindref="member">toJson</ref>(sortOrder,<sp/>generator);</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndArray();</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>write<sp/>properties<sp/>map</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a5ce1c36e1ce1d013be175dfe89b966c1" kindref="member">writeStringMap</ref>(PROPERTIES,<sp/>metadata.properties(),<sp/>generator);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeNumberField(</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CURRENT_SNAPSHOT_ID,</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>metadata.currentSnapshot()<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal"><sp/>?<sp/>metadata.currentSnapshot().snapshotId()<sp/>:<sp/>-1);</highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a4fa7cf7eea8f8706c6f28e1d17fe5316" kindref="member">toJson</ref>(metadata.refs(),<sp/>generator);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeArrayFieldStart(SNAPSHOTS);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1Snapshot" kindref="compound">Snapshot</ref><sp/>snapshot<sp/>:<sp/>metadata.snapshots())<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotParser" kindref="compound">SnapshotParser</ref>.toJson(snapshot,<sp/>generator);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndArray();</highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeArrayFieldStart(STATISTICS);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StatisticsFile" kindref="compound">StatisticsFile</ref><sp/>statisticsFile<sp/>:<sp/>metadata.statisticsFiles())<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1StatisticsFileParser" kindref="compound">StatisticsFileParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1StatisticsFileParser_1ace562ee7c181dc6d0b0f296121187d0d" kindref="member">toJson</ref>(statisticsFile,<sp/>generator);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndArray();</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeArrayFieldStart(PARTITION_STATISTICS);</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFile" kindref="compound">PartitionStatisticsFile</ref><sp/>partitionStatisticsFile<sp/>:<sp/>metadata.partitionStatisticsFiles())<sp/>{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFileParser" kindref="compound">PartitionStatisticsFileParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFileParser_1a9bb2a3ea99ab463d4abed5484675d151" kindref="member">toJson</ref>(partitionStatisticsFile,<sp/>generator);</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndArray();</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeArrayFieldStart(SNAPSHOT_LOG);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry" kindref="compound">HistoryEntry</ref><sp/>logEntry<sp/>:<sp/>metadata.snapshotLog())<sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeStartObject();</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeNumberField(TIMESTAMP_MS,<sp/>logEntry.timestampMillis());</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeNumberField(SNAPSHOT_ID,<sp/>logEntry.snapshotId());</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeEndObject();</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndArray();</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeArrayFieldStart(METADATA_LOG);</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref><sp/>logEntry<sp/>:<sp/>metadata.previousFiles())<sp/>{</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeStartObject();</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeNumberField(TIMESTAMP_MS,<sp/>logEntry.timestampMillis());</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeStringField(METADATA_FILE,<sp/>logEntry.file());</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeEndObject();</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndArray();</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndObject();</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a221a644894ef7a9494c3fd6f4d9537ba" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a221a644894ef7a9494c3fd6f4d9537ba" kindref="member">toJson</ref>(Map&lt;String,<sp/>SnapshotRef&gt;<sp/>refs,<sp/>JsonGenerator<sp/>generator)</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throws</highlight><highlight class="normal"><sp/>IOException<sp/>{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeObjectFieldStart(REFS);</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(Map.Entry&lt;String,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>&gt;<sp/>refEntry<sp/>:<sp/>refs.entrySet())<sp/>{</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>generator.writeFieldName(refEntry.getKey());</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRefParser" kindref="compound">SnapshotRefParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRefParser_1adb4aa6328e04f78d4f2ac95f3ac8e03d" kindref="member">toJson</ref>(refEntry.getValue(),<sp/>generator);</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>generator.writeEndObject();</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a9ea43b3abb0993fc22a20729a1fded5e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a9ea43b3abb0993fc22a20729a1fded5e" kindref="member">read</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref><sp/>io,<sp/>String<sp/>path)<sp/>{</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a9ea43b3abb0993fc22a20729a1fded5e" kindref="member">read</ref>(io,<sp/>io.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO_1a54bd6931df3543c33aa9490c26e4e181" kindref="member">newInputFile</ref>(path));</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a095b10ad0c58a62716e7628f160f7a7f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a095b10ad0c58a62716e7628f160f7a7f" kindref="member">read</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1FileIO" kindref="compound">FileIO</ref><sp/>io,<sp/><ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile" kindref="compound">InputFile</ref><sp/>file)<sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref><sp/>codec<sp/>=<sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1aedc05252237d7866d056205828a01f8b" kindref="member">fromFileName</ref>(file.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile_1a2efb068d80de4323e27a2d4699a7ce7b" kindref="member">location</ref>());</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>(InputStream<sp/>is<sp/>=</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>codec<sp/>==<sp/><ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec" kindref="compound">Codec</ref>.<ref refid="enumorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1_1Codec_1ac2c232b9b864513afa71c248150d5b58" kindref="member">GZIP</ref><sp/>?<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>GZIPInputStream(file.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile_1ab7df9d86933a5957f118029c3323e8af" kindref="member">newStream</ref>())<sp/>:<sp/>file.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile_1ab7df9d86933a5957f118029c3323e8af" kindref="member">newStream</ref>())<sp/>{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a7b8cff42b90a5abf0f44e40dc9e82c7b" kindref="member">fromJson</ref>(file,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a5b4b7bd114a2548388513db0fd22731a" kindref="member">mapper</ref>().readValue(is,<sp/>JsonNode.class));</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(IOException<sp/>e)<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1exceptions_1_1RuntimeIOException" kindref="compound">RuntimeIOException</ref>(e,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>read<sp/>file:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>file);</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="294" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a7b8cff42b90a5abf0f44e40dc9e82c7b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a7b8cff42b90a5abf0f44e40dc9e82c7b" kindref="member">fromJson</ref>(String<sp/>json)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a7b8cff42b90a5abf0f44e40dc9e82c7b" kindref="member">fromJson</ref>(</highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/>json);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="305" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a09dece478a22b92cdd20ded7721cafca" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a09dece478a22b92cdd20ded7721cafca" kindref="member">fromJson</ref>(String<sp/>metadataLocation,<sp/>String<sp/>json)<sp/>{</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1aca834120c2558d7cde490a1103b80287" kindref="member">parse</ref>(json,<sp/>node<sp/>-&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser" kindref="compound">TableMetadataParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a7b8cff42b90a5abf0f44e40dc9e82c7b" kindref="member">fromJson</ref>(metadataLocation,<sp/>node));</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1ae22c45041952f6ecc2d0e1ff08f54d7d" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1ae22c45041952f6ecc2d0e1ff08f54d7d" kindref="member">fromJson</ref>(<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile" kindref="compound">InputFile</ref><sp/>file,<sp/>JsonNode<sp/>node)<sp/>{</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a7b8cff42b90a5abf0f44e40dc9e82c7b" kindref="member">fromJson</ref>(file.<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1io_1_1InputFile_1a2efb068d80de4323e27a2d4699a7ce7b" kindref="member">location</ref>(),<sp/>node);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="312"><highlight class="normal"></highlight></codeline>
<codeline lineno="313" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a0e2b07f0dc3cd631a1bac9764322d950" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a0e2b07f0dc3cd631a1bac9764322d950" kindref="member">fromJson</ref>(JsonNode<sp/>node)<sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a7b8cff42b90a5abf0f44e40dc9e82c7b" kindref="member">fromJson</ref>((String)<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,<sp/>node);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/>@SuppressWarnings({</highlight><highlight class="stringliteral">&quot;checkstyle:CyclomaticComplexity&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;checkstyle:MethodLength&quot;</highlight><highlight class="normal">})</highlight></codeline>
<codeline lineno="318" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1aa798c5390ec04ee485de0d3c8cd7c02e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1aa798c5390ec04ee485de0d3c8cd7c02e" kindref="member">fromJson</ref>(String<sp/>metadataLocation,<sp/>JsonNode<sp/>node)<sp/>{</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>node.isObject(),<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>parse<sp/>metadata<sp/>from<sp/>a<sp/>non-object:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>node);</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>formatVersion<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a942365047ba258cb5a75f3ac3dc46d5b" kindref="member">getInt</ref>(FORMAT_VERSION,<sp/>node);</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>formatVersion<sp/>&lt;=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>.SUPPORTED_TABLE_FORMAT_VERSION,</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>read<sp/>unsupported<sp/>version<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>formatVersion);</highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/>String<sp/>uuid<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1aaf21fe0c9679ca6208b8a87a870ba1df" kindref="member">getStringOrNull</ref>(TABLE_UUID,<sp/>node);</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>String<sp/>location<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a2b9057002c5ac1d525d8d14c699bc0ac" kindref="member">getString</ref>(LOCATION,<sp/>node);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>lastSequenceNumber;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(formatVersion<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>lastSequenceNumber<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a1d0164ff6e8716c985302ba672746d82" kindref="member">getLong</ref>(LAST_SEQUENCE_NUMBER,<sp/>node);</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>lastSequenceNumber<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>.INITIAL_SEQUENCE_NUMBER;</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>lastAssignedColumnId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a942365047ba258cb5a75f3ac3dc46d5b" kindref="member">getInt</ref>(LAST_COLUMN_ID,<sp/>node);</highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;Schema&gt;<sp/>schemas;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>currentSchemaId;</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>schema<sp/>=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>JsonNode<sp/>schemaArray<sp/>=<sp/>node.get(SCHEMAS);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(schemaArray<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>schemaArray.isArray(),<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>parse<sp/>schemas<sp/>from<sp/>non-array:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>schemaArray);</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>current<sp/>schema<sp/>ID<sp/>is<sp/>required<sp/>when<sp/>the<sp/>schema<sp/>array<sp/>is<sp/>present</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>currentSchemaId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a942365047ba258cb5a75f3ac3dc46d5b" kindref="member">getInt</ref>(CURRENT_SCHEMA_ID,<sp/>node);</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>parse<sp/>the<sp/>schema<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.Builder&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref>&gt;<sp/>builder<sp/>=<sp/>ImmutableList.builder();</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(JsonNode<sp/>schemaNode<sp/>:<sp/>schemaArray)<sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1Schema" kindref="compound">Schema</ref><sp/>current<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SchemaParser" kindref="compound">SchemaParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SchemaParser_1a1cfea0dbd74c8b90c7ef06d5df67c293" kindref="member">fromJson</ref>(schemaNode);</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(current.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a8552d7c8436cc4890a06ee15dd79e4a2" kindref="member">schemaId</ref>()<sp/>==<sp/>currentSchemaId)<sp/>{</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>schema<sp/>=<sp/>current;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>builder.add(current);</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>schema<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>find<sp/>schema<sp/>with<sp/>%s=%s<sp/>from<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CURRENT_SCHEMA_ID,</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>currentSchemaId,</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SCHEMAS);</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>schemas<sp/>=<sp/>builder.build();</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>formatVersion<sp/>==<sp/>1,<sp/></highlight><highlight class="stringliteral">&quot;%s<sp/>must<sp/>exist<sp/>in<sp/>format<sp/>v%s&quot;</highlight><highlight class="normal">,<sp/>SCHEMAS,<sp/>formatVersion);</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>schema<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SchemaParser" kindref="compound">SchemaParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SchemaParser_1a1cfea0dbd74c8b90c7ef06d5df67c293" kindref="member">fromJson</ref>(<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a79dbcce2c2c977de06730545c59611c3" kindref="member">get</ref>(SCHEMA,<sp/>node));</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>currentSchemaId<sp/>=<sp/>schema.<ref refid="classorg_1_1apache_1_1iceberg_1_1Schema_1a8552d7c8436cc4890a06ee15dd79e4a2" kindref="member">schemaId</ref>();</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>schemas<sp/>=<sp/>ImmutableList.of(schema);</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>JsonNode<sp/>specArray<sp/>=<sp/>node.get(PARTITION_SPECS);</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;PartitionSpec&gt;<sp/>specs;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>defaultSpecId;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(specArray<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specArray.isArray(),<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>parse<sp/>partition<sp/>specs<sp/>from<sp/>non-array:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>specArray);</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>spec<sp/>ID<sp/>is<sp/>required<sp/>when<sp/>the<sp/>spec<sp/>array<sp/>is<sp/>present</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>defaultSpecId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a942365047ba258cb5a75f3ac3dc46d5b" kindref="member">getInt</ref>(DEFAULT_SPEC_ID,<sp/>node);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>parse<sp/>the<sp/>spec<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.Builder&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>&gt;<sp/>builder<sp/>=<sp/>ImmutableList.builder();</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(JsonNode<sp/>spec<sp/>:<sp/>specArray)<sp/>{</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundPartitionSpec" kindref="compound">UnboundPartitionSpec</ref><sp/>unboundSpec<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpecParser" kindref="compound">PartitionSpecParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpecParser_1a48e3b620f7a0bd8098e5d723fca982c7" kindref="member">fromJson</ref>(spec);</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(unboundSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundPartitionSpec_1a34d60ef4ea99c82076cad0748d16fe84" kindref="member">specId</ref>()<sp/>==<sp/>defaultSpecId)<sp/>{</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>builder.add(unboundSpec.<ref refid="classorg_1_1apache_1_1iceberg_1_1UnboundPartitionSpec_1a98ed7646bd82e3aa8277b5b5ad63258e" kindref="member">bind</ref>(schema));</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>builder.add(unboundSpec.bindUnchecked(schema));</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>specs<sp/>=<sp/>builder.build();</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>formatVersion<sp/>==<sp/>1,<sp/></highlight><highlight class="stringliteral">&quot;%s<sp/>must<sp/>exist<sp/>in<sp/>format<sp/>v%s&quot;</highlight><highlight class="normal">,<sp/>PARTITION_SPECS,<sp/>formatVersion);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>partition<sp/>spec<sp/>is<sp/>required<sp/>for<sp/>older<sp/>readers,<sp/>but<sp/>is<sp/>always<sp/>set<sp/>to<sp/>the<sp/>default<sp/>if<sp/>the<sp/>spec</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>array<sp/>is<sp/>set.<sp/>it<sp/>is<sp/>only<sp/>used<sp/>to<sp/>default<sp/>the<sp/>spec<sp/>map<sp/>is<sp/>missing,<sp/>indicating<sp/>that<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>table<sp/>metadata<sp/>was<sp/>written<sp/>by<sp/>an<sp/>older<sp/>writer.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>defaultSpecId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>.INITIAL_SPEC_ID;</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>specs<sp/>=</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.of(</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpecParser" kindref="compound">PartitionSpecParser</ref>.fromJsonFields(</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>schema,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>.INITIAL_SPEC_ID,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a79dbcce2c2c977de06730545c59611c3" kindref="member">get</ref>(PARTITION_SPEC,<sp/>node)));</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>Integer<sp/>lastAssignedPartitionId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a903030da52c0a970331ff0f157f6afb9" kindref="member">getIntOrNull</ref>(LAST_PARTITION_ID,<sp/>node);</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(lastAssignedPartitionId<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>formatVersion<sp/>==<sp/>1,<sp/></highlight><highlight class="stringliteral">&quot;%s<sp/>must<sp/>exist<sp/>in<sp/>format<sp/>v%s&quot;</highlight><highlight class="normal">,<sp/>LAST_PARTITION_ID,<sp/>formatVersion);</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>lastAssignedPartitionId<sp/>=</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specs.stream()</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.mapToInt(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1ad3973380e93c6cbe41f4388350216d6b" kindref="member">PartitionSpec::lastAssignedFieldId</ref>)</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.max()</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.orElse(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec" kindref="compound">PartitionSpec</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1a0409de53f7357c6c70009d25ba61b2c5" kindref="member">unpartitioned</ref>().<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionSpec_1ad3973380e93c6cbe41f4388350216d6b" kindref="member">lastAssignedFieldId</ref>());</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>parse<sp/>the<sp/>sort<sp/>orders</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/>JsonNode<sp/>sortOrderArray<sp/>=<sp/>node.get(SORT_ORDERS);</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;SortOrder&gt;<sp/>sortOrders;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>defaultSortOrderId;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(sortOrderArray<sp/>!=<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>defaultSortOrderId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a942365047ba258cb5a75f3ac3dc46d5b" kindref="member">getInt</ref>(DEFAULT_SORT_ORDER_ID,<sp/>node);</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.Builder&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>&gt;<sp/>sortOrdersBuilder<sp/>=<sp/>ImmutableList.builder();</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(JsonNode<sp/>sortOrder<sp/>:<sp/>sortOrderArray)<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sortOrdersBuilder.add(<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrderParser" kindref="compound">SortOrderParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrderParser_1af2ac6a6440799a068555558ba2c9e7d0" kindref="member">fromJson</ref>(schema,<sp/>sortOrder,<sp/>defaultSortOrderId));</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>sortOrders<sp/>=<sp/>sortOrdersBuilder.build();</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>formatVersion<sp/>==<sp/>1,<sp/></highlight><highlight class="stringliteral">&quot;%s<sp/>must<sp/>exist<sp/>in<sp/>format<sp/>v%s&quot;</highlight><highlight class="normal">,<sp/>SORT_ORDERS,<sp/>formatVersion);</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref><sp/>defaultSortOrder<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder" kindref="compound">SortOrder</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a0df25c253d4bd778f08db5b7680ad14a" kindref="member">unsorted</ref>();</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>sortOrders<sp/>=<sp/>ImmutableList.of(defaultSortOrder);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>defaultSortOrderId<sp/>=<sp/>defaultSortOrder.<ref refid="classorg_1_1apache_1_1iceberg_1_1SortOrder_1a33c4d179099cd454e31438ce54dd7aef" kindref="member">orderId</ref>();</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>String&gt;<sp/>properties;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node.has(PROPERTIES))<sp/>{</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>parse<sp/>properties<sp/>map</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>properties<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a160d8167a96bb23309981e92c9a3d45c" kindref="member">getStringMap</ref>(PROPERTIES,<sp/>node);</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>properties<sp/>=<sp/>ImmutableMap.of();</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/>Long<sp/>currentSnapshotId<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a7724ecf22e7ddc1e20c13101f683bed1" kindref="member">getLongOrNull</ref>(CURRENT_SNAPSHOT_ID,<sp/>node);</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(currentSnapshotId<sp/>==<sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>field<sp/>is<sp/>optional,<sp/>but<sp/>internally<sp/>we<sp/>set<sp/>this<sp/>to<sp/>-1<sp/>when<sp/>not<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>currentSnapshotId<sp/>=<sp/>-1L;</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>lastUpdatedMillis<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a1d0164ff6e8716c985302ba672746d82" kindref="member">getLong</ref>(LAST_UPDATED_MILLIS,<sp/>node);</highlight></codeline>
<codeline lineno="456"><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/>Map&lt;String,<sp/>SnapshotRef&gt;<sp/>refs;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node.has(REFS))<sp/>{</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>refs<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1ae23c92d9920be906d3bf25b956a82db2" kindref="member">refsFromJson</ref>(node.get(REFS));</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(currentSnapshotId<sp/>!=<sp/>-1L)<sp/>{</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>initialize<sp/>the<sp/>main<sp/>branch<sp/>if<sp/>there<sp/>are<sp/>no<sp/>refs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>refs<sp/>=</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableMap.of(</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1abdf963b32b246b385e9d059f26ca4faf" kindref="member">MAIN_BRANCH</ref>,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1ac77b1ac69b07cf773834ee2adab7d8b8" kindref="member">branchBuilder</ref>(currentSnapshotId).<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef_1_1Builder_1a624e8042a4d1404c703591620941af5f" kindref="member">build</ref>());</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>refs<sp/>=<sp/>ImmutableMap.of();</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;Snapshot&gt;<sp/>snapshots;</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node.has(SNAPSHOTS))<sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>JsonNode<sp/>snapshotArray<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a79dbcce2c2c977de06730545c59611c3" kindref="member">get</ref>(SNAPSHOTS,<sp/>node);</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snapshotArray.isArray(),<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>parse<sp/>snapshots<sp/>from<sp/>non-array:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>snapshotArray);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>snapshots<sp/>=<sp/>Lists.newArrayListWithExpectedSize(snapshotArray.size());</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Iterator&lt;JsonNode&gt;<sp/>iterator<sp/>=<sp/>snapshotArray.elements();</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(iterator.hasNext())<sp/>{</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snapshots.add(<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotParser" kindref="compound">SnapshotParser</ref>.fromJson(iterator.next()));</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>snapshots<sp/>=<sp/>ImmutableList.of();</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;StatisticsFile&gt;<sp/>statisticsFiles;</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node.has(STATISTICS))<sp/>{</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>statisticsFiles<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a8c4f123ce29ff53e26febe7f4d7ec249" kindref="member">statisticsFilesFromJson</ref>(node.get(STATISTICS));</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>statisticsFiles<sp/>=<sp/>ImmutableList.of();</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>List&lt;PartitionStatisticsFile&gt;<sp/>partitionStatisticsFiles;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node.has(PARTITION_STATISTICS))<sp/>{</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>partitionStatisticsFiles<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1ac2426cd6a9e7071efed012d11b7bc14b" kindref="member">partitionStatsFilesFromJson</ref>(node.get(PARTITION_STATISTICS));</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>partitionStatisticsFiles<sp/>=<sp/>ImmutableList.of();</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableList.Builder&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1HistoryEntry" kindref="compound">HistoryEntry</ref>&gt;<sp/>entries<sp/>=<sp/>ImmutableList.builder();</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node.has(SNAPSHOT_LOG))<sp/>{</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Iterator&lt;JsonNode&gt;<sp/>logIterator<sp/>=<sp/>node.get(SNAPSHOT_LOG).elements();</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(logIterator.hasNext())<sp/>{</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>JsonNode<sp/>entryNode<sp/>=<sp/>logIterator.next();</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entries.add(</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1SnapshotLogEntry" kindref="compound">SnapshotLogEntry</ref>(</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a1d0164ff6e8716c985302ba672746d82" kindref="member">getLong</ref>(TIMESTAMP_MS,<sp/>entryNode),</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a1d0164ff6e8716c985302ba672746d82" kindref="member">getLong</ref>(SNAPSHOT_ID,<sp/>entryNode)));</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="509"><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableList.Builder&lt;<ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref>&gt;<sp/>metadataEntries<sp/>=<sp/>ImmutableList.builder();</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(node.has(METADATA_LOG))<sp/>{</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Iterator&lt;JsonNode&gt;<sp/>logIterator<sp/>=<sp/>node.get(METADATA_LOG).elements();</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(logIterator.hasNext())<sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>JsonNode<sp/>entryNode<sp/>=<sp/>logIterator.next();</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>metadataEntries.add(</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata_1_1MetadataLogEntry" kindref="compound">MetadataLogEntry</ref>(</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a1d0164ff6e8716c985302ba672746d82" kindref="member">getLong</ref>(TIMESTAMP_MS,<sp/>entryNode),</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a2b9057002c5ac1d525d8d14c699bc0ac" kindref="member">getString</ref>(METADATA_FILE,<sp/>entryNode)));</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadata" kindref="compound">TableMetadata</ref>(</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>metadataLocation,</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>formatVersion,</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uuid,</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>location,</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lastSequenceNumber,</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lastUpdatedMillis,</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lastAssignedColumnId,</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>currentSchemaId,</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>schemas,</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>defaultSpecId,</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>specs,</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lastAssignedPartitionId,</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>defaultSortOrderId,</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sortOrders,</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>properties,</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>currentSnapshotId,</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snapshots,</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">null</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entries.build(),</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>metadataEntries.build(),</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>refs,</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>statisticsFiles,</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partitionStatisticsFiles,</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ImmutableList.of()<sp/></highlight><highlight class="comment">/*<sp/>no<sp/>changes<sp/>from<sp/>the<sp/>file<sp/>*/</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1ae23c92d9920be906d3bf25b956a82db2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>Map&lt;String,<sp/>SnapshotRef&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1ae23c92d9920be906d3bf25b956a82db2" kindref="member">refsFromJson</ref>(JsonNode<sp/>refMap)<sp/>{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(refMap.isObject(),<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>parse<sp/>refs<sp/>from<sp/>non-object:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>refMap);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableMap.Builder&lt;String,<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref>&gt;<sp/>refsBuilder<sp/>=<sp/>ImmutableMap.builder();</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/>Iterator&lt;String&gt;<sp/>refNames<sp/>=<sp/>refMap.fieldNames();</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(refNames.hasNext())<sp/>{</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>String<sp/>refName<sp/>=<sp/>refNames.next();</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>JsonNode<sp/>refNode<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil" kindref="compound">JsonUtil</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1util_1_1JsonUtil_1a79dbcce2c2c977de06730545c59611c3" kindref="member">get</ref>(refName,<sp/>refMap);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>refNode.isObject(),<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>parse<sp/>ref<sp/>%s<sp/>from<sp/>non-object:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>refName,<sp/>refMap);</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRef" kindref="compound">SnapshotRef</ref><sp/>ref<sp/>=<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRefParser" kindref="compound">SnapshotRefParser</ref>.<ref refid="classorg_1_1apache_1_1iceberg_1_1SnapshotRefParser_1a2e40c06961119c8be3217932ec2011b5" kindref="member">fromJson</ref>(refNode);</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>refsBuilder.put(refName,<sp/>ref);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>refsBuilder.build();</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight></codeline>
<codeline lineno="566" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a8c4f123ce29ff53e26febe7f4d7ec249" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>List&lt;StatisticsFile&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1a8c4f123ce29ff53e26febe7f4d7ec249" kindref="member">statisticsFilesFromJson</ref>(JsonNode<sp/>statisticsFilesList)<sp/>{</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>statisticsFilesList.isArray(),</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>parse<sp/>statistics<sp/>files<sp/>from<sp/>non-array:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>statisticsFilesList);</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableList.Builder&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1StatisticsFile" kindref="compound">StatisticsFile</ref>&gt;<sp/>statisticsFilesBuilder<sp/>=<sp/>ImmutableList.builder();</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(JsonNode<sp/>statisticsFile<sp/>:<sp/>statisticsFilesList)<sp/>{</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>statisticsFilesBuilder.add(<ref refid="classorg_1_1apache_1_1iceberg_1_1StatisticsFileParser" kindref="compound">StatisticsFileParser</ref>.fromJson(statisticsFile));</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>statisticsFilesBuilder.build();</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="579"><highlight class="normal"></highlight></codeline>
<codeline lineno="580" refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1ac2426cd6a9e7071efed012d11b7bc14b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">private</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>List&lt;PartitionStatisticsFile&gt;<sp/><ref refid="classorg_1_1apache_1_1iceberg_1_1TableMetadataParser_1ac2426cd6a9e7071efed012d11b7bc14b" kindref="member">partitionStatsFilesFromJson</ref>(JsonNode<sp/>filesList)<sp/>{</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/>Preconditions.checkArgument(</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filesList.isArray(),</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>parse<sp/>partition<sp/>statistics<sp/>files<sp/>from<sp/>non-array:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filesList);</highlight></codeline>
<codeline lineno="585"><highlight class="normal"></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>ImmutableList.Builder&lt;<ref refid="interfaceorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFile" kindref="compound">PartitionStatisticsFile</ref>&gt;<sp/>statsFileBuilder<sp/>=<sp/>ImmutableList.builder();</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(JsonNode<sp/>partitionStatsFile<sp/>:<sp/>filesList)<sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>statsFileBuilder.add(<ref refid="classorg_1_1apache_1_1iceberg_1_1PartitionStatisticsFileParser" kindref="compound">PartitionStatisticsFileParser</ref>.fromJson(partitionStatsFile));</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>statsFileBuilder.build();</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="593"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="core/src/main/java/org/apache/iceberg/TableMetadataParser.java"/>
  </compounddef>
</doxygen>
